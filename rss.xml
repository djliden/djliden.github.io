<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<author><name>Daniel Liden</name></author>
<title>Daniel Liden's Blog</title>
<description>Data, AI, and other writing from Daniel Liden</description>
<generator>Emacs webfeeder.el</generator>
<link>https://danliden.com</link>
<atom:link href="https://danliden.com/rss.xml" rel="self" type="application/rss+xml"/>
<lastBuildDate>Fri, 12 Jan 2024 02:47:48 +0000</lastBuildDate>
<item>
  <title>Introduction to Emacs Hooks</title>
  <description><![CDATA[<div id="content">
 <div id="outline-container-org985bc5f" class="outline-2">
 <h2 id="org985bc5f">Emacs Hooks</h2>
 <div class="outline-text-2" id="text-org985bc5f">
 <div class="preview">
 <p>
Today I was customizing the appearance of org files displayed with  <a href="https://github.com/takaxp/org-tree-slide">org-tree-slide</a>. In particular, I wanted to increase the font size and start  <a href="https://github.com/rnkn/olivetti">Olivetti mode</a> whenever I started  <code>org-tree-slide-mode</code> and return everything to normal when I was done. This, I quickly discovered, required the use of  <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Hooks.html">hooks</a>. Hooks are not especially complicated, but they are useful and worth taking a few minutes to understand. This post will cover the basics of working with hooks in emacs.
</p>

</div>
</div>
</div>
 <div id="outline-container-org8e8f897" class="outline-2">
 <h2 id="org8e8f897">What do hooks do?</h2>
 <div class="outline-text-2" id="text-org8e8f897">
 <p>
A  <i>hook</i> is a list of functions that are run on specifically-defined occasions, triggered by calls to a  <code>run-hooks</code> or  <code>run-mode-hooks</code> function.
</p>

 <p>
Hooks are very commonly run when major modes (and, often, minor modes) are initialized in an emacs session. They provide a way to set up mode-specific configurations when a mode is initialized or when some specific action is undertaken by the user.
</p>

 <p>
For a specific example,  <code>org-tree-slide-mode</code> defines the hooks  <code>org-tree-slide-play-hook</code> and  <code>org-tree-slide-stop-hook</code>, which define what happens when a slide show is started or stopped. I wanted to increase the font size, decrease the width of the displayed text, and remove the header line when the slide show was active, and reset them when it was finished.
</p>


 <div class="org-center">

 <figure> <img src="./figures/20231217-emacs-hooks/hooks_screen_capture.gif" alt="hooks_screen_capture.gif"></img> <figcaption> <span class="figure-number">Figure 1: </span>Invoking  <code>org-tree-slide-mode</code> runs  <code>org-tree-slide-play-hook</code>, a list of functions meant to run when a slide show is started in  <code>org-tree-slide-mode</code>. In this case, the hook makes the text larger and centered in the buffer.</figcaption></figure></div>
</div>
</div>
 <div id="outline-container-org063c69f" class="outline-2">
 <h2 id="org063c69f">How do hooks work?</h2>
 <div class="outline-text-2" id="text-org063c69f">
 <p>
First, a quick glossary of terms:
</p>
 <ul class="org-ul"> <li>a  <b>hook</b> is a variable defining a list of functions. These variables typically end in  <code>-hook</code>, such as  <code>org-mode-hook</code>. Hooks may also end in  <code>-functions</code>; these so-called "abnormal hooks" are not the focus of this post. Still, if you're searching for hooks, it is good to know that this pattern exists.</li>
 <li>a  <b>hook function</b> is one of the functions that comprise the hook.</li>
 <li>There are  <i>normal</i> and  <i>abnormal</i> hooks. Most hooks are normal. For the purposes of this post, I am focusing on  <i>normal hooks</i>. In a normal hook, none of the hook functions take any arguments, and emacs calls each hook function in the list sequentially. Abnormal hooks may take arguments or exhibit other behaviors when called that require special attention/documentation.</li>
</ul> <p>
Hooks are run when specific functions call them. Such functions are often called at specific points in the initialization or use of emacs modes, but they are not limited to those circumstances. Here is a minimal example.
</p>
</div>
 <div id="outline-container-org5747275" class="outline-3">
 <h3 id="org5747275">Hooks Example</h3>
 <div class="outline-text-3" id="text-org5747275">
 <p>
First, we'll define the hook variable. This is the same as defining any other variable.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">( <span class="org-keyword">setq</span> my-example-hook nil)
</pre>
</div>

 <p>
Next, we'll add some hooks to this variable. These will just be simple functions that print some output.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">( <span class="org-keyword">defun</span>  <span class="org-function-name">hook-function-1</span> ()
  (message  <span class="org-string">"Output of the first hook function"</span>))

( <span class="org-keyword">defun</span>  <span class="org-function-name">hook-function-2</span> ()
  (message  <span class="org-string">"Output of the second hook function"</span>))


(add-hook 'my-example-hook 'hook-function-1)
(add-hook 'my-example-hook 'hook-function-2)
</pre>
</div>

 <p>
Now, if we inspect  <code>my-example-hook</code> (with  <code>C-h v my-example-hook</code>), we see:
</p>

 <p>
 <code>my-example-hook’s value is (hook-function-2 hook-function-1)</code>
</p>

 <p>
Now we can run the hook with the  <code>run-hooks</code> function.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">(run-hooks 'my-example-hook)
</pre>
</div>


 <p>
Which prints the following to the messages buffer:
</p>

 <pre class="example">
Output of the second hook function
Output of the first hook function
</pre>



 <p>
There are three key components to pay attention to in this example:
</p>
 <ol class="org-ol"> <li>The hook variable  <code>my-example-hook</code>. We use  <code>add-hook</code> to populate this variable with hook functions.</li>
 <li>The hook functions  <code>hook-function-1</code> and  <code>hook-function-2</code>. These functions, intended for use in a normal hook, take no arguments.</li>
 <li>The function that runs the hook; in this case  <code>run-hooks</code>. There are a few different functions for running hooks. The  <code>run-mode-hooks</code> function, for example, is specialized to the case of running mode hooks, or hooks that are associated with initializing a mode (e.g.  <code>prog-mode-hook</code>).</li>
</ol> <p>
There's nothing especially unique about any of these components. We assign the variable in (1) a name ending in  <code>-hook</code> by convention, but it works the same with any name. The hook functions defined in (2) are normal functions; the one noteworthy point is that they  <i>take no arguments</i>. The function in (3) is a built-in standard function in Emacs Lisp designed for running hook functions.
</p>

 <div class="org-center">

 <figure> <img src="./figures/20231217-emacs-hooks/hooks-diagram-2.png" alt="hooks-diagram-2.png"></img> <figcaption> <span class="figure-number">Figure 2: </span>Diagram of the basic process of working with normal hooks</figcaption></figure></div>
</div>
</div>
</div>

 <div id="outline-container-org6cf4759" class="outline-2">
 <h2 id="org6cf4759">Mode Hooks</h2>
 <div class="outline-text-2" id="text-org6cf4759">
 <p>
Hooks are most commonly encountered in the context of modes. Modes generally define hooks to which users can add functions that will be called at the end of the mode's initialization. For example, I wanted to display line numbers whenever I was in a buffer with code, so I have the following line in my config:
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">(add-hook 'prog-mode-hook 'display-line-numbers-mode)
</pre>
</div>

 <p>
Inspecting the hook shows:
</p>

 <blockquote>
 <p>
prog-mode-hook is a variable defined in ‘prog-mode.el’.
</p>

 <p>
Its value is (outline-minor-mode display-line-numbers-mode)
Original value was nil
</p>

 <p>
Normal hook run when entering programming modes.
</p>

 <p>
This variable may be risky if used as a file-local variable.
You can customize this variable.
Probably introduced at or before Emacs version 24.1.
</p>
</blockquote>

 <p>
and, indeed, when I open an e.g. Python buffer, line numbers appear as desired.
</p>
</div>
</div>
 <div id="outline-container-org8cb8ffd" class="outline-2">
 <h2 id="org8cb8ffd">Appendix: Hooks in use-package</h2>
 <div class="outline-text-2" id="text-org8cb8ffd">
 <p>
I use  <code>use-package</code> for managing my emacs packages.  <code>use-package</code> declarations allow users to pass a  <code>:hooks</code> option in the package declaration in order to add functions to hooks. Hooks can be configured in  <code>use-package</code> by defining a cons cell as follows.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">(use-package package-name
   <span class="org-builtin">:hook</span>
  ('mode-name . 'function-to-add-to-hook)
  )
</pre>
</div>

 <p>
Note that we do  <i>not</i> refer to  <code>mode-name-hook</code> in the hook configuration.  <code>use-package</code> adds the  <code>-hook</code> automatically by default. The above will add  <code>function-to-add-to-hook</code> to  <code>mode-name-hook</code>.
</p>
</div>
</div>
 <div id="outline-container-org2a14c95" class="outline-2">
 <h2 id="org2a14c95">Further Reading</h2>
 <div class="outline-text-2" id="text-org2a14c95">
 <ul class="org-ul"> <li> <a href="https://gitlab.com/dliden/coffeemacs">My Emacs config</a>. This has not, admittedly, been structured for broad consumption, but with a little searching you can find how I've configured some hooks. In particular,  <a href="https://gitlab.com/dliden/coffeemacs/-/blob/master/orgconfig.el?ref_type=heads#L219">here</a> is my  <code>org-tree-slide</code> configuration, which I mentioned at the beginning.</li>
 <li> <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Hooks.html">Emacs Docs</a>, which go into some more detail on abnormal hooks among other topics.</li>
</ul></div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20231217-emacs-hooks.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20231217-emacs-hooks.html</guid>
  <pubDate>Sun, 17 Dec 2023 08:00:00 +0000</pubDate>
</item>
<item>
  <title>YASnippet for Prompt Templates for Chatgpt-Shell</title>
  <description><![CDATA[<div id="content">
 <div id="outline-container-orgdc411a9" class="outline-2">
 <h2 id="orgdc411a9">Introduction</h2>
 <div class="outline-text-2" id="text-orgdc411a9">
 <div class="preview">
 <p>
The wonderful  <a href="https://github.com/xenodium/chatgpt-shell">chatgpt-shell</a> package by  <a href="https://github.com/xenodium">Xenodium</a> lets you interact with the gpt-3.5 and gpt-4
APIs in emacs via a handy shell built on top of  <code>comint-mode</code>. It also integrates
well with  <code>org-mode</code>.
</p>

 <p>
I find that I tend to re-use a few prompt patterns for specific tasks. Yasnippet provides a great
way to create prompt  <i>templates</i> made up of some fixed component with placeholders
for user input. I can easily insert these prompt templates when working with
 <code>chatgpt-shell</code> to gain easy access to reusable, task-specific prompts. This post
describes how to start using Yasnippet for prompt templates for use with
 <code>chatgpt-shell</code>.
</p>

</div>
</div>
</div>
 <div id="outline-container-orge9375ef" class="outline-2">
 <h2 id="orge9375ef">Setting up ChatGPT Shell</h2>
 <div class="outline-text-2" id="text-orge9375ef">
 <p>
First of all, if you haven't already tried  <code>chatgpt-shell</code>, it's worth taking a
few minutes to set up and try out. If you live in emacs, you'll probably prefer
 <code>chatgpt-shell</code> to the chatgpt web interface.
</p>

 <p>
You can find the installation instructions  <a href="https://github.com/xenodium/chatgpt-shell#install">here</a>. I use straight.el for package
management, and here is my configuration:
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">(use-package shell-maker
   <span class="org-builtin">:straight</span> ( <span class="org-builtin">:host</span> github  <span class="org-builtin">:repo</span>  <span class="org-string">"xenodium/chatgpt-shell"</span>  <span class="org-builtin">:files</span> ( <span class="org-string">"shell-maker.el"</span>)
                    <span class="org-builtin">:branch</span>  <span class="org-string">"main"</span>))

(use-package chatgpt-shell
   <span class="org-builtin">:after</span> (shell-maker)
   <span class="org-builtin">:straight</span> ( <span class="org-builtin">:host</span> github  <span class="org-builtin">:repo</span>  <span class="org-string">"xenodium/chatgpt-shell"</span>  <span class="org-builtin">:files</span> ( <span class="org-string">"chatgpt-shell.el"</span>)
                    <span class="org-builtin">:branch</span>  <span class="org-string">"main"</span>)
   <span class="org-builtin">:config</span>
  ( <span class="org-keyword">setq</span> chatgpt-shell-openai-key
      ( <span class="org-keyword">lambda</span> ()
        (auth-source-pick-first-password  <span class="org-builtin">:host</span>  <span class="org-string">"api.openai.com"</span>))))

(use-package ob-chatgpt-shell
   <span class="org-builtin">:straight</span> ( <span class="org-builtin">:host</span> github  <span class="org-builtin">:repo</span>  <span class="org-string">"xenodium/chatgpt-shell"</span>  <span class="org-builtin">:files</span> ( <span class="org-string">"ob-chatgpt-shell.el"</span>)
                    <span class="org-builtin">:branch</span>  <span class="org-string">"main"</span>)
   <span class="org-builtin">:ensure</span> t )
</pre>
</div>

 <p>
 <code>chatgpt-shell</code> is built on  <code>shell-maker</code>, which is "a way to create shells for any
service (local or cloud)."  <code>ob-chatgpt-shell</code> provides a way to interact with
 <code>chatgpt-shell</code> via org babel source blocks. For more details on these, read the
 <a href="https://github.com/xenodium/chatgpt-shell">documentation</a> (and consider  <a href="https://github.com/sponsors/xenodium">sponsoring</a> Xenodium).
</p>
</div>
</div>
 <div id="outline-container-org0b052c1" class="outline-2">
 <h2 id="org0b052c1">YASnippet</h2>
 <div class="outline-text-2" id="text-org0b052c1">
 <p>
 <a href="https://github.com/joaotavora/yasnippet">YASnippet</a> is a template system for emacs. It is very powerful, and I'm only
familiar with a small fraction of its capabilities. But when I work with
ChatGPT in other systems, I almost always use some form of templating
system. What does that mean? Suppose I'm working on some kind of text
summarization system. On the one hand, I could write a bunch of separate prompts
of the form:
</p>

 <blockquote>
 <p>
Summarize the following text:
<some text>
</p>

 <p>
Summarize the following text:
<some more text>
</p>

 <p>
Summarize the following text:
<even more text>
</p>
</blockquote>

 <p>
But the instruction, "Summarize the following text," is the same each time. So
I'd rather put that in a template, which I can fill in as many times as needed
with the part of the prompt that actually changes: the prompt to summarize.
</p>

 <p>
This might look like:
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">
( <span class="org-keyword">defun</span>  <span class="org-function-name">summary_template</span> (text_to_summarize)
  ( <span class="org-keyword">interactive</span>  <span class="org-string">"sText to Summarize: "</span>)
  (concat  <span class="org-string">"Summarize the following text:\n"</span> text_to_summarize))

(print (summary_template  <span class="org-string">"Some text"</span>))
(print (summary_template  <span class="org-string">"Some more text"</span>))
(print (summary_template  <span class="org-string">"Even more text"</span>))
</pre>
</div>

 <pre class="example">

"Summarize the following text:
Some text"

"Summarize the following text:
Some more text"

"Summarize the following text:
Even more text"
</pre>


 <p>
YASnippet provides an easy way for us to define and populate templates for use
in  <code>chatgpt-shell</code> buffers.
</p>
</div>
 <div id="outline-container-org5e52f07" class="outline-3">
 <h3 id="org5e52f07">Defining a Snippet</h3>
 <div class="outline-text-3" id="text-org5e52f07">
 <p>
First, you'll need to  <a href="https://github.com/joaotavora/yasnippet/blob/master/README.mdown#installation">install YASnippet</a>.
</p>

 <p>
We can define a new snippet with  <code>M-x yas-new-snippet</code>. This will open a new
buffer for defining out snippet.
</p>

 <div class="org-center">

 <figure> <img src="./figures/20230709-yasnippet-chatgpt-shell/yas-new-snippet.png" alt="yas-new-snippet.png"></img> <figcaption> <span class="figure-number">Figure 1: </span>YASnippet new snippet interface</figcaption></figure></div>

 <p>
In this example, I'm only going to show how to make templates with text and
placeholders. YASnippet is incredibly powerful and supports highly complex
templates;  <a href="https://joaotavora.github.io/yasnippet/">read the documentation</a> if you want to explore further. For now, let's
just replicate the summarization template.
</p>

 <p>
We'll mostly use  <i>tab stop fields</i> and  <i>placeholder fields</i> when building our
templates. You can read more about them, and about more advanced templating,
 <a href="https://joaotavora.github.io/yasnippet/snippet-development.html">here</a>.
</p>

 <p>
Here's what a summarization snippet might look like:
</p>

 <pre class="example">
# -*- mode: snippet -*-
# name: Concise Summary
# key: gptsum
# contributor: Daniel Liden
# --
<text>$1</text>

Provide a concise summary of the above text within <text> tags.
$0
</pre>

 <p>
The  <code>$1</code> and  <code>$0</code> are called  <i>tab stop fields</i>. When inserting the snippet with
e.g.  <code>yas-insert-snippet</code> or by triggering  <a href="https://joaotavora.github.io/yasnippet/snippet-expansion.html">snippet expansion</a>, you can
interactively  <code>TAB</code> and  <code>S-TAB</code> back and forth through the various tab stop fields,
filling them in with whatever you want. In this case, you could type/yank a text
to summarize in the  <code>$1</code> position.
</p>

 <p>
 <code>$0</code> has a special meaning: it is the  <i>exit point</i>, the place the cursor ends up
after completing all of the other tab stop fields.
</p>

 <p>
If you want a default value for a given completion field, you can use a
 <i>placeholder</i>, which is formatted as  <code>${N:default value}</code>. We might modify the above
snippet, for example, to say:
</p>

 <pre class="example">
# -*- mode: snippet -*-
# name: Concise Summary
# key: gptsum
# contributor: Daniel Liden
# --
<text>${1:The user forgot to include text to summarize. Remind them!}</text>

Provide a concise summary of the above text within <text> tags.
$0
</pre>

 <p>
Once you've defined the snippet in the  <code>yas-new-snippet</code> buffer, you can save it
with  <code>C-c C-c</code>. You will then be prompted to choose a "table." This essentially
means specifying the emacs mode with which you'd like the snippet to be
associated. In this case, for  <code>chatgpt-shell</code>, it's  <code>chatgpt-shell-mode</code>. Specifying
the mode ensures the snippet will be available when you're in
 <code>chatgpt-shell-mode</code>. You will also be asked whether you want to save the snippet;
go ahead and do so if you intend to use it in the future.
</p>

 <p>
To modify a snippet, you can use  <code>yas-visit-snippet-file</code>, make changes, and again
go through the saving dialogue with  <code>C-c C-c</code>.
</p>
</div>
</div>

 <div id="outline-container-orgee7a2b0" class="outline-3">
 <h3 id="orgee7a2b0">Using a Snippet</h3>
 <div class="outline-text-3" id="text-orgee7a2b0">
 <p>
Note that, in the example snippets above, I've defined a  <code>key</code>: this is for
 <a href="https://joaotavora.github.io/yasnippet/snippet-expansion.html">snippet expansion</a> (follow the link for more details). With my configuration, in
a  <code>chatgpt-shell-mode</code> buffer, I can type  <code>gptsum</code> followed by  <code>TAB</code> to insert this
snippet. Alternately, I can select from all available snippets with  <code>M-x
yas-insert-snippet</code>.
</p>

 <p>
Upon inserting the snippet, my cursor will be at the first tab stop. I can then
insert whatever text I want. Upon hitting  <code>TAB</code>, the cursor will jump to the next
tab stop. In this case, there was only one, so the cursor will jump to the  <code>$0</code>
position at the end of the prompt.
</p>

 <div class="org-center">

 <figure> <img src="./figures/20230709-yasnippet-chatgpt-shell/text_summarize_snippet.gif" alt="text_summarize_snippet.gif"></img> <figcaption> <span class="figure-number">Figure 2: </span>Inserting a Snippet</figcaption></figure></div>

 <p>
With multiple tab stops (e.g.  <code>$1</code>,  <code>$2</code>, etc.), pressing  <code>TAB</code> multiple times would
move forward through each position, allowing you to fill in the desired
text.  <code>S-TAB</code> enables you to move backward through the tab stops.
</p>
</div>
</div>
 <div id="outline-container-org05f6a4f" class="outline-3">
 <h3 id="org05f6a4f">Inserting the Last Item in the Kill Ring</h3>
 <div class="outline-text-3" id="text-org05f6a4f">
 <p>
We're unlike to ever need to summarize text that we manually type into a
 <code>chatgpt-shell</code>. But we might want to copy some text to the kill ring and ask for
a summary, or copy some code and ask for an explanation. We can write a template
to accomplish this.
</p>

 <p>
We'll use one more advanced feature of  <code>YASnippet</code> to accomplish this: we can
embed Emacs-lisp code in a snippet by enclosing it in backticks ( <code>``</code>).
</p>

 <p>
Here's a snippet for explaining code by pasting (yanking) the most recent text
from the kill ring:
</p>

 <pre class="example">
# key: gptce
# name: code-explainer
# --
Explain the following code:
`(yank)`

In particular:
- Step-by-step, what does it do?
- What are the parameters?
- Are there any other noteworthy features of this code?

Answer concisely.
$0
</pre>

 <p>
To use this template, you would first copy or kill some code from a buffer, then
navigate to your  <code>chatgpt-shell</code> buffer, then insert the snippet. The  <code>`(yank)`</code>
part will automatically be replaced by the copied code.
</p>



 <div class="org-center">

 <figure> <img src="./figures/20230709-yasnippet-chatgpt-shell/code_explain.gif" alt="code_explain.gif"></img> <figcaption> <span class="figure-number">Figure 3: </span>Inserting from the Kill Ring</figcaption></figure></div>
</div>
</div>
</div>
 <div id="outline-container-org3a18fc2" class="outline-2">
 <h2 id="org3a18fc2">Next Steps</h2>
 <div class="outline-text-2" id="text-org3a18fc2">
 <p>
There's a lot more to explore here. YASnippet is a very powerful templating
system, and I've only scratched the surface of the ways to use it for developing
useful prompt templates for  <code>chatgpt-shell</code> (and I haven't tried any for the org
babel integration yet). Read the YASnippet manual, write some new snippets, and
let me know what you come up with!
</p>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20230709-yasnippet-chatgpt-shell.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20230709-yasnippet-chatgpt-shell.html</guid>
  <pubDate>Sun, 09 Jul 2023 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Writing on AI and Postgres</title>
  <description><![CDATA[<div id="content">
 <div id="outline-container-org39efd93" class="outline-2">
 <h2 id="org39efd93">Background</h2>
 <div class="outline-text-2" id="text-org39efd93">
 <div class="preview">
 <p>
Since this start of this year, I've been working on and writing about AI tools
for working with Postgres databases. Most of this work has involved finding
different ways to integrate ChatGPT (and previously Codex) with other tools and
workflows. I wanted to collect and share some of that writing here, as it's
related to a lot of the other things I write about on my personal blog.
</p>

</div>
</div>
</div>


 <div id="outline-container-orge577c3c" class="outline-2">
 <h2 id="orge577c3c"> <a href="https://innerjoin.bit.io/making-a-production-llm-prompt-for-text-to-sql-translation-b798b6e94783">Making a Production LLM Prompt for Text-to-SQL Translation</a></h2>
 <div class="outline-text-2" id="text-orge577c3c">
 <p>
This article introduces our work on AI+databases. Our original goal was simple:
make a great natural language to SQL translation system. This article talks
about some of the challenges and opportunities in that area and introduces a
 <a href="https://github.com/bitdotioinc/pg-text-query/tree/liden/test_suite/playground">Streamlit app</a> we put together for testing text-to-SQL translation prompts.
</p>
</div>
</div>
 <div id="outline-container-org1a04ebc" class="outline-2">
 <h2 id="org1a04ebc"> <a href="https://innerjoin.bit.io/make-chatgpt-stop-chatting-and-start-writing-sql-fd5560049ae4">Make ChatGPT Stop Chatting and Start Writing SQL</a></h2>
 <div class="outline-text-2" id="text-org1a04ebc">
 <p>
I wrote this article after the ChatGPT API was released. We started by using the
Codex code completion models but the much lower price of  <code>gpt-3.5-turbo</code> made a
compelling case for switching to ChatGPT. This proved to be a timely article:
shortly after we published this article, OpenAI announced that they were
discontinuing the Codex model. This article provides a useful guide for using
ChatGPT to get much of the same functionality.
</p>
</div>
</div>
 <div id="outline-container-org839a4d7" class="outline-2">
 <h2 id="org839a4d7"> <a href="https://innerjoin.bit.io/llm-sql-translation-prompt-testing-part-1-comparing-chatgpt-to-codex-78da57213ebe">LLM Prompt Testing Part 1: Comparing ChatGPT to Codex</a></h2>
 <div class="outline-text-2" id="text-org839a4d7">
 <p>
This article presents a simple suite of text-to-SQL translations and compares
the performance of the Codex and ChatGPT models.
</p>
</div>
</div>
 <div id="outline-container-orgc852f3f" class="outline-2">
 <h2 id="orgc852f3f"> <a href="https://innerjoin.bit.io/use-llms-with-other-tools-for-better-sql-translation-21e35de8f03e">Use LLMs with Other Tools for Better SQL Translation</a></h2>
 <div class="outline-text-2" id="text-orgc852f3f">
 <blockquote>
 <p>
The Unix Philosophy considers text streams a universal interface, and emphasizes
the composability of processes that act on text streams. This is what LLMs do:
they act on and return text streams.
</p>
</blockquote>

 <p>
This article urges readers to think of how LLMs might interface with other
tools. As shown by projects such as LangChain and AutoGPT, their usefulness is
multiplied when they are integrated with other projects and tools, not just used
for chatting.
</p>
</div>
</div>
 <div id="outline-container-org035bc8d" class="outline-2">
 <h2 id="org035bc8d"> <a href="https://innerjoin.bit.io/vector-similarity-search-in-postgres-with-bit-io-and-pgvector-c58ac34f408b">Vector Similarity Search in Postgres with bit.io and pgvector</a></h2>
 <div class="outline-text-2" id="text-org035bc8d">
 <p>
In this article, I briefly show how to use the  <code>pgvector</code> Postgres extension for
semantic search. I exported all of bit.io's docs to a Postgres database, created
vector embeddings from the docs, and showed how to use  <code>pgvector</code> to query the
embeddings. Then I used ChatGPT to generate summaries from the results of
semantic search applied to the docs.
</p>
</div>
</div>
 <div id="outline-container-org6ee6ace" class="outline-2">
 <h2 id="org6ee6ace"> <a href="https://innerjoin.bit.io/pre-classify-tasks-for-better-chatgpt-completions-f197ad01618c">Pre-Classify Tasks for Better ChatGPT Completions</a></h2>
 <div class="outline-text-2" id="text-org6ee6ace">
 <p>
In my most recent article, I described how we used a two-step process to
generate API calls using ChatGPT. We first used ChatGPT to identify the  <i>task</i>
that the user wanted to complete, and then we combined the user prompt with a
task-specific prompt to generate API call completions. The task-specific prompt
left much less room for error and resulted in better completion quality.
</p>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20230428-ai-db-writing.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20230428-ai-db-writing.html</guid>
  <pubDate>Thu, 01 Jun 2023 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Using the ChatGPT API with Julia Part 2: Defining a Chat Struct</title>
  <description><![CDATA[<div id="content">
 <div class="preview">
 <p>
One of the things that makes working with the ChatGPT API a little different
from working with, e.g., the  <code>davinci-text-003</code> model api is the need to maintain
the history of a given chat session. A Julia  <code>Struct</code> containing the chat
history, coupled with a function that acts on that Struct, provides a good way
to work with the ChatGPT API.
</p>

 <p>
For the basics of working with the ChatGPT API, check out  <a href="20230303-chatgpt-julia.html">part 1</a>.
</p>

</div>

 <div id="outline-container-org0fdc334" class="outline-2">
 <h2 id="org0fdc334">Defining the Struct</h2>
 <div class="outline-text-2" id="text-org0fdc334">
 <p>
A  <code>struct</code>, also referred to as a  <a href="https://docs.julialang.org/en/v1/manual/types/#Composite-Types">composite type</a>, is "a collection of named
fields, an instance of which can be treated as a single value." By default,
structs are immutable: they can't be modified after construction. This doesn't
work for our use case because want to keep adding messages as the chat
continues. So we'll use a  <code>mutable struct</code>.
</p>

 <p>
One obvious question: what should the named fields of the struct be? Should the
struct define all of the behavior of the model (e.g. model choice, parameters
such as  <code>temperature</code> and  <code>max_tokens</code>, etc.)? Or should it narrowly contain the
message comprising the chat?
</p>

 <p>
I think the latter approach makes the most sense. It's possible to change model
parameters, and even the model itself, mid-chat. They are features of  <i>what we
are doing to the chat</i>, not of the chat itself.
</p>

 <p>
With that in mind, here is a possible approach to a  <code>struct</code> for ChatGPT.
</p>

 <div class="org-src-container">
 <pre class="src src-julia"> <span class="org-string">"""</span>
 <span class="org-string">    struct Chat</span>

 <span class="org-string">Represents a conversation between a user and a chatbot powered by OpenAI's GPT.</span>

 <span class="org-string"># Fields</span>

 <span class="org-string">- `messages::Array{Dict{String, String}}`: An array of dictionaries representing the chat messages.</span>

 <span class="org-string"># Constructors</span>

 <span class="org-string">- `Chat(system_message::String="You are a helpful assistant")`: Create a new `Chat` object with a single system message.</span>

 <span class="org-string"># Example</span>

 <span class="org-string">```julia</span>
 <span class="org-string">chat = Chat("You are a helpful assistant.")</span>
 <span class="org-string">```</span>
 <span class="org-string">This creates a new Chat object with a single message representing the system message "You are a helpful assistant.".</span>
 <span class="org-string">"""</span>
 <span class="org-keyword">mutable struct</span>  <span class="org-type">Chat</span>
    messages:: <span class="org-type">Array</span>{Dict{String, String}}
    
     <span class="org-keyword">function</span>  <span class="org-function-name">Chat</span>(system_message= <span class="org-constant">nothing</span>)
         <span class="org-keyword">if</span> isnothing(system_message)
            system_message =  <span class="org-string">"You are a helpful assistant"</span>
         <span class="org-keyword">end</span>
        messages = [Dict( <span class="org-string">"role"</span> =>  <span class="org-string">"system"</span>,  <span class="org-string">"content"</span> => system_message)]
        new(messages)
     <span class="org-keyword">end</span>
 <span class="org-keyword">end</span>
</pre>
</div>

 <p>
This struct includes an  <i>inner constructor</i>.  <a href="https://docs.julialang.org/en/v1/manual/constructors/#man-inner-constructor-methods">Inner Constructor Methods</a> allow for
the construction of self-referential objects. In this case, we want to be able
to Initialize an instance of  <code>Chat</code> with just the system message: we don't want
to require the user to provide the whole  <code>messages</code> array. That's where the
self-referential part comes in. The inner constructor method takes an argument,
 <code>system_message</code>, nests it in a properly-formatted array of dictionaries, and,
using the  <code>new</code> function, creates a new instance of the  <code>Chat</code> struct with the
 <code>messages</code> array constructed from the  <code>system_message</code>.
</p>

 <p>
We can now make a new chat instance, initialized with a system message, with:
</p>

 <div class="org-src-container">
 <pre class="src src-julia">julia_helper = Chat( <span class="org-string">"You are a helpful assistant who knows a lot about writing Julia code"</span>)
</pre>
</div>

 <pre class="example">
Chat([Dict("role" => "system", "content" => "You are a helpful assistant who knows a lot about writing Julia code")])
</pre>


 <p>
Now that we have a method for keeping track of the chat history, we need to be
able to act on it. For that, we'll define a function.
</p>
</div>
</div>

 <div id="outline-container-orge52439b" class="outline-2">
 <h2 id="orge52439b">Defining the function</h2>
 <div class="outline-text-2" id="text-orge52439b">
 <p>
The purpose of this function is to:
</p>
 <ol class="org-ol"> <li>Get a prompt from the user</li>
 <li>Append that prompt to a  <code>Chat</code> instance's  <code>messages</code> array</li>
 <li>Query the ChatGPT API with the  <code>messages</code> array, possibly with some parameters
specifying e.g. the specific model to use, temperature, etc.</li>
 <li>Append the API response message to the  <code>Chat</code> instance's  <code>messages</code> array</li>
 <li>Return the API response.</li>
</ol> <p>
This function acts on the  <code>Chat</code> type. It modifies an instance of  <code>Chat</code> in
place. Here's the function:
</p>

 <div class="org-src-container">
 <pre class="src src-julia"> <span class="org-string">"""</span>
 <span class="org-string">    chat!(chat, message::String, api_key=ENV["OPENAI_API_KEY"]; kwargs...)</span>

 <span class="org-string">Add a new message to the chat history and get a response from the OpenAI GPT-3 API.</span>

 <span class="org-string"># Arguments</span>

 <span class="org-string">- `chat`: A `Chat` object representing the chat history.</span>
 <span class="org-string">- `message`: A string representing the user's message.</span>
 <span class="org-string">- `api_key::String=ENV["OPENAI_API_KEY"]`: Your OpenAI API key. If not provided, the function will attempt to get it from the `OPENAI_API_KEY` environment variable.</span>
 <span class="org-string">- `kwargs...`: Any additional keyword arguments to pass as part of the API request body.</span>

 <span class="org-string"># Returns</span>

 <span class="org-string">A string representing the response from the chatbot.</span>

 <span class="org-string"># Example</span>

 <span class="org-string">```julia</span>
 <span class="org-string">chat = Chat("You are a helpful assistant")</span>
 <span class="org-string">response = chat!(chat, "How are you?")</span>
 <span class="org-string">```</span>

 <span class="org-string">This adds a new message to the Chat object chat, representing the user's message "How are you?", and gets a response from the OpenAI ChatGPT API. The response from the chatbot is returned as a string in the response variable.</span>
 <span class="org-string">"""</span>
 <span class="org-keyword">function</span>  <span class="org-function-name">chat!</span>(chat:: <span class="org-type">Chat</span>, message:: <span class="org-type">String</span>, api_key=ENV[ <span class="org-string">"OPENAI_API_KEY"</span>]; kwargs...)
     <span class="org-keyword">if</span> isnothing(api_key)
        error( <span class="org-string">"API key is required"</span>)
     <span class="org-keyword">end</span>
    headers = HTTP.Headers([
         <span class="org-string">"Authorization"</span> =>  <span class="org-string">"Bearer $api_key"</span>,
         <span class="org-string">"Content-Type"</span> =>  <span class="org-string">"application/json"</span>,
    ])

    formatted_query = Dict( <span class="org-string">"role"</span> =>  <span class="org-string">"user"</span>,  <span class="org-string">"content"</span> => message)

    messages = push!(chat.messages, formatted_query)

     <span class="org-comment-delimiter"># </span> <span class="org-comment">Merge the default and keyword parameters</span>
    params = merge(Dict( <span class="org-string">"model"</span> =>  <span class="org-string">"gpt-3.5-turbo"</span>,  <span class="org-string">"messages"</span> => messages), kwargs)

     <span class="org-comment-delimiter"># </span> <span class="org-comment">Convert the parameters to JSON</span>
    body = json(params)

     <span class="org-comment-delimiter"># </span> <span class="org-comment">Make a POST request to the OpenAI API endpoint with the query as data</span>
    response = HTTP.post(
         <span class="org-string">"https://api.openai.com/v1/chat/completions"</span>,
        headers,
        body;
        verbose =  <span class="org-constant">false</span>,
    )

     <span class="org-comment-delimiter"># </span> <span class="org-comment">Parse the response body as JSON</span>
    result = JSON.parse(String(response.body))

     <span class="org-comment-delimiter"># </span> <span class="org-comment">Append the response to chat.messages</span>
    push!(chat.messages, result[ <span class="org-string">"choices"</span>][1][ <span class="org-string">"message"</span>])

     <span class="org-comment-delimiter"># </span> <span class="org-comment">Return the text field of the result as a string</span>
     <span class="org-keyword">return</span> result[ <span class="org-string">"choices"</span>][1][ <span class="org-string">"message"</span>][ <span class="org-string">"content"</span>]
 <span class="org-keyword">end</span>
</pre>
</div>

 <p>
A quick note about the function name: According to the  <a href="https://docs.julialang.org/en/v1/manual/style-guide/#bang-convention">Julia style guide</a>, we append  <code>!</code>
to the names of functions that modify their arguments.  <a href="https://docs.julialang.org/en/v1/manual/style-guide/#Write-functions-with-argument-ordering-similar-to-Julia-Base">Furthermore</a>, inputs that
are mutated go before inputs that are not mutated in a function's argument
list. The  <code>chat</code> function follows both of these conventions.
</p>
</div>
</div>
 <div id="outline-container-orgf8728f7" class="outline-2">
 <h2 id="orgf8728f7">Giving it a Try</h2>
 <div class="outline-text-2" id="text-orgf8728f7">
 <p>
So, does it work? Let's try it out.
</p>

 <div class="org-src-container">
 <pre class="src src-julia">chat!(julia_helper,  <span class="org-string">"What are the main differences between a Julia Struct and a Python Class?"</span>)
</pre>
</div>

 <pre class="example">
""Both Julia `struct` and Python `class` are used for creating custom data types, but there are some differences between them:\n\n1. **Type stability:** One of the most significant differences is that Julia `structs` have a static and immutable type, which makes them more type-stable than Python `classes`. In contrast, Python classes are more dynamic, meaning that their attributes can be modified at runtime.\n\n2. **Performance:** In general, Julia `structs` have better performance than Python `classes` due to its type-stability, just-in-time (JIT) compilation, and parallel processing.\n\n3. **Syntax:** The syntax for defining a Julia `struct` is `struct Name{T<:AbstractType} a::T b::Int end`, while in Python, you define a `class` with `class MyClass: def __init__(self, a, b): self.a = a self.b = b`. \n\n4. **Inheritance:** Both Julia and Python support inheritance, but they have different syntax and behavior. In Julia, you use the keyword ` <: ` to specify that a `struct` is a subtype of another `struct`. In Python, you use parentheses after the class name to indicate which class to inherit from.\n\n5. **Typing:** Julia uses type annotations to specify the type of variables, while Python follows the duck typing philosophy, which means that the type of a variable is determined at runtime based on its behavior.\n\nIn summary, while both Julia `structs` and Python `classes` are flexible and powerful tools for creating custom data types, the main differences lie in their type stability, performance, syntax, inheritance, and typing.""
</pre>


 <p>
And does it "remember" earlier parts of the conversation correctly?
</p>

 <div class="org-src-container">
 <pre class="src src-julia">chat!(julia_helper,  <span class="org-string">"I only have the attention span for Twitter. Summarize in 280 characters."</span>)
</pre>
</div>

 <pre class="example">
"Julia structs & Python classes are used for custom data types but differ in: \n1. Type stability: Julia is static, immutable; Python is dynamic.\n2. Performance: Julia > Python due to type-stability, JIT compilation & parallel processing.\n3. Syntax: structs use \"struct Name{T} a::T end;\" & classes use \"class MyClass: def __init__(self):\".\n4. Inheritance: Julia uses \"<:\" to specify subtypes; Python uses parentheses for inheritance.\n5. Typing: Julia uses type annotation; Python uses duck-typing."
</pre>



 <p>
Well, it's a little longer than I asked for. But clearly we successfully sent
the message history in the second API request.
</p>
</div>
</div>
 <div id="outline-container-org28c9b4f" class="outline-2">
 <h2 id="org28c9b4f">What's next?</h2>
 <div class="outline-text-2" id="text-org28c9b4f">
 <p>
There are a few additional avenues I want to explore, in no particular order:
</p>

 <ol class="org-ol"> <li>What happens if we counterfeit a message history? That is, what if we send a
message history with fake "assistant" messages? Will the assistant mimic the
fake responses?</li>
 <li>Can we make a Julia REPL mode that gives rapid access to a ChatGPT assistant?</li>
 <li>Can we make a (private) replacement for ChatGPT Plus using the ChatGPT API?
It would likely be considerably cheaper. And doing it in Julia would be an
interesting project.</li>
 <li>Can we use the streaming output in Julia? How does that work?</li>
</ol></div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20230310-chatgpt-julia-2.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20230310-chatgpt-julia-2.html</guid>
  <pubDate>Fri, 10 Mar 2023 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Using the ChatGPT API with Julia Part 1: the HTTP.jl Library</title>
  <description><![CDATA[<div id="content">
 <div id="outline-container-orgfb1bd6b" class="outline-2">
 <h2 id="orgfb1bd6b">Introduction</h2>
 <div class="outline-text-2" id="text-orgfb1bd6b">
 <div class="preview">
 <p>
This brief post shows the basics of using the Julia  <code>HTTP</code> library to interact
with the OpenAI ChatGPT API, which was made public a few days ago. This post
will only include the minimum necessary detail for getting started with the
API. Future posts will go into a little more detail on how to send message
histories and engage more interactively with the API.
</p>

</div>
</div>
</div>
 <div id="outline-container-org30f1090" class="outline-2">
 <h2 id="org30f1090">curl Example</h2>
 <div class="outline-text-2" id="text-org30f1090">
 <p>
 <a href="https://platform.openai.com/docs/api-reference/chat/create">Here</a> is the API documentation on OpenAI's website. An example request with  <code>curl</code>
looks like this:
</p>

 <div class="org-src-container">
 <pre class="src src-bash">curl https://api.openai.com/v1/chat/completions  <span class="org-sh-escaped-newline">\</span>
  -H  <span class="org-string">'Content-Type: application/json'</span>  <span class="org-sh-escaped-newline">\</span>
  -H  <span class="org-string">'Authorization: Bearer YOUR_API_KEY'</span>  <span class="org-sh-escaped-newline">\</span>
  -d  <span class="org-string">'{</span>
 <span class="org-string">  "model": "gpt-3.5-turbo",</span>
 <span class="org-string">  "messages": [{"role": "user", "content": "Hello!"}]</span>
 <span class="org-string">}'</span>
</pre>
</div>
</div>
</div>

 <div id="outline-container-org121b314" class="outline-2">
 <h2 id="org121b314">Julia example</h2>
 <div class="outline-text-2" id="text-org121b314">
 <p>
And here's how we can re-create this with the Julia HTTP library:
</p>

 <div class="org-src-container">
 <pre class="src src-julia">OPENAI_API_KEY = ENV[ <span class="org-string">"OPENAI_API_KEY"</span>]

 <span class="org-keyword">using</span> HTTP
 <span class="org-keyword">using</span> JSON

headers = HTTP.Headers([
     <span class="org-string">"Authorization"</span> =>  <span class="org-string">"Bearer $OPENAI_API_KEY"</span>,
     <span class="org-string">"Content-Type"</span> =>  <span class="org-string">"application/json"</span>,
])

body = json(Dict( <span class="org-string">"model"</span> =>  <span class="org-string">"gpt-3.5-turbo"</span>,
                  <span class="org-string">"messages"</span> => [Dict( <span class="org-string">"role"</span> =>  <span class="org-string">"user"</span>,  <span class="org-string">"content"</span> =>  <span class="org-string">"Hello!"</span>)]))


response = HTTP.post(
     <span class="org-string">"https://api.openai.com/v1/chat/completions"</span>,
    headers,
    body;
    verbose =  <span class="org-constant">false</span>,
)

 <span class="org-comment-delimiter"># </span> <span class="org-comment">Parse the response body as JSON</span>
result = JSON.parse(String(response.body))
print(result)
</pre>
</div>

 <pre class="example">
Dict{String, Any}("choices" => Any[Dict{String, Any}("finish_reason" => "stop", "message" => Dict{String, Any}("role" => "assistant", "content" => "\n\nHello there! How may I be of assistance?"), "index" => 0)], "model" => "gpt-3.5-turbo-0301", "usage" => Dict{String, Any}("completion_tokens" => 12, "total_tokens" => 21, "prompt_tokens" => 9), "id" => "chatcmpl-6qMM6OmdVRZ8VtdKgKFtb7aRDYWkF", "object" => "chat.completion", "created" => 1677937010)
</pre>


 <p>
Note that  <code>OPENAI_API_KEY</code> is stored as an environment variable on my system, so I
was able to access it with  <code>OPENAI_API_KEY = ENV["OPENAI_API_KEY"]</code>.
</p>

 <p>
We can extract the completion itself from the "choices" dictionary entry.
</p>

 <div class="org-src-container">
 <pre class="src src-julia">chat_response = result[ <span class="org-string">"choices"</span>]
chat_response[1][ <span class="org-string">"message"</span>][ <span class="org-string">"content"</span>]
</pre>
</div>

 <pre class="example">
"\n\nHello there! How may I be of assistance?"
</pre>
</div>
</div>
 <div id="outline-container-org85ee7ff" class="outline-2">
 <h2 id="org85ee7ff">A little more detail about sending messages</h2>
 <div class="outline-text-2" id="text-org85ee7ff">
 <p>
One of the things that makes ChatGPT useful is its ability to "remember" past
parts of a conversation. We can send whole conversations to the API using the
"messages" part of the request body.  <code>messages</code> is an array of ~Dict~s, each of
which has a "role" and a "content." There are three options for "role":
</p>
 <ol class="org-ol"> <li> <code>system</code>: sets the behavior of the assistant. The  <code>content</code> might be, for
example,  <code>you are a helpful assistant</code> or  <code>you are a very polite customer
   support agent</code> or  <code>you are a senior software engineer in a mentorship role</code>.</li>
 <li> <code>user</code>: The human interacting with ChatGPT.</li>
 <li> <code>assistant</code>: the responses from ChatGPT</li>
</ol> <p>
So we can send a more complete conversation and get some richer details in
response. For example:
</p>

 <div class="org-src-container">
 <pre class="src src-julia">messages=[Dict( <span class="org-string">"role"</span> =>  <span class="org-string">"system"</span>,  <span class="org-string">"content"</span> =>  <span class="org-string">"You are a knowledgable and helpful Julia developer."</span>),
         Dict( <span class="org-string">"role"</span> =>  <span class="org-string">"user"</span>,  <span class="org-string">"content"</span> =>  <span class="org-string">"Can you show me how to make a POST request with the HTTP library?"</span>)]

body = json(Dict( <span class="org-string">"model"</span> =>  <span class="org-string">"gpt-3.5-turbo"</span>,
                  <span class="org-string">"messages"</span> => messages))

response = HTTP.post(
     <span class="org-string">"https://api.openai.com/v1/chat/completions"</span>,
    headers,
    body;
    verbose =  <span class="org-constant">false</span>,
)

 <span class="org-comment-delimiter"># </span> <span class="org-comment">Parse the response body as JSON</span>
result = JSON.parse(String(response.body))
print(result[ <span class="org-string">"choices"</span>][1][ <span class="org-string">"message"</span>][ <span class="org-string">"content"</span>])
</pre>
</div>

 <pre class="example">

```julia
using HTTP

# URL to POST to
url = "https://httpbin.org/post"

# Data to include in the POST request (in JSON format)
data = Dict("name" => "John", "age" => 30)
json_data = JSON.json(data)

# Headers to specify that we're sending JSON data
headers = Dict("Content-Type" => "application/json")

# Make the POST request
response = HTTP.request("POST", url, headers, json_data)

# Get the response body as a string
body = String(response.body)

# Print the response status code and body
println("Status code: $(response.status)")
println("Response body: $body")
```

In this example, we're sending a JSON object with a name and age property to https://httpbin.org/post, which is an HTTP testing service. The `headers` argument specifies that we're sending JSON data, while the `json_data` argument is the actual data we want to send.

The `HTTP.request` function is called with the POST method, the URL to POST to, the headers we want to send, and the data we want to include. The response is then captured in the `response` variable.

Finally, we extract the body of the response as a string using `String(response.body)`, and print both the status code and response body to the console.Yes, I can. Here's an example code snippet that shows how to make a POST request using the HTTP library in Julia:

```julia
using HTTP

url = "https://jsonplaceholder.typicode.com/posts"
data = "{\"title\":\"foo\",\"body\":\"bar\",\"userId\":1}"

response = HTTP.post(url, data, ["Content-Type" => "application/json"])
println(String(response.body))
```

In this example, we first specify the url of the endpoint we want to send our request to. Next, we create a string representation of the JSON data we want to send in our request. We use `HTTP.post()` to send a POST request to the specified url, including the JSON data in the request body, and with a content type header that specifies that the data is JSON (application/json). Finally, we print the response contents converted to a string by the `String()` function.
</pre>

 <p>
And if we want to send a followup referring to an earlier part in the conversation, we can extend the  <code>messages</code> array as follows:
</p>

 <div class="org-src-container">
 <pre class="src src-julia"> <span class="org-comment-delimiter"># </span> <span class="org-comment">include the assistant's previous response</span>
push!(messages, result[ <span class="org-string">"choices"</span>][1][ <span class="org-string">"message"</span>])

 <span class="org-comment-delimiter"># </span> <span class="org-comment">ask a new question referring to an earlier part of the conversation</span>
push!(messages, Dict( <span class="org-string">"role"</span> =>  <span class="org-string">"user"</span>,
                      <span class="org-string">"content"</span> =>  <span class="org-string">"Can you please provide a shorter, simpler example?"</span>))

</pre>
</div>

 <pre class="example">
4-element Vector{Dict{String, String}}:
 Dict("role" => "system", "content" => "You are a knowledgable and helpful Julia developer.")
 Dict("role" => "user", "content" => "Can you show me how to make a POST request with the HTTP library?")
 Dict("role" => "assistant", "content" => "Yes, I can. Here's an example code snippet that shows how to make a POST request using the HTTP library in Julia:\n\n```julia\nusing HTTP\n\nurl = \"https://jsonplaceholder.typicode.com/posts\"\ndata = \"{\\\"title\\\":\\\"foo\\\",\\\"body\\\":\\\"bar\\\",\\\"userId\\\":1}\"\n\nresponse = HTTP.post(url, data, [\"Content-Type\" => \"application/json\"])\nprintln(String(response.body))\n```\n\nIn this example, we first specify the url of the endpoint we want to send our request to. Next, we create a string representation of the JSON data we want to send in our request. We use `HTTP.post()` to send a POST request to the specified url, including the JSON data in the request body, and with a content type header that specifies that the data is JSON (application/json). Finally, we print the response contents converted to a string by the `String()` function.")
 Dict("role" => "user", "content" => "Can you please provide a shorter, simpler example?")
</pre>


 <p>
And then request another response:
</p>

 <div class="org-src-container">
 <pre class="src src-julia">body = json(Dict( <span class="org-string">"model"</span> =>  <span class="org-string">"gpt-3.5-turbo"</span>,
                  <span class="org-string">"messages"</span> => messages))

response = HTTP.post(
     <span class="org-string">"https://api.openai.com/v1/chat/completions"</span>,
    headers,
    body;
    verbose =  <span class="org-constant">false</span>,
)

 <span class="org-comment-delimiter"># </span> <span class="org-comment">Parse the response body as JSON</span>
result = JSON.parse(String(response.body))
print(result[ <span class="org-string">"choices"</span>][1][ <span class="org-string">"message"</span>][ <span class="org-string">"content"</span>])
</pre>
</div>

 <pre class="example">
Sure, here's a simpler example:

```julia
using HTTP

url = "https://jsonplaceholder.typicode.com/posts"

response = HTTP.post(url, form = [("title", "foo"), ("body", "bar"), ("userId", "1")])
println(String(response.body))
```

In this example, we are sending a POST request with form data rather than JSON data. We specify the form data using an array of tuples with the keys and values for the form fields. Note that we use the `form` argument to pass the form data to `HTTP.post()`. The response is then printed in the same way as before.
</pre>
</div>
</div>
 <div id="outline-container-org9605b3f" class="outline-2">
 <h2 id="org9605b3f">Next Up…</h2>
 <div class="outline-text-2" id="text-org9605b3f">
 <p>
This post showed basic usage of the ChatGPT API with Julia. In the next post,
I'll show how to make this more modular and useful. We'll create a  <code>Struct</code> for
conversations and a function to call on the API based on the conversation
history in that  <code>Struct</code>. After that, I'll write about how to make it interactive,
perhaps as a Julia REPL mode, but at least as a command line utility.
</p>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20230303-chatgpt-julia.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20230303-chatgpt-julia.html</guid>
  <pubDate>Sat, 04 Mar 2023 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Using Quarto Files with Denote</title>
  <description><![CDATA[<div id="content">
 <div id="outline-container-org08b4b02" class="outline-2">
 <h2 id="org08b4b02">Custom Filetypes in Denote</h2>
 <div class="outline-text-2" id="text-org08b4b02">
 <div class="PREVIEW">
 <p>
The latest release of  <a href="https://protesilaos.com/emacs/denote">Denote</a> (by the inimitable Protesilaos Stavrou) introduced
support for  <a href="https://protesilaos.com/codelog/2022-10-30-demo-denote-custom-file-type/">custom file types</a> in addition to the defaults, Org, Markdown+YAML,
Markdown+TOML, and plain text. This post shows how to add  <a href="https://quarto.org/">Quarto</a> files
(.qmd). Quarto, the successor to R Markdown, is "an open-source scientific and
technical publishing system" with support for Python, R, Julia, and
Observable. The setup detailed here will allow one to choose the .qmd filetype
when creating a new Denote file.
</p>

</div>

 <p>
Find the code snippet  <a href="#orga2ef568">here</a>.
</p>

 <p>
All the details about creating a custom Denote filetype can be found
 <a href="https://protesilaos.com/codelog/2022-10-30-demo-denote-custom-file-type/">here</a>. First, let's inspect the  <code>denote-file-types</code> alist to understand what a file
type definition looks like.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">(print denote-file-types)
</pre>
</div>

 <pre class="example">
((quarto :extension ".qmd" :date-function denote-date-iso-8601 :front-matter denote-yaml-front-matter :title-key-regexp "^title\\s-*:" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (quarto :extension ".qmd" :date-function denote-date-rfc3339 :front-matter denote-yaml-front-matter :title-key-regexp "^title\\s-*:" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (org :extension ".org" :date-function denote-date-org-timestamp :front-matter denote-org-front-matter :title-key-regexp "^#\\+title\\s-*:" :title-value-function identity :title-value-reverse-function denote-trim-whitespace :keywords-key-regexp "^#\\+filetags\\s-*:" :keywords-value-function denote-format-keywords-for-org-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-org-link-format :link-in-context-regexp denote-org-link-in-context-regexp) (markdown-yaml :extension ".qmd" :date-function denote-date-rfc3339 :front-matter denote-yaml-front-matter :title-key-regexp "^title\\s-*:" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (markdown-toml :extension ".md" :date-function denote-date-rfc3339 :front-matter denote-toml-front-matter :title-key-regexp "^title\\s-*=" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*=" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (text :extension ".txt" :date-function denote-date-iso-8601 :front-matter denote-text-front-matter :title-key-regexp "^title\\s-*:" :title-value-function identity :title-value-reverse-function denote-trim-whitespace :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-text-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-org-link-format :link-in-context-regexp denote-org-link-in-context-regexp))
</pre>


 <p>
We need to add to this list. We can define a new filetype in this alist by
defining a new element of the form  <code>(SYMBOL PROPERTY-LIST)</code>.
</p>

 <p>
Adding a basic quarto file should be very simple. We only need to duplicatge the
markdown file type definition, changing the name to  <code>quarto</code> and the extension to
 <code>".qmd"</code>. We could do this as follows.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">(add-to-list 'denote-file-types
             '(quarto
                <span class="org-builtin">:extension</span>  <span class="org-string">".qmd"</span>
                <span class="org-builtin">:date-function</span> denote-date-iso-8601
                <span class="org-builtin">:front-matter</span> denote-yaml-front-matter
                <span class="org-builtin">:title-key-regexp</span>  <span class="org-string">"^title\\s-*:"</span>
                <span class="org-builtin">:title-value-function</span> denote-surround-with-quotes
                <span class="org-builtin">:title-value-reverse-function</span> denote-trim-whitespace-then-quotes
                <span class="org-builtin">:keywords-key-regexp</span>  <span class="org-string">"^tags\\s-*:"</span>
                <span class="org-builtin">:keywords-value-function</span> denote-format-keywords-for-md-front-matter
                <span class="org-builtin">:keywords-value-reverse-function</span> denote-extract-keywords-from-front-matter
                <span class="org-builtin">:link</span> denote-md-link-format
                <span class="org-builtin">:link-in-context-regexp</span> denote-md-link-in-context-regexp))
</pre>
</div>

 <pre class="example">
((quarto :extension ".qmd" :date-function denote-date-iso-8601 :front-matter denote-yaml-front-matter :title-key-regexp "^title\\s-*:" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (quarto :extension ".qmd" :date-function denote-date-rfc3339 :front-matter denote-yaml-front-matter :title-key-regexp "^title\\s-*:" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (org :extension ".org" :date-function denote-date-org-timestamp :front-matter denote-org-front-matter :title-key-regexp "^#\\+title\\s-*:" :title-value-function identity :title-value-reverse-function denote-trim-whitespace :keywords-key-regexp "^#\\+filetags\\s-*:" :keywords-value-function denote-format-keywords-for-org-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-org-link-format :link-in-context-regexp denote-org-link-in-context-regexp) (markdown-yaml :extension ".qmd" :date-function denote-date-rfc3339 :front-matter denote-yaml-front-matter :title-key-regexp "^title\\s-*:" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (markdown-toml :extension ".md" :date-function denote-date-rfc3339 :front-matter denote-toml-front-matter :title-key-regexp "^title\\s-*=" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*=" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (text :extension ".txt" :date-function denote-date-iso-8601 :front-matter denote-text-front-matter :title-key-regexp "^title\\s-*:" :title-value-function identity :title-value-reverse-function denote-trim-whitespace :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-text-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-org-link-format :link-in-context-regexp denote-org-link-in-context-regexp))
</pre>


 <p>
We can do this more concisely (and learn a litle bit of emacs lisp on the way)
by modifying the  <code>markdown-yaml</code> file type definition.
</p>
</div>
</div>

 <div id="outline-container-orga2ef568" class="outline-2">
 <h2 id="orga2ef568">Modifying the  <code>markdown-yaml</code> file type</h2>
 <div class="outline-text-2" id="text-orga2ef568">
 <p>
As noted, all we're actually doing is changing the file extension in the
existing markdown type. So instead of writing out all of the redundant details,
let's just copy them from the markdown type.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">( <span class="org-keyword">let</span> ((quarto (cdr (assoc 'markdown-yaml denote-file-types))))
  ( <span class="org-keyword">setf</span> (plist-get quarto  <span class="org-builtin">:extension</span>)  <span class="org-string">".qmd"</span>)
  (add-to-list 'denote-file-types (cons 'quarto quarto)))

(print denote-file-types)
</pre>
</div>

 <pre class="example">
((quarto :extension ".qmd" :date-function denote-date-rfc3339 :front-matter denote-yaml-front-matter :title-key-regexp "^title\\s-*:" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (org :extension ".org" :date-function denote-date-org-timestamp :front-matter denote-org-front-matter :title-key-regexp "^#\\+title\\s-*:" :title-value-function identity :title-value-reverse-function denote-trim-whitespace :keywords-key-regexp "^#\\+filetags\\s-*:" :keywords-value-function denote-format-keywords-for-org-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-org-link-format :link-in-context-regexp denote-org-link-in-context-regexp) (markdown-yaml :extension ".qmd" :date-function denote-date-rfc3339 :front-matter denote-yaml-front-matter :title-key-regexp "^title\\s-*:" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (markdown-toml :extension ".md" :date-function denote-date-rfc3339 :front-matter denote-toml-front-matter :title-key-regexp "^title\\s-*=" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*=" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp) (text :extension ".txt" :date-function denote-date-iso-8601 :front-matter denote-text-front-matter :title-key-regexp "^title\\s-*:" :title-value-function identity :title-value-reverse-function denote-trim-whitespace :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-text-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-org-link-format :link-in-context-regexp denote-org-link-in-context-regexp))
</pre>


 <p>
What's actually happening here? Let's go through it step by step.
</p>

 <p>
The  <code>assoc</code> function takes a key and an alist as arguments and returns the first
element of that alist whose CAR is equal to the key. In effect, we're searching
the  <code>denote-file-types</code> alist for the element whose CAR is  <code>markdown-yaml</code>.
</p>
 <div class="org-src-container">
 <pre class="src src-emacs-lisp">(assoc 'markdown-yaml denote-file-types)
</pre>
</div>

 <pre class="example">
(markdown-yaml :extension ".qmd" :date-function denote-date-rfc3339 :front-matter denote-yaml-front-matter :title-key-regexp "^title\\s-*:" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp)
</pre>



 <p>
We only want the CDR of this element (everything but the  <code>markdown-yaml</code> at the
beginning).
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">(cdr (assoc 'markdown-yaml denote-file-types))
</pre>
</div>

 <pre class="example">
(:extension ".qmd" :date-function denote-date-rfc3339 :front-matter denote-yaml-front-matter :title-key-regexp "^title\\s-*:" :title-value-function denote-surround-with-quotes :title-value-reverse-function denote-trim-whitespace-then-quotes :keywords-key-regexp "^tags\\s-*:" :keywords-value-function denote-format-keywords-for-md-front-matter :keywords-value-reverse-function denote-extract-keywords-from-front-matter :link denote-md-link-format :link-in-context-regexp denote-md-link-in-context-regexp)
</pre>



 <p>
We use  <code>let</code> to say that, for the purposes of this procedure, we want to associate
the above plist with the name  <code>quarto</code>.
</p>

 <p>
Next, we need to change the extension from  <code>.md</code> to  <code>.qmd</code>. We use  <code>plist-get</code> to get
the desired property ( <code>:extension</code>) and  <code>setf</code> to set it to  <code>".qmd"</code>.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">( <span class="org-keyword">setf</span> (plist-get (cdr (assoc 'markdown-yaml denote-file-types))  <span class="org-builtin">:extension</span>)  <span class="org-string">".qmd"</span>)
</pre>
</div>

 <pre class="example">
.qmd
</pre>


 <p>
In the end, we add the  <code>quarto</code> plist to the  <code>denote-file-types</code> alist with
 <code>(add-to-list 'denote-file-types (cons 'quarto quarto))</code>. The  <code>cons</code> function
creates a new  <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Cons-Cells.html">cons</a> from a  <code>CAR</code> and a  <code>CDR</code> (in this case,  <code>quarto</code>
and the modified copy of the   <code>markdown-yaml</code> plist with the changed extension).
</p>

 <p>
And with that, we can now create new quarto files with denote!
</p>

 <p>

 <style>
.figure-number {
    display: none;
}
</style></p>


 <figure> <img src="figures/20221217-denote-quarto/quarto_denote.png" alt="quarto_denote.png"></img> <figcaption> <span class="figure-number">Figure 1: </span> <i>Quarto in the Denote Menu!</i></figcaption></figure> <p>
Check out  <a href="https://github.com/quarto-dev/quarto-emacs">quarto-emacs</a> if you're interested in working with quarto files in
emacs (though I have to admit that working with quarto files in RStudio is a joy
and is at least worth a try before commiting to an emacs-only workflow).
</p>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20221217-denote-quarto.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20221217-denote-quarto.html</guid>
  <pubDate>Thu, 22 Dec 2022 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Processing a JSON API Response with jq</title>
  <description><![CDATA[<div id="content">
 <div id="outline-container-orgfa13707" class="outline-2">
 <h2 id="orgfa13707">Introduction</h2>
 <div class="outline-text-2" id="text-orgfa13707">
 <div class="preview">
 <p>
There are countless ways of processing JSON data and converting it to different
formats. Historically, I've used Python and loaded the data into a Pandas
Dataframe for processing. This isn't really necessary for simple tasks,
though. Sometimes, a lightweight command line tool does the job just fine. Enter
 <code>jq</code>.  <a href="https://stedolan.github.io/jq/">jq</a> is "like  <code>sed</code> for JSON data." This post walks through an example of
downloading data from an API, extracting a few fields based on some conditions,
and converting the results to a CSV using  <code>jq</code>.
</p>

</div>

 <p>
In this example, we'll download some data from the Bureau of Labor Statistics
API, apply some minor processing, and save the results as a CSV. More
specifically, we will:
</p>

 <ol class="org-ol"> <li>Download two BLS data series from the BLS API using  <code>curl</code></li>
 <li>Extract a few different variables from different hierarchical levels of the
JSON results using  <code>jq</code></li>
 <li>Save the results as a CSV using  <code>jq</code></li>
</ol> <p>
This mirrors a common Python task in my workflow: I make an API call using the
 <code>requests</code> module, load the JSON results as a Python  <code>dict</code> type with  <code>json.load</code> from
the  <code>json</code> module, and then load the results as a pandas table with
 <code>Pandas.DataFrame.from_dict</code>. There may be more (or fewer) steps depending on the
structure of the API results, but I've repeated this broad pattern many times.
</p>

 <p>
To follow along, begin by  <a href="https://stedolan.github.io/jq/download/">installing jq</a> if you haven't already.
</p>
</div>
</div>

 <div id="outline-container-org6bdcedd" class="outline-2">
 <h2 id="org6bdcedd">Download the Data</h2>
 <div class="outline-text-2" id="text-org6bdcedd">
 <p>
As noted above, we use  <code>curl</code> to make a  <code>POST</code> request agains the BLS API. We're
downloading Consumer Price Index data since the start of 2022. We're downloading
data from two BLS series: one for seasonally adjusted data, and one for
unadjusted data.
</p>

 <div class="org-src-container">
 <pre class="src src-shell">curl -X POST -H  <span class="org-string">'Content-Type: application/json'</span>  <span class="org-sh-escaped-newline">\</span>
     -d  <span class="org-string">'{"seriesid": ["CUUR0000SA0","CUSR0000SA0"], "startyear":2022, "endyear":2022}'</span>  <span class="org-sh-escaped-newline">\</span>
     https://api.bls.gov/publicAPI/v2/timeseries/data/ 
</pre>
</div>

 <pre class="example">
| status":"REQUEST_SUCCEEDED","responseTime":171,"message":[],"Results               |
| series                                                                            |
| seriesID":"CUUR0000SA0","data":[{"year":"2022","period":"M08","periodName":"August", "latest":"true","value":"296.171","footnotes":[{}]},{"year":"2022","period":"M07","periodName":"July","value":"296.276","footnotes":[{}]},{"year":"2022","period":"M06","periodName":"June","value":"296.311","footnotes":[{}]},{"year":"2022","period":"M05","periodName":"May","value":"292.296","footnotes":[{}]},{"year":"2022","period":"M04","periodName":"April","value":"289.109","footnotes":[{}]},{"year":"2022","period":"M03","periodName":"March","value":"287.504","footnotes":[{}]},{"year":"2022","period":"M02","periodName":"February","value":"283.716","footnotes":[{}]},{"year":"2022","period":"M01","periodName":"January","value":"281.148","footnotes |
| seriesID":"CUSR0000SA0","data":[{"year":"2022","period":"M08","periodName":"August", "latest":"true","value":"295.620","footnotes":[{}]},{"year":"2022","period":"M07","periodName":"July","value":"295.271","footnotes":[{}]},{"year":"2022","period":"M06","periodName":"June","value":"295.328","footnotes":[{}]},{"year":"2022","period":"M05","periodName":"May","value":"291.474","footnotes":[{}]},{"year":"2022","period":"M04","periodName":"April","value":"288.663","footnotes":[{}]},{"year":"2022","period":"M03","periodName":"March","value":"287.708","footnotes":[{}]},{"year":"2022","period":"M02","periodName":"February","value":"284.182","footnotes":[{}]},{"year":"2022","period":"M01","periodName":"January","value":"281.933","footnotes |
| }}                                                                                |
</pre>

 <p>
This is technically readable, but not very nice.
</p>
</div>
</div>
 <div id="outline-container-orgfcab913" class="outline-2">
 <h2 id="orgfcab913">Processing the Data with  <code>jq</code></h2>
 <div class="outline-text-2" id="text-orgfcab913">
 <p>
For most use cases, the data aren't particularly usable in this format. They're
hard to read; they include metadata about the API response; and the hierarchical
structure makes them difficult to extract into a tabular format. Enter  <code>jq</code>. We'll
proceed step by step to show how we can use  <code>jq</code> to extract specific data from the
API results.
</p>
</div>
 <div id="outline-container-orga34991a" class="outline-3">
 <h3 id="orga34991a"> <code>jq</code> with no further arguments</h3>
 <div class="outline-text-3" id="text-orga34991a">
 <p>
What happens if we pass the results of the API call to  <code>jq</code> with no further arguments?
</p>
 <div class="org-src-container">
 <pre class="src src-shell">curl -X POST -H  <span class="org-string">'Content-Type: application/json'</span>  <span class="org-sh-escaped-newline">\</span>
     -d  <span class="org-string">'{"seriesid": ["CUUR0000SA0","CUSR0000SA0"], "startyear":2022, "endyear":2022}'</span>  <span class="org-sh-escaped-newline">\</span>
     https://api.bls.gov/publicAPI/v2/timeseries/data/ | jq
</pre>
</div>

 <pre class="example">
{
  "status": "REQUEST_SUCCEEDED",
  "responseTime": 169,
  "message": [],
  "Results": {
    "series": [
      {
        "seriesID": "CUUR0000SA0",
        "data": [
          {
            "year": "2022",
            "period": "M08",
            "periodName": "August",
            "latest": "true",
            "value": "296.171",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M07",
            "periodName": "July",
            "value": "296.276",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M06",
            "periodName": "June",
            "value": "296.311",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M05",
            "periodName": "May",
            "value": "292.296",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M04",
            "periodName": "April",
            "value": "289.109",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M03",
            "periodName": "March",
            "value": "287.504",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M02",
            "periodName": "February",
            "value": "283.716",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M01",
            "periodName": "January",
            "value": "281.148",
            "footnotes": [
              {}
            ]
          }
        ]
      },
      {
        "seriesID": "CUSR0000SA0",
        "data": [
          {
            "year": "2022",
            "period": "M08",
            "periodName": "August",
            "latest": "true",
            "value": "295.620",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M07",
            "periodName": "July",
            "value": "295.271",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M06",
            "periodName": "June",
            "value": "295.328",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M05",
            "periodName": "May",
            "value": "291.474",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M04",
            "periodName": "April",
            "value": "288.663",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M03",
            "periodName": "March",
            "value": "287.708",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M02",
            "periodName": "February",
            "value": "284.182",
            "footnotes": [
              {}
            ]
          },
          {
            "year": "2022",
            "period": "M01",
            "periodName": "January",
            "value": "281.933",
            "footnotes": [
              {}
            ]
          }
        ]
      }
    ]
  }
}
</pre>

 <p>
We end up with our JSON output in a much more readable format. The spacing makes
it considerably easier to visualize the data hierarchy. Looking at this, we
observe:
</p>
 <ul class="org-ul"> <li>The data we want are under the  <code>Results</code> key</li>
 <li>Each series under  <code>Results</code> has a  <code>SeriesID</code> and  <code>data</code>: we want the  <code>seriesID</code> and
the  <code>data</code> values as rows in our resulting table.</li>
</ul></div>
</div>
 <div id="outline-container-org24783be" class="outline-3">
 <h3 id="org24783be">Constructing a Header Row</h3>
 <div class="outline-text-3" id="text-org24783be">
 <p>
We want our resulting table to have a header row. The process of making this row
provides a lot of insight into how  <code>jq</code> works.
</p>

 <div class="org-src-container">
 <pre class="src src-shell">curl -X POST -H  <span class="org-string">'Content-Type: application/json'</span>  <span class="org-sh-escaped-newline">\</span>
     -d  <span class="org-string">'{"seriesid": ["CUUR0000SA0","CUSR0000SA0"], "startyear":2022, "endyear":2022}'</span>  <span class="org-sh-escaped-newline">\</span>
     https://api.bls.gov/publicAPI/v2/timeseries/data/  <span class="org-sh-escaped-newline">\</span>
    | jq -r  <span class="org-string">'.Results | (.series[0].data[0] | ["seriesID"] + keys_unsorted)'</span>
</pre>
</div>

 <pre class="example">
[
  "seriesID",
  "year",
  "period",
  "periodName",
  "latest",
  "value",
  "footnotes"
]
</pre>


 <p>
What's happening here?
</p>

 <ul class="org-ul"> <li>Calling  <code>jq</code> with the  <code>-r</code> argument specifies that we want raw output rather than
output formatted and quoted as a JSON string.</li>
 <li> <code>.Results</code> specifies that we're working under the  <code>Results</code> key. We aren't
interested in the  <code>status</code> or  <code>responseTime</code> or  <code>message</code> keys. The data are all
under  <code>Results</code>. If we had started with  <code>jq -r '.'</code>, we'd be starting from the top
of the hierarchy.</li>
 <li> <p>
Parentheses serve as grouping operators. In many cases, in  <code>jq</code>, parentheses are
used to specify the particular level of the data hierarchy we're working
with. For example,  <code>(.series[0].data[0]) | ...</code> specifies that we're working
with the first data entry of the first series, which looks like this:
</p>

 <div class="org-src-container">
 <pre class="src src-js">{
     <span class="org-string">"year"</span>:  <span class="org-string">"2022"</span>,
     <span class="org-string">"period"</span>:  <span class="org-string">"M08"</span>,
     <span class="org-string">"periodName"</span>:  <span class="org-string">"August"</span>,
     <span class="org-string">"latest"</span>:  <span class="org-string">"true"</span>,
     <span class="org-string">"value"</span>:  <span class="org-string">"296.171"</span>,
     <span class="org-string">"footnotes"</span>: [
        {}
    ]
}
</pre>
</div></li>
 <li>The pipe operator  <code>|</code> combines filters: it passes the output of the filter on
the left as the input to the filter on the right. This is very much like the
Unix shell pipe. Recall that, in this case, the first filter returned the JSON
object above, so subsequent filters and functions in this set of parentheses
will operate on that object.</li>
 <li> <code>keys_unsorted</code> is a function that returns the keys from a given object, sorted
"roughly in insertion order."</li>
 <li> <code>+</code> does array concatenation, so  <code>["seriesID"] + keys</code> returns a single array
containing  <code>"SeriesID"</code> and the keys returned by the  <code>keys</code> function.</li>
</ul> <p>
The most important thing to note here is how we use filters to navigate the JSON
hierarchy. We start with  <code>.Results</code> to specify that we're working in the context
of the  <code>"Results"</code> key, and then, in the parentheses, we narrow to
 <code>.series[0].data[0]</code> to specify the first entry in the first series. In the next
section, we'll see how to extract data from multiple sections.
</p>
</div>
</div>
 <div id="outline-container-org1b6d8bc" class="outline-3">
 <h3 id="org1b6d8bc">Extracting Data Values</h3>
 <div class="outline-text-3" id="text-org1b6d8bc">
 <p>
Based on the header rows, we need to extract, for each data entry, the series
ID, footnotes, period, period name, year, value, and whether it's the latest
data from the BLS. We can't use the exact approach we used to construct the
headers, though, for two key reasons:
</p>
 <ul class="org-ul"> <li>We need to get data from each object, not just one</li>
 <li>We need data from different levels of the hierarchy:  <code>seriesID</code> is at a higher
level than the other values we need.</li>
</ul> <pre class="example">
"series": [
    {
        "seriesID": "CUUR0000SA0",
        "data": [
            {
                "year": "2022",
                "period": "M08",
                "periodName": "August",
                "latest": "true",
                "value": "296.171",
                "footnotes": [
                    {}
                ]
            },
            ...
        ]
</pre>

 <p>
Here's how we might start to approach this.
</p>


 <div class="org-src-container">
 <pre class="src src-shell">curl -X POST -H  <span class="org-string">'Content-Type: application/json'</span>  <span class="org-sh-escaped-newline">\</span>
     -d  <span class="org-string">'{"seriesid": ["CUUR0000SA0","CUSR0000SA0"], "startyear":2022, "endyear":2022}'</span>  <span class="org-sh-escaped-newline">\</span>
     https://api.bls.gov/publicAPI/v2/timeseries/data/  <span class="org-sh-escaped-newline">\</span>
    | jq -r  <span class="org-string">'.Results | (.series[] | [.seriesID] + (.data[] | map(.)))'</span>  
</pre>
</div>

 <pre class="example">
[
  "CUUR0000SA0",
  "2022",
  "M08",
  "August",
  "true",
  "296.171",
  [
    {}
  ]
]
[
  "CUUR0000SA0",
  "2022",
  "M07",
  "July",
  "296.276",
  [
    {}
  ]
]

...

[
  "CUSR0000SA0",
  "2022",
  "M01",
  "January",
  "281.933",
  [
    {}
  ]
]
</pre>

 <p>
This gets us part of the way there. We'll work through this part of the query
and show what happened:  <code>(.series[] | [.seriesID] + (.data[] | map(.)))</code>.
</p>
 <ul class="org-ul"> <li>The first filter focuses on  <code>.series[]</code>.</li>
 <li>The empty bracket  <code>[]</code> (with no index specified) returns all elements of the
array. So  <code>.series[]</code> will iterate through everything contained under
 <code>series</code>. There are two series, each with their own  <code>seriesID</code> and  <code>data</code>.</li>
 <li>The  <code>[.seriesID]</code> section after the filter will extract the ID from each series.</li>
 <li>The  <code>(.data[] | map(.))</code> section will, for each series, iterate through the  <code>data</code>
array. The  <code>map(.)</code> function says to return each value in the  <code>data</code> array without
modifying it.</li>
</ul> <p>
The main thing we've accomplished here is extracting elements from different
levels of the hierarchy: the  <code>seriesID</code> from the higher level and the  <code>data</code> values
from the lower level.
</p>

 <p>
Ultimately, we'd like to convert these data to a CSV. This is possible with  <code>jq</code>,
but there's an issue: the  <code>footnotes</code> field is itself a JSON object and cannot be
converted directly to the CSV format. So we have a little more work to do.
</p>


 <div class="org-src-container">
 <pre class="src src-shell">curl -X POST -H  <span class="org-string">'Content-Type: application/json'</span>  <span class="org-sh-escaped-newline">\</span>
     -d  <span class="org-string">'{"seriesid": ["CUUR0000SA0","CUSR0000SA0"], "startyear":2022, "endyear":2022}'</span>  <span class="org-sh-escaped-newline">\</span>
     https://api.bls.gov/publicAPI/v2/timeseries/data/  <span class="org-sh-escaped-newline">\</span>
    | jq -r  <span class="org-string">'.Results | (.series[] | [.seriesID] +</span>
 <span class="org-string">  (.data[] | [with_entries(select(.key=="footnotes" | not)) | values[]] + [.footnotes[]|join(",")]))'</span>
</pre>
</div>

 <pre class="example">
[
  "CUUR0000SA0",
  "2022",
  "M08",
  "August",
  "true",
  "296.171",
  ""
]
[
  "CUUR0000SA0",
  "2022",
  "M07",
  "July",
  "296.276",
  ""
]

...

[
  "CUSR0000SA0",
  "2022",
  "M01",
  "January",
  "281.933",
  ""
]
</pre>

 <p>
We've made some changes in how we extract the data from the  <code>data</code> key. Before, it
was just  <code>(.data[] | map(.))</code> Now it looks like  <code>(.data[] | [with_entries(select(.key=="footnotes" | not)) | values[]] + [.footnotes[]|join(",")])</code> .
</p>

 <p>
What do these changes mean?
</p>
 <ul class="org-ul"> <li> <code>with_entries</code> converts its input to key-value pairs with the format  <code>{key: k,
  value: v}</code>. This lets us filter based on the names of the keys and to return
the values we want.</li>
 <li> <code>select()</code> takes a boolean expression and returns its input if it matches the
boolean expresison. In this case, the boolean expression is
 <code>.key=="footnotes" | not</code>, which means "key does not equal 'footnotes'". So we
are excluding the "footnotes" field for now but returning all of the others.</li>
 <li> <code>values[]</code> returns all of the values from the key-value pairs, excluding
 <code>footnotes</code>.</li>
 <li>Lastly, we re-add the "footnotes" field with  <code>+ [.footnotes[]|join(",")]</code>. This
iterates through the elements of the  <code>footnotes</code> object in each  <code>data</code> entry and
converts them into comma-separated strings, which the CSV converter can handle
without issue.</li>
</ul></div>
</div>
 <div id="outline-container-orgb232e78" class="outline-3">
 <h3 id="orgb232e78">Converting the Results to CSV</h3>
 <div class="outline-text-3" id="text-orgb232e78">
 <p>
Lastly, we convert the transformed results to a CSV using the  <code>@csv</code> formatter.
</p>

 <div class="org-src-container">
 <pre class="src src-shell">curl -X POST -H  <span class="org-string">'Content-Type: application/json'</span>  <span class="org-sh-escaped-newline">\</span>
     -d  <span class="org-string">'{"seriesid": ["CUUR0000SA0","CUSR0000SA0"], "startyear":2022, "endyear":2022}'</span>  <span class="org-sh-escaped-newline">\</span>
     https://api.bls.gov/publicAPI/v2/timeseries/data/  <span class="org-sh-escaped-newline">\</span>
    | jq -r  <span class="org-string">'.Results | (.series[0].data[0]| ["seriesID"] +</span>
 <span class="org-string">  (keys_unsorted)), (.series[] | [.seriesID] +</span>
 <span class="org-string">  (.data[] | [with_entries(select(.key=="footnotes" | not)) | values[]] + [.footnotes[]|join(",")])) | @csv'</span>
</pre>
</div>

 <pre class="example">
"seriesID","year","period","periodName","latest","value","footnotes"
"CUUR0000SA0","2022","M08","August","true","296.171",""
"CUUR0000SA0","2022","M07","July","296.276",""
"CUUR0000SA0","2022","M06","June","296.311",""
"CUUR0000SA0","2022","M05","May","292.296",""
"CUUR0000SA0","2022","M04","April","289.109",""
"CUUR0000SA0","2022","M03","March","287.504",""
"CUUR0000SA0","2022","M02","February","283.716",""
"CUUR0000SA0","2022","M01","January","281.148",""
"CUSR0000SA0","2022","M08","August","true","295.620",""
"CUSR0000SA0","2022","M07","July","295.271",""
"CUSR0000SA0","2022","M06","June","295.328",""
"CUSR0000SA0","2022","M05","May","291.474",""
"CUSR0000SA0","2022","M04","April","288.663",""
"CUSR0000SA0","2022","M03","March","287.708",""
"CUSR0000SA0","2022","M02","February","284.182",""
"CUSR0000SA0","2022","M01","January","281.933",""
</pre>

 <p>
There is one outstanding issue: only the first row of data actually contains the
 <code>latest</code> entry; the rest are empty. There are a number of solutions to this, from
dropping that column entirely to explicitly adding a "False" value to all of the
other rows. We won't get into that here.
</p>

 <p>
Now that you've read this post, you should have a better idea of how to use  <code>jq</code>
to access and process data at different hierarchical levels of a JSON data
structure.
</p>
</div>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20220918-jq-example.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20220918-jq-example.html</guid>
  <pubDate>Sun, 18 Sep 2022 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Figures and Captions Don&apos;t Appear as Expected with Default Export Options</title>
  <description><![CDATA[<div id="content">
 <div class="preview">
 <p>
I noticed that some of the formatting on this site was a little off and some of
the org-mode components weren't being translated to HTML in quite the way I
expected. Fixing this was simple, but  <i>finding</i> the solution wasn't. In short, it
was necessary to set the  <code>org-html-doctype</code> to  <code>html5</code> (the default is
 <code>xhtml-strict</code>). Furthermore, I set  <code>org-html-html5-fancy</code> to  <code>t</code>. These ensure the
org export process takes advantage of block elements offered in the  <code>html5</code>
standard.
</p>

</div>

 <p>
While that brief introduction should capture the necessary changes, we can get
into more specifics.
</p>

 <div id="outline-container-org860b833" class="outline-2">
 <h2 id="org860b833">The Problem</h2>
 <div class="outline-text-2" id="text-org860b833">
 <p>
If we use the default settings, figures aren't wrapped in  <code><figure></code> blocks and
captions aren't wrapped in  <code><figcaption></code> blocks, so none of the formatting we
want to see applied to those attributes is actually applied. Here's what we see:
</p>

 <div id="org7d55a3b" class="figure">
 <p> <img src="figures/20220719-julia-plots/fig5.png" alt="fig5.png" width="450px"></img></p>
 <p> <span class="figure-number">Figure 1: </span>This caption is left-aligned and has no  <code><figcaption></code> element</p>
</div>

 <p>
The image and caption appear left-aligned on the page. Here's the html:
</p>

 <div class="org-src-container">
 <pre class="src src-html">< <span class="org-function-name">div</span>  <span class="org-variable-name">id</span>= <span class="org-string">"org7d55a3b"</span>  <span class="org-variable-name">class</span>= <span class="org-string">"figure"</span>>
< <span class="org-function-name">p</span>>< <span class="org-function-name">img</span>  <span class="org-variable-name">src</span>= <span class="org-string">"figures/20220719-julia-plots/fig5.png"</span>  <span class="org-variable-name">alt</span>= <span class="org-string">"fig5.png"</span>  <span class="org-variable-name">width</span>= <span class="org-string">"450px"</span>>
</ <span class="org-function-name">p</span>>
< <span class="org-function-name">p</span>>< <span class="org-function-name">span</span>  <span class="org-variable-name">class</span>= <span class="org-string">"figure-number"</span>>Figure 1: </ <span class="org-function-name">span</span>>This caption is left-aligned and has no < <span class="org-function-name">code</span>> <span class="org-variable-name">&lt;</span>figcaption <span class="org-variable-name">&gt;</span></ <span class="org-function-name">code</span>> element</ <span class="org-function-name">p</span>>
</ <span class="org-function-name">div</span>>
</pre>
</div>
</div>
</div>

 <div id="outline-container-org9a7f988" class="outline-2">
 <h2 id="org9a7f988">Changes to the Site Config</h2>
 <div class="outline-text-2" id="text-org9a7f988">
 <p>
To address this, we need to change the  <code>org-html-doctype</code> and  <code>org-html-html5-fancy</code>
variables. We can do this in the export configuration's
 <code>org-publish-project-alist</code>. See  <a href="https://github.com/djliden/djliden.github.io/blob/main/build-site.el">here</a> for the updated configuration file. Here is
what the updated  <code>org-publish-project-alist</code> looks like—see lines 21-22 for the
key changes.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp"> <span class="linenr"> 1: </span>( <span class="org-keyword">setq</span> org-publish-project-alist
 <span class="linenr"> 2: </span>      (list
 <span class="linenr"> 3: </span>       (list  <span class="org-string">"org-site:main"</span>
 <span class="linenr"> 4: </span>              <span class="org-builtin">:recursive</span> t
 <span class="linenr"> 5: </span>              <span class="org-builtin">:base-directory</span>  <span class="org-string">"./content"</span>
 <span class="linenr"> 6: </span>              <span class="org-builtin">:publishing-directory</span>  <span class="org-string">"./public"</span>
 <span class="linenr"> 7: </span>              <span class="org-builtin">:publishing-function</span> 'org-html-publish-to-html
 <span class="linenr"> 8: </span>              <span class="org-builtin">:html-preamble</span> (file-contents  <span class="org-string">"assets/html_preamble.html"</span>)
 <span class="linenr"> 9: </span>              <span class="org-builtin">:with-author</span> nil
 <span class="linenr">10: </span>              <span class="org-builtin">:with-creator</span> t
 <span class="linenr">11: </span>              <span class="org-builtin">:with-toc</span> t
 <span class="linenr">12: </span>              <span class="org-builtin">:section-numbers</span> nil
 <span class="linenr">13: </span>              <span class="org-builtin">:time-stamp-file</span> nil
 <span class="linenr">14: </span>              <span class="org-builtin">:auto-sitemap</span> t
 <span class="linenr">15: </span>              <span class="org-builtin">:sitemap-title</span> nil <span class="org-comment-delimiter">;</span> <span class="org-comment">"Daniel Liden's Blog"</span>
 <span class="linenr">16: </span>              <span class="org-builtin">:sitemap-format-entry</span> 'my/org-publish-org-sitemap-format
 <span class="linenr">17: </span>              <span class="org-builtin">:sitemap-function</span> 'my/org-publish-org-sitemap
 <span class="linenr">18: </span>              <span class="org-builtin">:sitemap-sort-files</span> 'anti-chronologically
 <span class="linenr">19: </span>              <span class="org-builtin">:sitemap-filename</span>  <span class="org-string">"sitemap.org"</span>
 <span class="linenr">20: </span>              <span class="org-builtin">:sitemap-style</span> 'tree
 <span class="linenr">21: </span>              <span class="org-builtin">:html-doctype</span>  <span class="org-string">"html5"</span>
 <span class="linenr">22: </span>              <span class="org-builtin">:html-html5-fancy</span> t)
 <span class="linenr">23: </span>       (list  <span class="org-string">"org-site:static"</span>
 <span class="linenr">24: </span>              <span class="org-builtin">:base-directory</span>  <span class="org-string">"./content/"</span>
 <span class="linenr">25: </span>              <span class="org-builtin">:base-extension</span>  <span class="org-string">"css</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">js</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">png</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">jpg</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">gif</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">pdf</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">mp3</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">ogg</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">swf</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">svg"</span>
 <span class="linenr">26: </span>              <span class="org-builtin">:publishing-directory</span>  <span class="org-string">"./public"</span>
 <span class="linenr">27: </span>              <span class="org-builtin">:recursive</span> t
 <span class="linenr">28: </span>              <span class="org-builtin">:publishing-function</span> 'org-publish-attachment
 <span class="linenr">29: </span>             )
 <span class="linenr">30: </span>       (list  <span class="org-string">"org-site:assets"</span>
 <span class="linenr">31: </span>              <span class="org-builtin">:base-directory</span>  <span class="org-string">"./assets/"</span>
 <span class="linenr">32: </span>              <span class="org-builtin">:base-extension</span>  <span class="org-string">"css</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">js</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">png</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">jpg</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">gif</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">pdf</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">mp3</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">ogg</span> <span class="org-string"> <span class="org-regexp-grouping-backslash">\\</span></span> <span class="org-string"> <span class="org-regexp-grouping-construct">|</span></span> <span class="org-string">swf"</span>
 <span class="linenr">33: </span>              <span class="org-builtin">:publishing-directory</span>  <span class="org-string">"./public/"</span>
 <span class="linenr">34: </span>              <span class="org-builtin">:recursive</span> t
 <span class="linenr">35: </span>              <span class="org-builtin">:publishing-function</span> 'org-publish-attachment)))
</pre>
</div>
</div>
</div>
 <div id="outline-container-org0ea6084" class="outline-2">
 <h2 id="org0ea6084">The Results</h2>
 <div class="outline-text-2" id="text-org0ea6084">
 <p>
With these changes, our images and captions are now centered:
</p>


 <figure> <img src="figures/20220719-julia-plots/fig5.png" alt="fig5.png" width="450px"></img> <figcaption> <span class="figure-number">Figure 1: </span>This caption is now centered and wrapped in a  <code><figcaption></code> tag!</figcaption></figure> <p>
And the html generated from the org export now looks like this:
</p>

 <div class="org-src-container">
 <pre class="src src-html">< <span class="org-function-name">figure</span>  <span class="org-variable-name">id</span>= <span class="org-string">"orgbffad64"</span>>
< <span class="org-function-name">img</span>  <span class="org-variable-name">src</span>= <span class="org-string">"figures/20220719-julia-plots/fig5.png"</span>  <span class="org-variable-name">alt</span>= <span class="org-string">"fig5.png"</span>  <span class="org-variable-name">width</span>= <span class="org-string">"450px"</span>>

< <span class="org-function-name">figcaption</span>>< <span class="org-function-name">span</span>  <span class="org-variable-name">class</span>= <span class="org-string">"figure-number"</span>>Figure 1: </ <span class="org-function-name">span</span>>This caption is now centered and wrapped in a < <span class="org-function-name">code</span>> <span class="org-variable-name">&lt;</span>figcaption <span class="org-variable-name">&gt;</span></ <span class="org-function-name">code</span>> tag!</ <span class="org-function-name">figcaption</span>>
</ <span class="org-function-name">figure</span>>
</pre>
</div>

 <p>
We now have a  <code><figure>...</figure></code> block and our caption is a  <code><figcaption></code>
element.
</p>

 <p>
As noted in  <a href="https://orgmode.org/worg/org-tutorials/images-and-xhtml-export.html">this Worg page</a>:
</p>

 <blockquote>
 <p>
There is no  <i>figure</i> element in XHTML and captions are not supported at all.
</p>
</blockquote>

 <p>
Setting the config to use  <code>html5</code> gives us access to these elements.
</p>

 <p>
 <b>Note</b>: I don't know much HTML or CSS at all. It probably shows. I was trying to
 apply some formatting to the  <code>figcaption</code> element in my stylesheet and it wasn't
 having any impact, even though I was pretty sure captions were supposed to
 export to  <code>figcaption</code>. That led me to this solution, which seems to work well
 (for now). I invite any feedback!
</p>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20220724-html5.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20220724-html5.html</guid>
  <pubDate>Sun, 24 Jul 2022 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Basic Plotting in Julia</title>
  <description><![CDATA[<div id="content">
 <div class="preview">
 <p>
In this short post, I show one of the many ways of using Julia within emacs
org mode, and will describe some of the basic plotting functionality in Julia.
</p>

</div>

 <div id="outline-container-org9a3cae4" class="outline-2">
 <h2 id="org9a3cae4">Getting Started with Julia in Org Mode:  <code>jupyter-julia</code>.</h2>
 <div class="outline-text-2" id="text-org9a3cae4">
 <p>
While  <a href="https://github.com/gcv/julia-snail">julia-snail</a> is my favorite Julia development environment, it's support for
org-mode is, at present, quite limited. For example, it seems to ignore the
 <code>:file</code> argument, making it difficult to save figures to specific locations. I
find that  <a href="https://github.com/nnicandro/emacs-jupyter">emacs-jupyter</a> provides the most featureful and reliable way to work
with Julia in org-mode. Read  <a href="https://github.com/nnicandro/emacs-jupyter#org-mode-source-blocks">the emacs-jupyter documentation</a> for instructions on
how to use emacs-jupyter with org-mode.
</p>
</div>
</div>

 <div id="outline-container-org86f3845" class="outline-2">
 <h2 id="org86f3845">Making some Plots</h2>
 <div class="outline-text-2" id="text-org86f3845">
 <p>
Let's make some plots. We'll use the  <a href="https://docs.juliaplots.org/latest/tutorial/">Plots.jl</a> package and explore a few
different plotting styles. First, we load the packages we'll be using. I tend to
plot statistical distributions fairly often, so I'll load  <code>Distributions</code> and
 <code>Statplots</code> in addition to  <code>Plots</code>.
</p>

 <div class="org-src-container">
 <pre class="src src-jupyter-julia">using Plots
using Distributions
using StatsPlots
</pre>
</div>
</div>

 <div id="outline-container-orgba66bca" class="outline-3">
 <h3 id="orgba66bca">Building Plots Incrementally</h3>
 <div class="outline-text-3" id="text-orgba66bca">
 <p>
With these packages loaded, we'll start simply and plot a standard normal
distribution.
</p>

 <div class="org-src-container">
 <pre class="src src-jupyter-julia">plot(Normal(), fill=(0,0.5,:red))
</pre>
</div>


 <figure> <object type="image/svg+xml" data="figures/20220719-julia-plots/fig1.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

 <figcaption> <span class="figure-number">Figure 1: </span>A basic plot</figcaption></figure> <p>
The  <code>Plots.jl</code> package makes it easy to update plots after creation. A Julia
convention is that methods ending in  <code>!</code>  <a href="https://docs.julialang.org/en/v1/manual/style-guide/#bang-convention">modify their arguments in place</a>. In this
case, we can call  <code>plot!()</code> to incrementally add to our plot.
</p>

 <div class="org-src-container">
 <pre class="src src-jupyter-julia">plot!(title="Standard Normal Distribution", xlabel="x", ylabel="p(x)") # Add Labels
plot!(leg=false) # Remove the Legend
</pre>
</div>


 <figure> <object type="image/svg+xml" data="figures/20220719-julia-plots/fig2.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

 <figcaption> <span class="figure-number">Figure 2: </span>Removing the legend and adding labels</figcaption></figure> <p>
Let's make one final set of changes and update some of the font sizes for better
readability.
</p>


 <div class="org-src-container">
 <pre class="src src-jupyter-julia">plot!(tickfont=font(18, "courier"),
      guidefont=font(18),
      titlefont=
font(18, "Computer Modern"))
</pre>
</div>


 <figure> <object type="image/svg+xml" data="figures/20220719-julia-plots/fig3.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

 <figcaption> <span class="figure-number">Figure 3: </span>Changing some Fonts</figcaption></figure></div>
</div>
</div>


 <div id="outline-container-org1c0ac50" class="outline-2">
 <h2 id="org1c0ac50">Plotting Real Data</h2>
 <div class="outline-text-2" id="text-org1c0ac50">
 <p>
That's enough of that. Usually we're plotting real data, not standard standard
distributions. Let's get some. First we'll pull from the  <code>RDatasets</code> package,
which is an excellent source of go-to data science and statistics examples such
as  <code>mtcars</code> and  <code>iris</code>. We'll use the venerable  <code>mtcars</code> to show how to work with data
in a basic way.
</p>

 <div class="org-src-container">
 <pre class="src src-jupyter-julia">using RDatasets, DataFrames
mtcars = dataset("datasets", "mtcars")
mtcars[1:10,:]
</pre>
</div>

 <div class="data-frame"> <p>10 rows × 12 columns (omitted printing of 3 columns)</p> <table class="data-frame"> <thead> <tr> <th></th> <th>Model</th> <th>MPG</th> <th>Cyl</th> <th>Disp</th> <th>HP</th> <th>DRat</th> <th>WT</th> <th>QSec</th> <th>VS</th></tr> <tr> <th></th> <th title="InlineStrings.String31">String31</th> <th title="Float64">Float64</th> <th title="Int64">Int64</th> <th title="Float64">Float64</th> <th title="Int64">Int64</th> <th title="Float64">Float64</th> <th title="Float64">Float64</th> <th title="Float64">Float64</th> <th title="Int64">Int64</th></tr></thead> <tbody> <tr> <th>1</th> <td>Mazda RX4</td> <td>21.0</td> <td>6</td> <td>160.0</td> <td>110</td> <td>3.9</td> <td>2.62</td> <td>16.46</td> <td>0</td></tr> <tr> <th>2</th> <td>Mazda RX4 Wag</td> <td>21.0</td> <td>6</td> <td>160.0</td> <td>110</td> <td>3.9</td> <td>2.875</td> <td>17.02</td> <td>0</td></tr> <tr> <th>3</th> <td>Datsun 710</td> <td>22.8</td> <td>4</td> <td>108.0</td> <td>93</td> <td>3.85</td> <td>2.32</td> <td>18.61</td> <td>1</td></tr> <tr> <th>4</th> <td>Hornet 4 Drive</td> <td>21.4</td> <td>6</td> <td>258.0</td> <td>110</td> <td>3.08</td> <td>3.215</td> <td>19.44</td> <td>1</td></tr> <tr> <th>5</th> <td>Hornet Sportabout</td> <td>18.7</td> <td>8</td> <td>360.0</td> <td>175</td> <td>3.15</td> <td>3.44</td> <td>17.02</td> <td>0</td></tr> <tr> <th>6</th> <td>Valiant</td> <td>18.1</td> <td>6</td> <td>225.0</td> <td>105</td> <td>2.76</td> <td>3.46</td> <td>20.22</td> <td>1</td></tr> <tr> <th>7</th> <td>Duster 360</td> <td>14.3</td> <td>8</td> <td>360.0</td> <td>245</td> <td>3.21</td> <td>3.57</td> <td>15.84</td> <td>0</td></tr> <tr> <th>8</th> <td>Merc 240D</td> <td>24.4</td> <td>4</td> <td>146.7</td> <td>62</td> <td>3.69</td> <td>3.19</td> <td>20.0</td> <td>1</td></tr> <tr> <th>9</th> <td>Merc 230</td> <td>22.8</td> <td>4</td> <td>140.8</td> <td>95</td> <td>3.92</td> <td>3.15</td> <td>22.9</td> <td>1</td></tr> <tr> <th>10</th> <td>Merc 280</td> <td>19.2</td> <td>6</td> <td>167.6</td> <td>123</td> <td>3.92</td> <td>3.44</td> <td>18.3</td> <td>1</td></tr></tbody></table></div>


 <p>
We can use the  <code>@df</code> macro and access columns by prepending them with  <code>:</code>.
</p>


 <div class="org-src-container">
 <pre class="src src-jupyter-julia">gr()
@df mtcars scatter(:MPG, :HP, group=:Cyl, background=:black, msize=8, keytitle="N Cylinders")
xlabel!("Mpg")
ylabel!("HP")
title!("Horsepower by MPG and N Cylinders")
</pre>
</div>


 <figure> <object type="image/svg+xml" data="figures/20220719-julia-plots/fig4.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

 <figcaption> <span class="figure-number">Figure 4: </span>plotting data with Plots.jl</figcaption></figure></div>
</div>

 <div id="outline-container-orge39c1ff" class="outline-2">
 <h2 id="orge39c1ff">Modifying Plot Visual Components</h2>
 <div class="outline-text-2" id="text-orge39c1ff">
 <p>
It's not always straightforward to figure out how to modify visual components of
a plot. Most of the relevant information lies in the  <a href="https://docs.juliaplots.org/latest/attributes/">Attributes</a> section of the
Plots.jl documentation (and its subsections).
</p>
</div>
</div>
 <div id="outline-container-orgee3b6a0" class="outline-2">
 <h2 id="orgee3b6a0">Different Plot Styles</h2>
 <div class="outline-text-2" id="text-orgee3b6a0">
 <p>
One of the benefits of the Plots.jl package is its support for many different
 <a href="https://docs.juliaplots.org/latest/backends/">plotting backends</a>. The default is GR which, according to the documentation, is
</p>

 <blockquote>
 <p>
The default backend. Very fast with lots of plot types. Still actively developed and improving daily.
</p>
</blockquote>

 <p>
and it offers speed; 2D and 3D plots, and standalone or inline plotting.
</p>

 <p>
Here we'll repeat the plot above with the UnicodePlots backend. We first need to
install the package with  <code>add UnicodePlots</code> in the package manager. Note that you
can do this right from the Jupyter repl in emacs-jupyter by pressing  <code>]</code> in the
repl.
</p>

 <p>
We then specify that we'd like to use this backend with the  <code>unicodeplots()</code> function.
</p>

 <div class="org-src-container">
 <pre class="src src-jupyter-julia">unicodeplots()
# scatterplot
@df mtcars scatter(:MPG, :HP, title="HP vs MPG", xlabel="Mpg", ylabel="HP")
</pre>
</div>

 <pre class="example">
                        HP vs MPG                   
       +----------------------------------------+   
343.49 |        ⚬                               | y1
       |                                        |   
       |                                        |   
       |         ⚬                              |   
       |     ⚬ ⚬                                |   
       |        ⚬                               |   
       | ⚬                                      |   
    HP |                                        |   
       |        ⚬ ⚬ ⚬ ⚬⚬⚬                       |   
       |        ⚬⚬                              |   
       |                                        |   
       |             ⚬ ⚬  ⚬              ⚬      |   
       |                  ⚬  ⚬    ⚬             |   
       |                            ⚬       ⚬ ⚬ |   
 43.51 |                       ⚬         ⚬      |   
       +----------------------------------------+   
        9.695             Mpg             34.605    
</pre>

 <p>
I haven't yet figured out how to get the colors to appear as they are supposed
to in org mode, so for now, I'm simply showing a basic scatterplot with no grouping. I'll
update if and when I figure that out. It should look like this:
</p>


 <figure> <img src="figures/20220719-julia-plots/fig5.png" alt="fig5.png" width="600px"></img> <figcaption> <span class="figure-number">Figure 5: </span>screenshot of unicodeplot from vterm</figcaption></figure></div>
</div>


 <div id="outline-container-org295d6a1" class="outline-2">
 <h2 id="org295d6a1">Conculsion</h2>
 <div class="outline-text-2" id="text-org295d6a1">
 <p>
There's a lot more to get into with plotting in Julia and with using Julia in
emacs. This post serves as a small jumping-off point—just enough to get started,
with a few pointers to further resources, and some questions to start
pursuing. I'll write more on this topic as I learn more!
</p>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20220719-julia-plots.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20220719-julia-plots.html</guid>
  <pubDate>Tue, 19 Jul 2022 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Org Mode Headlines in Org Source Blocks</title>
  <description><![CDATA[<div id="content">
 <p>
 <i>Note: I know the org-mode syntax highlighting in the current theme is very
low-contrast. I will update this soon.</i>
</p>

 <div id="outline-container-orgf376741" class="outline-2">
 <h2 id="orgf376741">The Problem</h2>
 <div class="outline-text-2" id="text-orgf376741">
 <div class="PREVIEW">
 <p>
When writing about org mode, one often wants to show what particular org
headline look like in terms of formatting, properties, tags, options,
etc,. However, even within a babel org source block, an org header will be
parsed and exported as a header. We can get around this by prepending the
headline with a comma. The comma won't show up when exported: all that is
exported is a nicely-formatted example of an org headline.
</p>

</div>

 <p>
Here is an example of the issue. Below, I inserted an org source block (defined
with  <code>#+begin_src org</code>) with a first-level org headline inside,   <i>without</i> inserting
a comma before the headline.
</p>
 <hr></hr> <p>
#+begin <sub>src</sub> org
</p>
</div>
</div>
 <div id="outline-container-org7041494" class="outline-2">
 <h2 id="org7041494">This Headline Is in an Org Source Block</h2>
 <div class="outline-text-2" id="text-org7041494">
 <p>
And it is still parsed and exported as a headline, not as an example.
#+end <sub>src</sub></p>
 <hr></hr> <p>
Clearly, this isn't what we want.
</p>
</div>
</div>
 <div id="outline-container-orga57e94b" class="outline-2">
 <h2 id="orga57e94b">Prepend Headlines in Source Blocks with Commas</h2>
 <div class="outline-text-2" id="text-orga57e94b">
 <p>
This issue is easily resolved: just insert a comma before the headline in the
source block (e.g.  <code>,* Headline</code>). This results in the following:
</p>

 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-level-1">* This Headline Is in an Org Source Block</span>
and it looks like org source, not like an exported org file.
</pre>
</div>

 <p>
This approach works well with more complicated org-mode syntax, as well. For
example, the following block:
</p>

 <div class="org-src-container">
 <pre class="src src-raw_org">,* Headline 1
:PROPERTIES:
:ID:       642BF4EE-3139-4B96-97C4-D3BABD86FFD5
:END:
,** Headline 2
This headline is also prepended with a comma!
,** Even a Nested Source Block!
,#+begin_src R
1+1
,#+end_src

,#+RESULTS:
: 2
</pre>
</div>

 <p>
leads to the following (when we specify that it is an org source block).
</p>

 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-level-1">* Headline 1</span>
 <span class="org-org-drawer">:PROPERTIES:</span>
 <span class="org-org-special-keyword">:ID:</span>        <span class="org-org-property-value">642BF4EE-3139-4B96-97C4-D3BABD86FFD5</span>
 <span class="org-org-drawer">:END:</span>
 <span class="org-org-level-2">** Headline 2</span>
This headline is also prepended with a comma!
 <span class="org-org-level-2">** Even a Nested Source Block!</span>
 <span class="org-org-block-begin-line">#+begin_src R</span>
 <span class="org-org-block">1+1</span>
 <span class="org-org-block-end-line">#+end_src</span>

 <span class="org-org-meta-line">#+RESULTS:</span>
 <span class="org-org-code">: 2</span>
</pre>
</div>
</div>
</div>
 <div id="outline-container-org4ae3b2f" class="outline-2">
 <h2 id="org4ae3b2f">An Easier Way</h2>
 <div class="outline-text-2" id="text-org4ae3b2f">
 <p>
We can use the  <code>org-edit-special</code> command ( <code>C-c '</code>) within an org source block to
open a separate editing environment (in this case, another org buffer). We can
then write some org syntax. When we exit the environment (again, with  <code>C-c '</code>), it
will be properly formatted for export.
</p>

 <p>
The following block was generated using this method:
</p>

 <div class="org-src-container">
 <pre class="src src-raw_org">,* Headline 1                                                    :example_tag:
This is an org headline with a tag.
,** TODO Second Headline
SCHEDULED: <2022-02-15 Tue>
:PROPERTIES:
:CUSTOM_ID: headline_1
:END:
,** Babel

,#+begin_src jupyter-python :session datasci
import numpy as np

np.array(range(1,10))
,#+end_src

,#+RESULTS:
: array([1, 2, 3, 4, 5, 6, 7, 8, 9])
</pre>
</div>

 <p>
Which generates:
</p>

 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-level-1">* Headline 1                                                    </span> <span class="org-org-level-1"> <span class="org-org-tag">:example_tag:</span></span>
This is an org headline with a tag.
 <span class="org-org-level-2">** </span> <span class="org-org-todo">TODO</span> <span class="org-org-level-2"> Second Headline</span>
 <span class="org-org-special-keyword">SCHEDULED:</span>  <span class="org-org-date"><2022-02-15 Tue></span>
 <span class="org-org-drawer">:PROPERTIES:</span>
 <span class="org-org-special-keyword">:CUSTOM_ID:</span>  <span class="org-org-property-value">headline_1</span>
 <span class="org-org-drawer">:END:</span>
 <span class="org-org-level-2">** Babel</span>

 <span class="org-org-block-begin-line">#+begin_src jupyter-python :session datasci</span>
import numpy as np

np.array(range(1,10))
 <span class="org-org-block-end-line">#+end_src</span>

 <span class="org-org-meta-line">#+RESULTS:</span>
 <span class="org-org-code">: array([1, 2, 3, 4, 5, 6, 7, 8, 9])</span>
</pre>
</div>

 <p>
This approach is easier because there is no need to remember or guess what,
exactly, needs to be prepended with a comma. In this case, the headlines
themselves, the nested  <code>#+begin_src</code> and  <code>#+end_src</code> lines, and the  <code>#+RESULTS:</code> line
were all escaped with commas.
</p>

 <p>
With both of these approaches available, writing about org mode with example org
source blocks should be much easier.
</p>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20220208-org-source.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20220208-org-source.html</guid>
  <pubDate>Tue, 15 Feb 2022 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Task Repeaters in Org Mode</title>
  <description><![CDATA[<div id="content">
 <div id="outline-container-orgc2ee15f" class="outline-2">
 <h2 id="orgc2ee15f">Background</h2>
 <div class="outline-text-2" id="text-orgc2ee15f">
 <div class="PREVIEW">
 <p>
I recently started using org-mode to keep track of a few habits (morning
meditation, getting some sunlight and exercise before my morning coffee, etc.)
and needed to make use of org-mode's calendar features to do so. I've previously
set deadlines and scheduled dates for my  <code>TODO</code> entries, but have seldom used
repeat intervals. My early attempts (  <code>date +1d</code>) worked fine but required some
extra steps if I ever missed a day. This post discusses the  <code>.+</code> and  <code>++</code>
-style repeat intervals, which allow more control over what happens when you
complete a task after the scheduled date.
</p>

</div>
</div>
</div>
 <div id="outline-container-org87b49c3" class="outline-2">
 <h2 id="org87b49c3">Review: Dates, Schedules, and Deadlines in Emacs Org-Mode</h2>
 <div class="outline-text-2" id="text-org87b49c3">
 <p>
The  <a href="https://orgmode.org/manual/Dates-and-Times.html">org-mode manual</a> provides plenty of details on the basics of dates and
times. Here's a quick review:
</p>
 <ul class="org-ul"> <li> <p>
Add a  <b>timestamp</b> with only the date to an org-mode entry with  <code><C-c> .</code>. A
timestamp entry with a  <i>time</i> can be added with  <code><C-u><C-c> .</code>. While there are
 <a href="https://orgmode.org/manual/Creating-Timestamps.html">plenty of methods</a> for modifying timestamps after creation, I typically create
the timestamp and then modify it, if needed, with  <code>S-LEFT/RIGHT/UP/DOWN</code> to
change the day (forward/back) or whichever element of the timestamp the cursor
is located on (up/down).
</p>

 <p>
Another useful timestamp format is  <code><C-c> ! (org-time-stamp-inactive</code>), which
inserts an  <i>inactive</i> timestamp (represented with square rather than angled
brackets; e.g.  <code>[2022-01-16 Sun]</code> rather than  <code><2022-01-16 Sun></code>). Inactive
timestamps work the same as active timestamps, except that they do not appear
on the org-agenda.
</p></li>
 <li>Two timestamps connected by  <code>--</code> make up a  <b>range</b>
(e.g.  <code><2022-02-12 Sat>--<2022-01-16 Sun></code>). A range will appear on the agenda
on the start and stop dates and on all dates in the range.</li>
 <li> <p>
Add a  <b>scheduled</b> date to a headline with  <code><C-c><C-s></code> and a  <b>deadline</b> with
 <code><C-c><C-d></code>. Again, there are  <a href="https://orgmode.org/manual/Deadlines-and-Scheduling.html">plenty of details</a> in the manual. Both of these
types of timestamps affect how the timestamp appears in the agenda. In short,
a "scheduled" headline appears on the date of the timestamp and on every day
following until the entry is marked  <code>DONE</code>. A "deadline" timestamp on a headline
will start appearing in the agenda  <code>org-deadline-warning-days</code> before the
deadline timestamp and will appear daily until it is marked  <code>DONE</code>.
</p>

 <p>
Conceptually, a "deadline" in org mode comports with the common use of the
word: it is the date when a task is supposed to be finished. The meaning of
"scheduled," on the other hand, specifically refers to the date when a task is
to be started. It is not meant to be used in the sense of "scheduling an
appointment." A regular timestamp is better suited for this use. Recall: a
 <i>scheduled</i> headline will appear in the agenda  <i>even after the scheduled date</i>,
which is not especially useful for an event (again, like a meeting or
appointment) that occurs  <i>on</i> a given date.
</p></li>
</ul></div>
</div>
 <div id="outline-container-org86f6015" class="outline-2">
 <h2 id="org86f6015">Repeat Intervals</h2>
 <div class="outline-text-2" id="text-org86f6015">
 <p>
Org-mode makes it possible to schedule recurring events without manually
specifying each repetition date. There are three key formats for repeated
events. Regardless of the format, the main idea is to add a repetition interval
to the timestamp. A repetition interval combines a number with a unit of time to
specify how often a timestamp/schedule/deadline should be repeated. For example:
</p>
 <ul class="org-ul"> <li> <code><2022-01-16 Sun +1d></code> will repeat daily.</li>
 <li> <code><2022-01-29 Sat +5d></code> will repeat every five days.</li>
 <li> <code><2022-01-29 Sat +1y></code> will repeat yearly.</li>
</ul> <p>
When specifying repeat intervals,  <code>y</code> means "yearly",  <code>m</code> means "monthly",  <code>w</code> means
"weekly",  <code>d</code> means "daily", and  <code>h</code> means "hourly." Prepending these values with
 <code>+<number></code> tells how often the event should be repeated.
</p>
</div>
 <div id="outline-container-org51fb5e6" class="outline-3">
 <h3 id="org51fb5e6">Different Types of Repeat Intervals</h3>
 <div class="outline-text-3" id="text-org51fb5e6">
 <p>
Here's where I ran into trouble. I scheduled some events as daily "habits." For
example, I wanted to take a walk each morning, so I included the following in my
planner file:
</p>

 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-level-1">* </span> <span class="org-org-todo">TODO</span> <span class="org-org-level-1"> Walk 1000 steps before coffee</span>
 <span class="org-org-special-keyword">SCHEDULED:</span>  <span class="org-org-date"><2022-01-29 Sat></span>
</pre>
</div>

 <p>
The idea was that, each morning, I would take a walk and mark the task as  <code>DONE</code>,
at which point the date would advance to the next day. This worked fine for a
while, but eventually I missed a day. Suppose I was supposed to walk on
 <code><2022-01-25 Tue></code> but, instead, I got up and immediately started working on my
computer. Before I knew it, it was after noon and I'd only walked between the
coffeepot and the computer. But I didn't give up, and I took a morning walk
again on  <code><2022-01-29 Sat></code>. Here's what happens on  <code><2022-01-29 Sat></code>:
</p>

 <p>
 <b>State before marking  <code>DONE</code>:</b>
</p>
 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-level-1">* </span> <span class="org-org-todo">TODO</span> <span class="org-org-level-1"> Walk 1000 steps before coffee</span>
 <span class="org-org-special-keyword">SCHEDULED:</span>  <span class="org-org-date"><2022-01-25 Tue +1d></span>
</pre>
</div>

 <p>
 <b>State after marking  <code>DONE</code>:</b>
</p>

 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-level-1">* </span> <span class="org-org-todo">TODO</span> <span class="org-org-level-1"> Walk 1000 steps before coffee</span>
 <span class="org-org-special-keyword">SCHEDULED:</span>  <span class="org-org-date"><2022-01-26 Wed +1d></span>
 <span class="org-org-drawer">:PROPERTIES:</span>
 <span class="org-org-special-keyword">:LAST_REPEAT:</span>  <span class="org-org-date">[2022-01-29 Sat 09:11]</span>
 <span class="org-org-drawer">:END:</span>
- State "DONE"       from "TODO"        <span class="org-org-date">[2022-01-29 Sat 09:11]</span>
</pre>
</div>

 <p>
The scheduled date advances by one day, but that day is still in the past. If
I really,  <i>really</i> need to account for every day, maybe this is what I want. I
could fill out the rest of the days between 2022-01-25 and 2022-01-29 for the
sake of completeness. But oftentimes, if I don't mark something as done, it's
because  <i>I haven't done it</i>. I want to indicate that I completed the task  <i>today</i>
and I plan to complete the task again  <i>tomorrow</i>.
</p>

 <p>
There are two special repeaters for situations like this.
</p>
</div>
 <div id="outline-container-orgdc169a8" class="outline-4">
 <h4 id="orgdc169a8">The  <code>.+</code> Repeater</h4>
 <div class="outline-text-4" id="text-orgdc169a8">
 <p>
Instead of scheduling with  <code>+1d</code>, we can use  <code>.+1d</code> to specify that, after we mark a
task  <code>DONE</code> it should advance by exactly one day from the date (and time, if the
timestamp includes a time) when we marked it  <code>DONE</code>. Let's walk through an
example. Let's say I was supposed to clean the kitchen on Sunday, January 9, and
weekly thereafter. But suppose I didn't get to it until Saturday, January 29.
</p>

 <p>
 <b>State before marking  <code>DONE</code>:</b>
</p>
 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-level-1">* </span> <span class="org-org-todo">TODO</span> <span class="org-org-level-1"> Clean the Kitchen</span>
 <span class="org-org-special-keyword">SCHEDULED:</span>  <span class="org-org-date"><2022-01-09 Sun .+1w></span>
</pre>
</div>

 <p>
 <b>State after marking  <code>DONE</code>:</b>
</p>
 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-level-1">* </span> <span class="org-org-todo">TODO</span> <span class="org-org-level-1"> Clean the Kitchen</span>
 <span class="org-org-special-keyword">SCHEDULED:</span>  <span class="org-org-date"><2022-02-05 Sat .+1w></span>
 <span class="org-org-drawer">:PROPERTIES:</span>
 <span class="org-org-special-keyword">:LAST_REPEAT:</span>  <span class="org-org-date">[2022-01-29 Sat 09:28]</span>
 <span class="org-org-drawer">:END:</span>
- State "DONE"       from "TODO"        <span class="org-org-date">[2022-01-29 Sat 09:28]</span>
</pre>
</div>
 <p>
A couple of noteworthy things happened here:
</p>
 <ul class="org-ul"> <li>The next scheduled date advanced to a  <i>future</i> date one week from the
 <code>LAST_REPEAT</code> date.</li>
 <li>The next scheduled date did  <i>not</i> schedule for the next  <i>Sunday</i> but for the date
one week from when it was marked  <code>DONE</code>, a Saturday.</li>
</ul></div>
</div>
 <div id="outline-container-orgd37c9e7" class="outline-4">
 <h4 id="orgd37c9e7">The  <code>++</code> Repeater</h4>
 <div class="outline-text-4" id="text-orgd37c9e7">
 <p>
The  <code>++</code> repeater is very similar to the  <code>.+</code> repeater insofar as it will also
advance the scheduled date into the future. However, it will  <i>also</i> match the
original scheduled time and day of the week. Here's the previous example,
updated to use the  <code>++</code> syntax.
</p>

 <p>
 <b>State before marking  <code>DONE</code>:</b>
</p>
 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-level-1">* </span> <span class="org-org-todo">TODO</span> <span class="org-org-level-1"> Clean the Kitchen</span>
 <span class="org-org-special-keyword">SCHEDULED:</span>  <span class="org-org-date"><2022-01-09 Sun ++1w></span>
</pre>
</div>

 <p>
 <b>State after marking  <code>DONE</code>:</b>
</p>
 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-level-1">* </span> <span class="org-org-todo">TODO</span> <span class="org-org-level-1"> Clean the Kitchen</span>
 <span class="org-org-special-keyword">SCHEDULED:</span>  <span class="org-org-date"><2022-01-30 Sun ++1w></span>
 <span class="org-org-drawer">:PROPERTIES:</span>
 <span class="org-org-special-keyword">:LAST_REPEAT:</span>  <span class="org-org-date">[2022-01-29 Sat 09:35]</span>
 <span class="org-org-drawer">:END:</span>
- State "DONE"       from "TODO"        <span class="org-org-date">[2022-01-29 Sat 09:35]</span>
</pre>
</div>

 <p>
It is now scheduled for the next Sunday (even though that's only one day after
the  <code>LAST_REPEAT</code> date). In other words, it will always advance into the future,
but it will match the scheduled day of the week instead of advancing the
scheduled date exactly be the repeat interval.
</p>

 <p>
One consequence of this behavior is that the next  <code>SCHEDULED</code> date might be less
than the repeater interval in the future relative to the  <code>LAST_REPEAT</code> date. For
example, if I schedule cleaning each Sunday, but I don't get to it until
Wednesday one week, the next repeat will still be scheduled for the following
Sunday, only four days later.
</p>
</div>
</div>
</div>
 <div id="outline-container-org37497b2" class="outline-3">
 <h3 id="org37497b2">Marking Tasks with Repeaters  <code>DONE</code> (For Good)</h3>
 <div class="outline-text-3" id="text-org37497b2">
 <p>
You may want to end a repeated task—stop it from appearing in your agenda and
mark it  <code>DONE</code> —without entirely deleting the task. Maybe you want to maintain the
task history or re-activate the task in the future. There are two approaches to
this.
</p>

 <ol class="org-ol"> <li>Mark the task as  <code>DONE</code> by invoking the  <code>org-todo</code> function with the numeric
prefix of  <code>-1</code>. You can do this with:
 <ul class="org-ul"> <li> <code><C-u> -1 <C-t></code> or  <code><C--1><C-t></code>, or</li>
 <li> <code><C-u> org-todo</code> or  <code><C--1> org-todo</code>,
and then changing the state to  <code>DONE</code>. ( <code><C--1></code> means to hold Control and type
 <code>-1</code>).</li>
</ul></li>
 <li>Deactivate the timestamp. Org will not repeat inactive timestamps. You can do
this by placing the cursor on one of the angle brackets  <code><,></code> on either side of
the timestamp and pressing the up arrow. This will change the angle brackets
to square brackets, indicating an inactive timestamp.</li>
</ol></div>
</div>
</div>
 <div id="outline-container-org0d00fdb" class="outline-2">
 <h2 id="org0d00fdb">Further Reading</h2>
 <div class="outline-text-2" id="text-org0d00fdb">
 <p>
The org-mode manual is the best place to learn more about timestamps, schedules,
and deadlines in general and repeated tasks in particular. Here are some places
to start:
</p>
 <ul class="org-ul"> <li> <a href="https://orgmode.org/manual/Timestamps.html">Timestamps</a></li>
 <li> <a href="https://orgmode.org/manual/Repeated-tasks.html">Repeated Tasks</a></li>
 <li> <a href="https://orgmode.org/manual/Dates-and-Times.html">Dates and Times (Index Page)</a></li>
</ul></div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20220116-org-time.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20220116-org-time.html</guid>
  <pubDate>Sat, 29 Jan 2022 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Org Babel Source Blocks for R</title>
  <description><![CDATA[<div id="content">
 <div id="outline-container-org942136d" class="outline-2">
 <h2 id="org942136d">Background</h2>
 <div class="outline-text-2" id="text-org942136d">
 <div class="preview">
 <p>
 <a href="https://orgmode.org/worg/org-contrib/babel/intro.html">Org Babel</a> is one of the best tools available for  <a href="https://www-cs-faculty.stanford.edu/~knuth/lp.html">literate programming</a>. As a data scientist, I use it
as a plain-text alternative to Jupyter notebooks. Org-mode files are much easier to track with
version control and don't require the overhead of a browser. There are tradeoffs: Jupyter notebooks
handle the display of different types of output (text results, images, interactive figures, etc.) in
a way that is both seamless and visually appealing. Displaying figures at all can be a challenge
when getting started with org-babel. This post covers the basics of using org-babel for common data
science tasks in R.
</p>

</div>

 <p>
I will specifically talk about using org-babel in interactive (session-based) evaluation, much like
how you would use a Jupyter notebook. Each org-babel source block is executed in the same
environment, so data objects persist between source blocks. Some specific org-babel behaviors will
depend on the specifics of your org-babel configuration; you can see mine below <sup> <a id="fnr.1" class="footref" href="#fn.1">1</a></sup>.
</p>

 <p>
 <i>For notes on setting up org-babel to work with R, read  <a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-R.html">this article</a>.</i>
</p>
</div>
</div>
 <div id="outline-container-org795192c" class="outline-2">
 <h2 id="org795192c">R Source Headers</h2>
 <div class="outline-text-2" id="text-org795192c">
 <p>
I tend to use two different header configurations, one for code output and one for figures.
</p>
</div>
 <div id="outline-container-orgd1a13e7" class="outline-3">
 <h3 id="orgd1a13e7">Code</h3>
 <div class="outline-text-3" id="text-orgd1a13e7">
 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-block-begin-line">#+begin_src R :session mysession</span>
 <span class="org-org-block"> <span class="org-comment-delimiter"># </span></span> <span class="org-org-block"> <span class="org-comment">Code goes here</span></span>
 <span class="org-org-block"> <span class="org-function-name">add_1</span></span> <span class="org-org-block"> </span> <span class="org-org-block"> <span class="org-ess-assignment"><-</span></span> <span class="org-org-block"> </span> <span class="org-org-block"> <span class="org-ess-keyword">function</span></span> <span class="org-org-block">(x) {</span>
 <span class="org-org-block">  x + 1</span>
 <span class="org-org-block">}</span>

 <span class="org-org-block">add_1(99)</span>
 <span class="org-org-block-end-line">#+end_src</span>
</pre>
</div>

 <p>
This (given my org-babel config) <sup> <a id="fnr.1.100" class="footref" href="#fn.1">1</a></sup> will appear as follows once exported:
</p>

 <div class="org-src-container">
 <pre class="src src-R"> <span class="org-comment-delimiter"># </span> <span class="org-comment">Code goes here</span>
 <span class="org-function-name">add_1</span>  <span class="org-ess-assignment"><-</span>  <span class="org-ess-keyword">function</span>(x) {
  x + 1
}

add_1(99)
</pre>
</div>

 <pre class="example">
100
</pre>
</div>
 <div id="outline-container-org2e9139e" class="outline-4">
 <h4 id="org2e9139e">Displaying Tabular Output</h4>
 <div class="outline-text-4" id="text-org2e9139e">
 <p>
When not dealing with plotting outputs, there are two main header options for result formatting that I tend
to use:  <code>:results output</code> and  <code>:results value</code> (the default). You can find details on these two modes
 <a href="https://orgmode.org/manual/Results-of-Evaluation.html">here</a>.
</p>

 <p>
The biggest differences between the two, in my experience, are visible when displaying or exporting
tabular data (e.g. a  <code>data.frame</code> or  <code>tibble</code>). I prefer the  <code>:results output</code> formatting for interactive
work within an org file, simply because it is more compact.  <code>:results value</code> tends to result in more
readable exports, though.
</p>
</div>
 <ul class="org-ul"> <li> <a id="orgfb6e47f"></a>Value <br></br> <div class="outline-text-5" id="text-orgfb6e47f">
 <p>
(With  <code>:results value</code> header arg).
</p>
 <div class="org-src-container">
 <pre class="src src-R">head(mtcars)
</pre>
</div>

 <table> <colgroup> <col class="org-right"></col> <col class="org-right"></col> <col class="org-right"></col> <col class="org-right"></col> <col class="org-right"></col> <col class="org-right"></col> <col class="org-right"></col> <col class="org-right"></col> <col class="org-right"></col> <col class="org-right"></col> <col class="org-right"></col></colgroup> <thead> <tr> <th scope="col" class="org-right">mpg</th>
 <th scope="col" class="org-right">cyl</th>
 <th scope="col" class="org-right">disp</th>
 <th scope="col" class="org-right">hp</th>
 <th scope="col" class="org-right">drat</th>
 <th scope="col" class="org-right">wt</th>
 <th scope="col" class="org-right">qsec</th>
 <th scope="col" class="org-right">vs</th>
 <th scope="col" class="org-right">am</th>
 <th scope="col" class="org-right">gear</th>
 <th scope="col" class="org-right">carb</th>
</tr></thead> <tbody> <tr> <td class="org-right">21</td>
 <td class="org-right">6</td>
 <td class="org-right">160</td>
 <td class="org-right">110</td>
 <td class="org-right">3.9</td>
 <td class="org-right">2.62</td>
 <td class="org-right">16.46</td>
 <td class="org-right">0</td>
 <td class="org-right">1</td>
 <td class="org-right">4</td>
 <td class="org-right">4</td>
</tr> <tr> <td class="org-right">21</td>
 <td class="org-right">6</td>
 <td class="org-right">160</td>
 <td class="org-right">110</td>
 <td class="org-right">3.9</td>
 <td class="org-right">2.875</td>
 <td class="org-right">17.02</td>
 <td class="org-right">0</td>
 <td class="org-right">1</td>
 <td class="org-right">4</td>
 <td class="org-right">4</td>
</tr> <tr> <td class="org-right">22.8</td>
 <td class="org-right">4</td>
 <td class="org-right">108</td>
 <td class="org-right">93</td>
 <td class="org-right">3.85</td>
 <td class="org-right">2.32</td>
 <td class="org-right">18.61</td>
 <td class="org-right">1</td>
 <td class="org-right">1</td>
 <td class="org-right">4</td>
 <td class="org-right">1</td>
</tr> <tr> <td class="org-right">21.4</td>
 <td class="org-right">6</td>
 <td class="org-right">258</td>
 <td class="org-right">110</td>
 <td class="org-right">3.08</td>
 <td class="org-right">3.215</td>
 <td class="org-right">19.44</td>
 <td class="org-right">1</td>
 <td class="org-right">0</td>
 <td class="org-right">3</td>
 <td class="org-right">1</td>
</tr> <tr> <td class="org-right">18.7</td>
 <td class="org-right">8</td>
 <td class="org-right">360</td>
 <td class="org-right">175</td>
 <td class="org-right">3.15</td>
 <td class="org-right">3.44</td>
 <td class="org-right">17.02</td>
 <td class="org-right">0</td>
 <td class="org-right">0</td>
 <td class="org-right">3</td>
 <td class="org-right">2</td>
</tr> <tr> <td class="org-right">18.1</td>
 <td class="org-right">6</td>
 <td class="org-right">225</td>
 <td class="org-right">105</td>
 <td class="org-right">2.76</td>
 <td class="org-right">3.46</td>
 <td class="org-right">20.22</td>
 <td class="org-right">1</td>
 <td class="org-right">0</td>
 <td class="org-right">3</td>
 <td class="org-right">1</td>
</tr></tbody></table> <p>
Note that you may also need to include  <code>:colnames yes</code> in order to ensure the column names display
correctly.
</p>
</div>
</li>

 <li> <a id="orgf2f4b59"></a>Output <br></br> <div class="outline-text-5" id="text-orgf2f4b59">
 <p>
(With  <code>:results output</code> header arg).
</p>
 <div class="org-src-container">
 <pre class="src src-R">head(mtcars)
</pre>
</div>

 <pre class="example">
                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
</pre>
</div>
</li>
</ul></div>
</div>

 <div id="outline-container-org0e45577" class="outline-3">
 <h3 id="org0e45577">Figures</h3>
 <div class="outline-text-3" id="text-org0e45577">
 <p>
I don't find the display and exporting of figures particularly intuitive and finding help tends to
be challening because of differences depending on the plotting system and because of changes over
time.  <i>This approach works as of December 2021</i>. Further details on exporting org source blocks can be
found  <a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-R.html#org7fbd9c2">here</a>.
</p>
</div>
 <div id="outline-container-org050fab7" class="outline-4">
 <h4 id="org050fab7">Base R</h4>
 <div class="outline-text-4" id="text-org050fab7">
 <p>
Using Base R graphics, the following header argument will produce a link to a file which can then be
previewed in your org-mode buffer and exported.
</p>

 <p>
 <code>#+begin_src R :results file graphics :file path/to/file.png</code>
</p>

 <p>
Here's an example.
</p>

 <div class="org-src-container">
 <pre class="src src-R">plot(mpg~hp, data=mtcars, main= <span class="org-string">"Sample Figure"</span>)
grid()
</pre>
</div>


 <figure> <img src="./figures/20211209-R-babel/fig1.png" alt="fig1.png"></img></figure></div>
 <ul class="org-ul"> <li> <a id="orgf5e9afe"></a>Setting Graphical Parameters with Header Arguments <br></br> <div class="outline-text-5" id="text-orgf5e9afe">
 <p>
We can also set some graphical parameters such as figure height and width through the header
arguments. For example, to set the with, height, and resolution, we add  <code>:width 6 :height 3 :units in
:res 100</code>. You can find a complete list of graphical header arguments  <a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-R.html#org075fa45">here</a>.
</p>

 <div class="org-src-container">
 <pre class="src src-R">plot(mpg~hp, data=mtcars, main= <span class="org-string">"Sample Figure"</span>)
grid()
</pre>
</div>


 <figure> <img src="./figures/20211209-R-babel/fig2.png" alt="fig2.png"></img></figure></div>
</li>
</ul></div>

 <div id="outline-container-org9f159e6" class="outline-4">
 <h4 id="org9f159e6">Ggplot and Lattice</h4>
 <div class="outline-text-4" id="text-org9f159e6">
 <p>
Can we just use this approach for everything? From  <a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-R.html#org075fa45">the documentation</a>,
</p>

 <blockquote>
 <p>
If the source code block uses grid-based R graphics, e.g., the lattice and ggplot2 packages, then
care must be taken either to  <code>print()</code> the graphics object, specify  <code>:results</code> output, or run the code
in a  <code>:session</code>. This is because the graphics functions from lattice and ggplot2 return objects that
must be explicitly printed to see them, using the print function. This happens automatically when
run interactively, e.g.,  <code>:session</code>, but when called inside another function, it does not.
</p>
</blockquote>

 <p>
So in our case—as we're interested in  <code>:session</code> evaluation—we  <i>can</i> use this approach for
everything. But care must be taken (i.e. read the documentation) if attempting to use ggplot or
lattice graphics outside of a  <code>:session</code> context.
</p>

 <div class="org-src-container">
 <pre class="src src-R"> <span class="org-ess-modifiers">library</span>(ggplot2)
ggplot(data=mtcars, mapping=aes(x=hp, y=mpg)) + geom_point()
</pre>
</div>


 <figure> <img src="./figures/20211209-R-babel/fig3.png" alt="fig3.png"></img></figure></div>
</div>
</div>
</div>

 <div id="outline-container-org5be352a" class="outline-2">
 <h2 id="org5be352a">An Alternative: Emacs-Jupyter</h2>
 <div class="outline-text-2" id="text-org5be352a">
 <p>
The excellent  <a href="https://github.com/nnicandro/emacs-jupyter">emacs-jupyter</a> package is a solid alternative to the approaches described above. To use
it for R, install the  <code>emacs-jupyter</code> package (e.g. with  <code>(use-package jupyter)</code>. In R, install  <code>IRkernel</code>
(make sure to follow all of the instructions  <a href="https://github.com/IRkernel/IRkernel">here</a> for registering the kernel). Update
 <code>org-babel-load-languages</code> to include  <code>jupyter</code>. E.g.:
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp">(org-babel-do-load-languages
 'org-babel-load-languages
 '((emacs-lisp . t)
   (julia . t)
   (python . t)
   (jupyter . t)))
</pre>
</div>

 <p>
Then you can set up R blocks with:
</p>

 <p>
 <code>#+begin_src jupyter-R :session my-jupyter-session</code>
</p>

 <p>
e.g.
</p>

 <div class="org-src-container">
 <pre class="src src-jupyter-R">1+1
</pre>
</div>

 <pre class="example">
[1] 2
</pre>


 <p>
Using  <code>emacs-jupyter</code> results in a significantly different experience, which warrants a post of its
own (especially because the documentation for using  <code>emacs-jupyter</code> with R is not easy to find or
follow).
</p>

 <p>
A couple of reasons  <code>emacs-jupyter</code> is worth considering:
</p>
 <ul class="org-ul"> <li>if a code block generates a figure, you don't need to specify a filename/path or use any fancy
header arguments to make sure the image appears in your org buffer. The image is named and saved
automatically to  <code>org-babel-jupyter-resource-directory</code>. This makes exploratory analysis
comparatively seamless. I spend much less time tripping over header args with  <code>emacs-jupyter</code>.</li>
 <li>Accessibility of help: pressing  <code><M-i></code> with the cursor over an object opens a new window with
documentation.</li>
</ul></div>
</div>
 <div id="footnotes">
 <h2 class="footnotes">Footnotes: </h2>
 <div id="text-footnotes">

 <div class="footdef"> <sup> <a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"> <p class="footpara">
Some of the above will be affected by the specifics of my org-babel config. Here it is:
</p>

 <div class="org-src-container">
 <pre class="src src-org">;; org-babel
(org-babel-do-load-languages
'org-babel-load-languages
'(
    (emacs-lisp . t)
    (R          . t)
    (python     . t)
    (org        . t)
    (dot        . t)
    (sql        . t)
    (http       . t)
    (latex      . t)
    (js         . t)
    (shell      . t)
    (C          . t)
    (jupyter    . t)
    ))
(setq org-babel-default-header-args '((:eval . "never-export")
                                    (:exports . "both")
                                    (:cache . "no")
                                    (:results . "replace"))
    org-src-fontify-natively t
    org-src-preserve-indentation t
    org-src-tab-acts-natively t
    org-src-window-setup 'current-window
    org-confirm-babel-evaluate nil)

(eval-after-load 'org
(add-hook 'org-babel-after-execute-hook 'org-redisplay-inline-images))
</pre>
</div>

 <ul class="org-ul"> <li>I have it set to export both code and output ( <code>~:exports . "both"</code>). The  <code>"never-export"</code> part
specifies that the code should  <i>not</i> be re-run run during export. I try to ensure that the output is
what I want it to be prior to export, but that's just what works for my workflow.
 <ul class="org-ul"> <li>I noticed this was  <i>not</i> being respected when exporting to html with  <code>ox-publish</code>. It was necessary
to add  <code>(setq org-export-use-babel nil)</code> to prevent the export from triggering re-execution of all
of the source blocks.</li>
</ul></li>
 <li> <code>org-confirm-babel-evaluate-nil</code> results in org babel not asking for confirmation every time I
execute a code block ( <a href="https://orgmode.org/manual/Code-Evaluation-Security.html">details here</a>).</li>
 <li> <code>org-src-preserve-indentation</code> prevents org-babel from automatically indenting code blocks. The
auto-indentation  <i>can</i> look nice, but I found that, more often than not, it resulted in more
challenges in code intentation than it was worth.</li>
 <li>You can look up anything else you're curious about!  <code><C-h>-f</code> and  <code><C-h>-v</code> are your friends.</li>
</ul></div></div>


</div>
</div></div>]]></description>
  <link>https://danliden.com/posts/./20211209-R-babel.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20211209-R-babel.html</guid>
  <pubDate>Sat, 11 Dec 2021 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Made with Org-Mode</title>
  <description><![CDATA[<div id="content">
 <div id="outline-container-orgaf57bd8" class="outline-2">
 <h2 id="orgaf57bd8">Background</h2>
 <div class="outline-text-2" id="text-orgaf57bd8">
 <div class="PREVIEW">
 <p>
I finally made a personal site using org-mode's built-in  <code>ox-publish</code> exporter.
</p>

 <p>
I've written my personal website with org-mode for years (it is, after all,  <a href="https://karl-voit.at/2017/09/23/orgmode-as-markup-only/">one of the most
reasonable markup languages to use for text</a>). But until this point, I've used Hugo (with the  <code>ox-Hugo</code>
exporter). It worked fine, but it always seemed  <i>just a little bit too complicated</i> for my needs. I
wanted to find something where I could basically understand all of the components and where the gap
between my org-mode files and the published output was as small as possible. I wanted to focus more
on the writing and less on understanding the framework.
</p>

</div>
</div>
</div>

 <div id="outline-container-org682f864" class="outline-2">
 <h2 id="org682f864">First Steps</h2>
 <div class="outline-text-2" id="text-org682f864">
</div>
 <div id="outline-container-org53ace4c" class="outline-3">
 <h3 id="org53ace4c">Ox-Publish</h3>
 <div class="outline-text-3" id="text-org53ace4c">
 <p>
 <a href="https://systemcrafters.net/publishing-websites-with-org-mode/building-the-site/">This great guide</a> from System Crafters got me started with  <code>ox-publish</code>. The very short post
how to use  <code>ox-publish</code> to set up a basic site;  <code>htmlize</code> to correctly render code blocks, and
 <code>simple-httpd</code> to preview the site locally. I recommend starting here if you're interested in making
your own site with org-mode.
</p>
</div>
</div>

 <div id="outline-container-org699c66c" class="outline-3">
 <h3 id="org699c66c">GitHub Pages</h3>
 <div class="outline-text-3" id="text-org699c66c">
 <p>
 <a href="https://systemcrafters.net/publishing-websites-with-org-mode/automated-site-publishing/">The followup post</a> is just as useful—it describes the process of publishing the site with GitHub
Pages (or SourceHut; I opted for GitHub Pages). There was one minor point missing from this
article. The described GitHub action runs the site's build script and commits the  <code>public</code> directory
to a new branch. It was, therefore, necessary to add the  <i>local</i> version of the public branch
(which we preview with  <code>simple-httpd</code>) to our  <code>gitignore</code> file to avoid conflicts. Otherwise, this guide
was simple to follow and worked perfectly.
</p>
</div>
</div>
</div>

 <div id="outline-container-org30c21c2" class="outline-2">
 <h2 id="org30c21c2">Some Simple Customization</h2>
 <div class="outline-text-2" id="text-org30c21c2">
 <p>
There were a few simple design and organization changes I wanted before I started writing: a simple
and readable theme; a list of recent posts with short "preview" snippets, and a link to a post
archive.
</p>
</div>

 <div id="outline-container-org0f32d41" class="outline-3">
 <h3 id="org0f32d41">CSS theme</h3>
 <div class="outline-text-3" id="text-org0f32d41">
 <p>
I opted to use  <a href="https://gongzhitaao.org/orgcss/">orgcss</a>, at least for now. It's a stylesheet explicitly designed for use with
org-exported HTML files. It looks (to me) quite a bit nicer than the default and it works well
without any additional configuration. I'm sure I'll want to make some changes in the future, but
it's a great place to start.
</p>

 <p>
I applied this stylesheet to all of the exported .org files by adding the following line to my
 <code>build-site.el</code> configuration file:
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp"> <span class="org-comment-delimiter">;; </span> <span class="org-comment">org-site/build-site.el</span>
 <span class="org-comment-delimiter">;; </span> <span class="org-comment">...</span>
( <span class="org-keyword">setq</span> org-html-head  <span class="org-string">"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://gongzhitaao.org/orgcss/org.css\"/>"</span>)
</pre>
</div>
</div>
</div>

 <div id="outline-container-orgb22a45a" class="outline-3">
 <h3 id="orgb22a45a">Recent Posts</h3>
 <div class="outline-text-3" id="text-orgb22a45a">
 <p>
I wanted to include a few recent posts on the homepage and separately link to the post archive. I
also wanted each of these custom posts to have a short "preview"—a paragraph or so of my choosing
from the post. I adapted my approach to this from  <a href="https://thibaultmarin.github.io/blog/posts/2016-11-13-Personal_website_in_org.html#sec-org-setup">this post</a> (not sure of the author) and  <a href="https://loomcom.com/blog/0110_emacs_blogging_for_fun_and_profit.html">this post</a>
by Seth Morabito ( <a href="https://twitter.com/twylo/">@twylo</a>).
</p>

 <p>
To include the recent posts, I included the first 25 lines of the automatically-generated
 <code>sitemap.org</code> on my index page with:
</p>

 <div class="org-src-container">
 <pre class="src src-org"> <span class="org-org-meta-line">#+INCLUDE: sitemap.org::*posts :lines "-25" :only-contents t</span>
</pre>
</div>
</div>

 <div id="outline-container-orgc3041f6" class="outline-4">
 <h4 id="orgc3041f6">Sitemap Configuration</h4>
 <div class="outline-text-4" id="text-orgc3041f6">
 <p>
I specified the generation of the sitemap using  <code>org-publish-project-alist</code> configuration variable:
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp"> <span class="linenr"> 1: </span> <span class="org-comment-delimiter">;; </span> <span class="org-comment">org-site/build-site.el</span>
 <span class="linenr"> 2: </span>( <span class="org-keyword">setq</span> org-publish-project-alist
 <span class="linenr"> 3: </span>      (list
 <span class="linenr"> 4: </span>       (list  <span class="org-string">"org-site:main"</span>
 <span class="linenr"> 5: </span>              <span class="org-comment-delimiter">;; </span> <span class="org-comment">other configuration settings</span>
 <span class="linenr"> 6: </span>              <span class="org-builtin">:base-directly:</span>  <span class="org-string">"./content"</span>
 <span class="linenr"> 7: </span>              <span class="org-builtin">:auto-sitemap</span> t
 <span class="linenr"> 8: </span>              <span class="org-builtin">:sitemap-title</span> nil
 <span class="linenr"> 9: </span>              <span class="org-builtin">:sitemap-format-entry</span> 'my/org-publish-org-sitemap-format
 <span class="linenr">10: </span>              <span class="org-builtin">:sitemap-function</span> 'my/org-publish-org-sitemap
 <span class="linenr">11: </span>              <span class="org-builtin">:sitemap-sort-files</span> 'anti-chronologically
 <span class="linenr">12: </span>              <span class="org-builtin">:sitemap-filename</span>  <span class="org-string">"sitemap.org"</span>
 <span class="linenr">13: </span>              <span class="org-builtin">:sitemap-style</span> 'tree)))
</pre>
</div>
</div>
</div>

 <div id="outline-container-org4b83a66" class="outline-4">
 <h4 id="org4b83a66">Sitemap Entry Formatting</h4>
 <div class="outline-text-4" id="text-org4b83a66">
 <p>
You'll notice two functions used to format and publish the sitemap entries.  <code>sitemap-format-entry</code>
takes three arguments ( <code>entry</code>,  <code>style</code>, and  <code>project</code>). We only need to worry about the former. Each
 <code>entry</code> is a file or directory in the  <code>base-directory</code> specified in the  <code>org-publish-project-alist</code>
above. My  <code>my/org-publish-org-sitemap-format</code> defun closely follows the one  <a href="https://thibaultmarin.github.io/blog/posts/2016-11-13-Personal_website_in_org.html#orgace8e3d">here</a>.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp"> <span class="linenr"> 1: </span> <span class="org-comment-delimiter">;; </span> <span class="org-comment">org-site/build-site.el</span>
 <span class="linenr"> 2: </span>( <span class="org-keyword">defun</span>  <span class="org-function-name">my/org-publish-org-sitemap-format</span> (entry style project)
 <span class="linenr"> 3: </span>   <span class="org-doc">"Custom sitemap entry formatting: add date"</span>
 <span class="linenr"> 4: </span>  ( <span class="org-keyword">cond</span> ((not (directory-name-p entry))
 <span class="linenr"> 5: </span>         ( <span class="org-keyword">let</span> ((preview ( <span class="org-keyword">if</span> (my/get-preview (concat  <span class="org-string">"content/"</span> entry))
 <span class="linenr"> 6: </span>                            (my/get-preview (concat  <span class="org-string">"content/"</span> entry))
 <span class="linenr"> 7: </span>                           <span class="org-string">"(No preview)"</span>)))
 <span class="linenr"> 8: </span>         (format  <span class="org-string">"[[file:%s][(%s) %s]]\n%s"</span>
 <span class="linenr"> 9: </span>                 entry
 <span class="linenr">10: </span>                 (format-time-string  <span class="org-string">"%Y-%m-%d"</span>
 <span class="linenr">11: </span>                                     (org-publish-find-date entry project))
 <span class="linenr">12: </span>                 (org-publish-find-title entry project)
 <span class="linenr">13: </span>                 preview)))
 <span class="linenr">14: </span>        ((eq style 'tree)
 <span class="linenr">15: </span>         (file-name-nondirectory (directory-file-name entry)))
 <span class="linenr">16: </span>        (t entry)))
</pre>
</div>

 <p>
This does the following:
</p>
 <ol class="org-ol"> <li>Read in each entry's path</li>
 <li>If the entry is  <i>not</i> a directory:
 <ul class="org-ul"> <li>Check if the  <code>my/get-preview</code> defun returns a value (more on  <code>my/get-preview</code> later)</li>
 <li>Assign the preview text to to the  <code>preview</code> variable if  <code>my/get-preview</code> is not null and assigns
 <code>"(No preview)"</code> to  <code>preview</code> otherwise</li>
 <li>Format the output as a link to the entry with  <code>(Date) Title</code> as the description (using the
 <code>org-publish-find-date</code> and  <code>org-publish-find-title</code> defuns to get the dates/titles of each
entry)</li>
 <li>include the  <code>preview</code> (defined above) after a line break</li>
</ul></li>
 <li>If the entry  <i>is</i> a directory (e.g. if the first condition returns  <code>nil</code>) and if the  <code>sitemap-style</code> is
 <code>tree</code>, return the name of the last subdirectory (e.g. the entry  <code>/projects/org-site/content/posts</code> would
return  <code>posts</code>)</li>
 <li>Otherwise, just return the entry unchanged.</li>
</ol></div>
</div>
 <div id="outline-container-org7872e6a" class="outline-4">
 <h4 id="org7872e6a">Sitemap List Formatting</h4>
 <div class="outline-text-4" id="text-org7872e6a">
 <p>
The entries formatted above are all added to a list (formatted in a tree style to represent the
directory structure). We simply convert this list into an org subtree and publish it to the
 <code>sitemap.org</code> file. The conversion is handled in the  <code>my/org-publish-org-sitemap</code> file (again, adapted
from  <a href="https://thibaultmarin.github.io/blog/posts/2016-11-13-Personal_website_in_org.html#orgace8e3d">here</a>).
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp"> <span class="linenr">1: </span> <span class="org-comment-delimiter">;; </span> <span class="org-comment">org-site/build-site.el</span>
 <span class="linenr">2: </span>( <span class="org-keyword">defun</span>  <span class="org-function-name">my/org-publish-org-sitemap</span> (title list)
 <span class="linenr">3: </span>   <span class="org-doc">"Sitemap generation function."</span>
 <span class="linenr">4: </span>  (concat  <span class="org-string">"#+OPTIONS: toc:nil"</span>)
 <span class="linenr">5: </span>  (org-list-to-subtree list))
</pre>
</div>

 <p>
All this does is specify that we do not want a table of contents and that we want our formatted list
of entries (with previews) represented as an org subtree.
</p>
</div>
</div>
 <div id="outline-container-org6900c86" class="outline-4">
 <h4 id="org6900c86">Previews</h4>
 <div class="outline-text-4" id="text-org6900c86">
 <p>
One part we haven't addressed yet is the generation of previews. There are different approaches out
there, but none of them did exactly what I wanted. I borrowed from posts by   <a href="https://loomcom.com/blog/0110_emacs_blogging_for_fun_and_profit.html">Seth Morabito</a> and
especially  <a href="https://ogbe.net/blog/blogging_with_org.html">Dennis Ogbe</a>. The biggest change I wanted was making sure a default "No preview" would be
inserted if there wasn't a preview. I did this by ensuring the  <code>my/get-preview</code> defun would return  <code>nil</code>
(instead of an error) without a preview, and that the entry formatting defun would return "No
preview" if  <code>my/get-preview</code> was  <code>nil</code>.
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp"> <span class="linenr"> 1: </span> <span class="org-comment-delimiter">;; </span> <span class="org-comment">org-site/build-site.el</span>
 <span class="linenr"> 2: </span>( <span class="org-keyword">defun</span>  <span class="org-function-name">my/get-preview</span> (file)
 <span class="linenr"> 3: </span>   <span class="org-doc">"get preview text from a file</span>
 <span class="linenr"> 4: </span>
 <span class="linenr"> 5: </span> <span class="org-doc">Uses the function here as a starting point:</span>
 <span class="linenr"> 6: </span> <span class="org-doc">https://ogbe.net/blog/blogging_with_org.html"</span>
 <span class="linenr"> 7: </span>  ( <span class="org-keyword">with-temp-buffer</span>
 <span class="linenr"> 8: </span>    (insert-file-contents file)
 <span class="linenr"> 9: </span>    (goto-char (point-min))
 <span class="linenr">10: </span>    ( <span class="org-keyword">when</span> (re-search-forward  <span class="org-string">"^#\\+BEGIN_PREVIEW$"</span> nil 1)
 <span class="linenr">11: </span>      (goto-char (point-min))
 <span class="linenr">12: </span>      ( <span class="org-keyword">let</span> ((beg (+ 1 (re-search-forward  <span class="org-string">"^#\\+BEGIN_PREVIEW$"</span> nil 1)))
 <span class="linenr">13: </span>            (end ( <span class="org-keyword">progn</span> (re-search-forward  <span class="org-string">"^#\\+END_PREVIEW$"</span> nil 1)
 <span class="linenr">14: </span>                        (match-beginning 0))))
 <span class="linenr">15: </span>        (buffer-substring beg end)))))
</pre>
</div>

 <p>
This defun takes a file path as an argument and:
</p>
 <ol class="org-ol"> <li>Inserts the contents of the file into a temporary buffer</li>
 <li>Navigates to the beginning of the buffer and searches forward for the  <code>#+BEGIN_PREVIEW</code> block
pattern
 <ul class="org-ul"> <li>If it fails to locate this pattern, the defun returns  <code>nil</code></li>
 <li>If it does locate this pattern, it:
 <ol class="org-ol"> <li>Returns to the beginning of the temporary buffer and repeats the search, recording the location of the
block pattern, saving its location under the name  <code>beg</code></li>
 <li>Searches forward again for the  <code>#+END_PREVIEW</code> pattern, saving its location under the name
 <code>end</code></li>
 <li>Returns the text between  <code>beg</code> and  <code>end</code>: the user-selected preview text.</li>
</ol></li>
</ul></li>
</ol></div>
</div>
</div>
</div>
 <div id="outline-container-org9313356" class="outline-2">
 <h2 id="org9313356">Putting It All Together</h2>
 <div class="outline-text-2" id="text-org9313356">
 <p>
Check out the full source code for the site  <a href="https://github.com/djliden/djliden.github.io">on GitHub</a>.
</p>
</div>
</div>
 <div id="outline-container-orgd3b040d" class="outline-2">
 <h2 id="orgd3b040d">What's Next?</h2>
 <div class="outline-text-2" id="text-orgd3b040d">
 <p>
This site now has everything I need to write more with minimal need to tweak the site configuration
every step of the way (which I found myself doing constantly when using Hugo). That said, there are
a few more things I want to do before moving this site to its permanent home under my personal
domain. These include:
</p>
</div>
 <div id="outline-container-org3ccbb89" class="outline-3">
 <h3 id="org3ccbb89"> <span class="done DONE">DONE</span> Add navigation buttons to return to the home page/about page/archive page/etc. from any page. (incidentally, if you want to get back home,  <a href="../index.html">here's the link</a>).</h3>
 <div class="outline-text-3" id="text-org3ccbb89">
 <p>
 <b>Update:</b> I've added this in a very simple way. I updated my  <code>org-publish-project-alist</code> with:
</p>

 <div class="org-src-container">
 <pre class="src src-emacs-lisp"> <span class="linenr"> 1: </span> <span class="org-comment-delimiter">;; </span> <span class="org-comment">org-site/build-site.el</span>
 <span class="linenr"> 2: </span>( <span class="org-keyword">setq</span> org-publish-project-alist
 <span class="linenr"> 3: </span>      (list
 <span class="linenr"> 4: </span>       (list  <span class="org-string">"org-site:main"</span>
 <span class="linenr"> 5: </span>              <span class="org-comment-delimiter">;; </span> <span class="org-comment">...</span>
 <span class="linenr"> 6: </span>              <span class="org-builtin">:html-preamble</span> (concat  <span class="org-string">"<div class='topnav'></span>
 <span class="linenr"> 7: </span> <span class="org-string">                                     <a href='/index.html'>Home</a> / </span>
 <span class="linenr"> 8: </span> <span class="org-string">                                     <a href='/archive.html'>Blog</a> /</span>
 <span class="linenr"> 9: </span> <span class="org-string">                                     <a href='/about.html'>About Me</a></span>
 <span class="linenr">10: </span> <span class="org-string">                                     </div>"</span>)
 <span class="linenr">11: </span>              <span class="org-comment-delimiter">;; </span> <span class="org-comment">...</span>
 <span class="linenr">12: </span>             )))
</pre>
</div>
</div>
</div>
 <div id="outline-container-org72b90bd" class="outline-3">
 <h3 id="org72b90bd"> <span class="done DONE">DONE</span> Set up a good system for managing images (e.g. for data visualizations from R/Python)</h3>
 <div class="outline-text-3" id="text-org72b90bd">
 <p>
I followed the guide  <a href="https://orgmode.org/worg/org-tutorials/org-publish-html-tutorial.html">here</a> to set up the export of "static" files using the  <code>org-publish-attachment</code>
publication function. The new section of my config looks like this:
</p>

 <div class="org-src-container">
 <pre class="src src-org">(setq org-publish-project-alist
      (list
       (list "org-site:main"
       ;; ...
             )
       ;; this part is new
       (list "org-site:static"
             :base-directory "./content/"
             :base-extension "css\\|js\\|png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf"
             :publishing-directory "./public"
             :recursive t
             :publishing-function 'org-publish-attachment
             )))
</pre>
</div>
</div>
</div>

 <div id="outline-container-org2209827" class="outline-3">
 <h3 id="org2209827"> <span class="todo TODO">TODO</span> Set up and test LaTeX exporting for formulas etc.</h3>
</div>
 <div id="outline-container-org2a3693c" class="outline-3">
 <h3 id="org2a3693c"> <span class="todo TODO">TODO</span> Add a portfolio page showing some of my past work</h3>
</div>
 <div id="outline-container-orgd3b82c1" class="outline-3">
 <h3 id="orgd3b82c1"> <span class="todo TODO">TODO</span> Make a more visually interesting home page</h3>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20211203-this-site.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20211203-this-site.html</guid>
  <pubDate>Fri, 03 Dec 2021 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Resources</title>
  <description><![CDATA[<div id="content">
 <div class="PREVIEW">
 <p>
Here are some resources to reference for building a simple site with org-mode. I've extensively
used the sites listed as models for building the present site and expect to continue to reference
them for some time.
</p>

</div>


 <div id="outline-container-org2943645" class="outline-2">
 <h2 id="org2943645"> <a href="https://thibaultmarin.github.io/blog/posts/2016-11-13-Personal_website_in_org.html#html_head">Personal Website in Org</a></h2>
 <div class="outline-text-2" id="text-org2943645">
 <p>
Good resoures for setting up a custom sitemap as an index page.
</p>
</div>
</div>
 <div id="outline-container-org3b519b7" class="outline-2">
 <h2 id="org3b519b7"> <a href="https://github.com/gongzhitaao/orgcss">OrgCSS Stylesheet</a></h2>
 <div class="outline-text-2" id="text-org3b519b7">
 <p>
Nice-looking basic stylesheet for site. I likely won't stick with this forever but it looks good for
  now.
</p>
</div>
</div>
 <div id="outline-container-org9bb3752" class="outline-2">
 <h2 id="org9bb3752"> <a href="https://loomcom.com/blog/0110_emacs_blogging_for_fun_and_profit.html">loomcom</a></h2>
 <div class="outline-text-2" id="text-org9bb3752">
 <p>
This site includes a good overview of making list of posts with previews of the first few lines of
text.
</p>
</div>
</div>
 <div id="outline-container-org1bd838c" class="outline-2">
 <h2 id="org1bd838c"> <a href="https://ogbe.net/blog/blogging_with_org.html">Blogging using org-mode (and nothing else)</a></h2>
 <div class="outline-text-2" id="text-org1bd838c">
 <p>
By Dennis Ogbe. The code I ultimately used for generating and showing previews closely followed that
from this post.
</p>
</div>
</div>
 <div id="outline-container-orge188485" class="outline-2">
 <h2 id="orge188485"> <a href="https://orgmode.org/worg/org-tutorials/org-publish-html-tutorial.html">Worg Publishing to HTML Tutorial</a></h2>
 <div class="outline-text-2" id="text-orge188485">
 <p>
Good tutorial covering the basics of publishing org-mode projects to html.
</p>
</div>
</div>
 <div id="outline-container-org8b3416a" class="outline-2">
 <h2 id="org8b3416a"> <a href="https://djliden.github.io/">My Site</a></h2>
 <div class="outline-text-2" id="text-org8b3416a">
 <p>
Here is a link to the site I'm making. Ultimately I will add a custom domain.
</p>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20211201-resources.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20211201-resources.html</guid>
  <pubDate>Thu, 02 Dec 2021 08:00:00 +0000</pubDate>
</item>
<item>
  <title>A Simple PyTorch Model for the Numerai Tournament</title>
  <description><![CDATA[<div id="content">
 <div class="preview">
 <p>
 <i>This is another one from the archives. It covers how to train a basic PyTorch
model for use in the Numerai tournament, at least as it was in May 2021. See the original post  <a href="https://pensive-wing-19c199.netlify.app/post/mlp-numerai-05082021/">here.</a></i>
</p>

</div>

 <div id="outline-container-orgf484df0" class="outline-2">
 <h2 id="orgf484df0">Background</h2>
 <div class="outline-text-2" id="text-orgf484df0">
 <p>
This short write up is in pursuit of a personal goal to put more of my work and thoughts to
paper. I'm sure the topic will still be useful to others, but it's not yet fully developed. It's a
sketch of a work in progress.
</p>

 <p>
Last August, I took the fast.ai  <i>Practical Deep Learning for Coders</i> online course (and worked through
the accompanying book). The course taught the fundamentals of deep learning using the  <code>fastai</code> Python
library, which offers a higher-level API (and a vast range of useful features and tools) for
 <code>PyTorch</code>. The course (and book) followed a "top-down" approach: learn how to effectively apply the
models first, and then go back and learn the more foundational concepts, math, etc., in greater
detail.
</p>

 <p>
After spending several months using  <code>fastai</code> for a number of tasks (including the  <a href="https://www.kaggle.com/c/cassava-leaf-disease-classification">Kaggle Cassava Leaf
Disease Classification competition</a>, the  <a href="https://numer.ai/tournament">numer.ai</a> tournament, and a  <a href="https://github.com/djliden/fastai-turtle-classifier">turtle classifier</a>), I decided I
wanted to "pull back the curtain" and start to learn how to use PyTorch. The numer.ai tournament
seemed like an excellent opportunity to do so. The tournament data come in a very "clean" and
ready-to-use format, so grappling with the data doesn't have to be a huge part of the modeling
process. The dataset is big enough for deep learning but not so huge that the models can't be run
locally. And I already have a working fast.ai model up and running, and I know it's running PyTorch
under the hood, so I know that it will work!
</p>

 <p>
One quick note: trying to learn PyTorch is inspired by a desire to learn more;  <i>not</i> by any serious
perceived weaknesses in  <code>fastai</code>. Many  <code>fastai</code> users and community members, such as Zachary Mueller
(see the excellent  <a href="https://walkwithfastai.com/">walk with fastai</a> project) have shown that  <code>fastai</code> is extremely flexible and
extensible. That said:
</p>
 <ul class="org-ul"> <li>Implementations of new methods often appear first as PyTorch models. Using them directly is easier
to me than translating them to a  <code>fastai</code> context.</li>
 <li> <code>fastai</code> sometimes hides so many details that I find it hard to determine what, exactly, my models
are doing. For example, it took me a while to discover that the  <code>fastai</code> tabular model I was using
for the Numerai tournament was implementing batchnorm and dropout layers. The architecture of the
model was, at least initially, opaque to me.</li>
 <li>While  <code>fastai</code>  <i>allows</i> plenty of flexibility, it isn't necessarily built for it. I often need to do
quite a bit of research to figure out how to tweak my training loop in a way that would be trivial
in a direct PyTorch implementation.</li>
 <li>Some of the other learning resources I've been using, such as the excellent  <a href="http://www.d2l.ai/">Dive into Deep
Learning</a> book, use PyTorch. Rather than translating their code into  <code>fastai</code>, I would prefer to
learn PyTorch directly.</li>
</ul> <p>
In this post, I will first briefly show the  <code>fastai</code> model I was previously using, and then introduce
a (simpler) model written in PyTorch. I will conclude with some reflections on the process.
</p>
</div>
 <div id="outline-container-org00bab3d" class="outline-3">
 <h3 id="org00bab3d">Problem Setting</h3>
 <div class="outline-text-3" id="text-org00bab3d">
 <p>
I won't go into much detail about the Numerai tournament itself – the interested reader can learn
more about it  <a href="https://docs.numer.ai/tournament/learn">here</a>. This isn't intended as an introduction to the tournament and I'm not reproducing
my whole data preparation and processing pipeline. That said, it should be very straightforward to
apply the code here to data obtained from the tournament.
</p>

 <p>
The features are all numeric and all take on values of 0, 0.25, 0.5, 0.75, or 1. The targets can
take the same values. Numerai competitors have tested and discussed the impact of treating the
targets as categorical rather than as numeric responses and have generally found that
regression approaches work better than classification approaches. So we will treat this as a
regression problem with numeric features and targets. The criterion we are trying to optimize is the
Spearman's rank correlation coefficient. That is, we want to be able to predict the  <i>order</i> of the
responses as accurately as possible. Most users approximate this by directly optimizing mean squared
error (MSE); we will do the same.
</p>

 <p>
An obvious question at this phase is: given a large number of observations but a small number of
targets (recall: all targets take values of 0, 0.25, 0.5, 0.75, or 1), how exactly are we supposed
to create a meaningful ordering? Well, there are a couple of answers to that. First and foremost:
we're only aiming for a rough ordering. If we could just make sure all of the "0" targets were
predicted lower than all of the "1" targets, we'd be off to a great start! In general, in this
problem, there is a lot of "noise" and very little "signal." We're not going to be able to
precisely order all of the observations, so having only a few targets to work with doesn't hurt as
much as it may seem.
</p>

 <p>
Second, it's possible to obtain reasonably high Spearman correlation values when "blocks" of
predictions are correctly ordered but when the observations within those blocks are completely
shuffled. The figure below shows the results of a simulation wherein 5000 observations were divided
into five targets roughly in proportion to those in the Numerai tournament. "Predictions" were
generated such that all of the predictions in the lowest category were lower than all of the
predictions in the next category for all categories. For example, any prediction in category 0.25
was guaranteed to be lower than any prediction in category 0.5. Within each category, however, the
predictions were shuffled. This experiment was repeated 5000 times. The average Spearman correlation
coefficient was 0.859 (the highest possible is 1).
</p>
 <div class="org-center">

 <figure> <img src="./figures/20210514-pytorch-numerai/spearman-sim.png" alt="spearman-sim.png"></img> <figcaption> <span class="figure-number">Figure 1: </span>Even when predictions were shuffled within "blocks," high Spearman correlation coefficients were obtained when those blocks were placed in order.</figcaption></figure></div>

 <p>
So even when large "blocks" of predictions were shuffled internally, as long as those "blocks" were
ordered correctly relative to each other, the Spearman correlation coefficients remained high.
</p>
</div>
</div>
</div>

 <div id="outline-container-org595a668" class="outline-2">
 <h2 id="org595a668">Original  <code>fastai</code> model</h2>
 <div class="outline-text-2" id="text-org595a668">
 <p>
My original  <code>fastai</code> implementation does not differ appreciably from the implementation detailed in
the official  <a href="https://docs.fast.ai/tutorial.tabular.html">fastai Tabular Training tutorial</a>. The components are, briefly:
</p>
</div>
 <div id="outline-container-org245d561" class="outline-3">
 <h3 id="org245d561">Data Setup</h3>
 <div class="outline-text-3" id="text-org245d561">
 <p>
First, we use the  <a href="https://docs.fast.ai/tabular.core.html#TabularPandas">TabularPandas</a> helper to load the data and to generate our  <code>DataLoaders</code>.  <code>DataLoaders</code>
provide a convenient wrapper around the training and validation data and facilitate passing batches
of data to the model during the training loop.
</p>

 <p>
Our data (including training and validation examples) exist in a Pandas DataFrame called
 <code>training_data</code>. We have defined indices  <code>train_idx</code> and  <code>val_idx</code> corresponding to the training and
validation examples.
</p>

 <div class="org-src-container">
 <pre class="src src-python"> <span class="org-variable-name">splits</span> = ( <span class="org-builtin">list</span>(train_idx),  <span class="org-builtin">list</span>(val_idx))
 <span class="org-variable-name">data</span> = TabularPandas(training_data, cat_names= <span class="org-constant">None</span>,
                    cont_names= <span class="org-builtin">list</span>(feature_cols.values),
                    y_names=target_cols, splits = splits)

 <span class="org-variable-name">dls</span> = data.dataloaders(bs = 2048)
</pre>
</div>
</div>
</div>

 <div id="outline-container-org8b186d6" class="outline-3">
 <h3 id="org8b186d6">Model Setup</h3>
 <div class="outline-text-3" id="text-org8b186d6">
 <p>
We will use a  <code>fastai</code>  <a href="https://docs.fast.ai/tabular.learner.html#tabular_learner">tabular <sub>learner</sub></a> without much modification and without adjusting many of the
possible options. As noted above, we're using the MSE loss function.  <code>fastai</code> also lets us directly
specify that we want to see the Spearman correlation coefficient as a "metric." It's not used in the
optimization process, but we get to see the change in the Spearman correlation coefficient after
each epoch.
</p>

 <div class="org-src-container">
 <pre class="src src-python"> <span class="org-variable-name">learn</span> = tabular_learner(dls, layers=[200,200],
                        loss_func=MSELossFlat(),
                        metrics = [SpearmanCorrCoef()])
</pre>
</div>
</div>
</div>

 <div id="outline-container-org7090d6c" class="outline-3">
 <h3 id="org7090d6c">Training Loop</h3>
 <div class="outline-text-3" id="text-org7090d6c">
 <p>
 <code>fastai</code> handles the training loop for us – we don't need to write it out manually. Here we say to
train the model for three epochs and to apply a weight decay (l2 penalty) of 0.1.
</p>

 <div class="org-src-container">
 <pre class="src src-python">learn.fit_one_cycle(3, wd = 0.1)
</pre>
</div>
</div>
</div>

 <div id="outline-container-org3fda739" class="outline-3">
 <h3 id="org3fda739">Summary</h3>
 <div class="outline-text-3" id="text-org3fda739">
 <p>
Without going into too much detail – this is, after all, supposed to be a post about PyTorch, which
I've scarcely mentioned so far – I want to highlight some of the key features and shortcomings of
this approach:
</p>
 <ul class="org-ul"> <li>It's concise: we've created a suitable data iterator, defined the model, and run through the
training loop in only a few lines of code. The training loop in particular took only one line!</li>
 <li>A lot of detail is hidden. We rely on "sane defaults" to a very high degree. What is the model
architecture? Which optimizer is used? How will information be presented to us throughout the
training loop?</li>
 <li>It  <i>does</i> readily expose some of the key hyperparameters we'll likely wish to experiment with, such
as weight decay and the number and size of layers. Ultimately, once we have a better understanding
of the architecture, it's also not too difficult to modify hyperparameters associated with dropout
and batchnorm.</li>
</ul> <p>
In short, this method gets you from a blank screen to a trainable deep learning model with some
easily-accessible hyperparameters to optimize about as quickly as one could ask for, but it keeps a
lot of the details hidden.
</p>
</div>
</div>
</div>

 <div id="outline-container-orgb61be3f" class="outline-2">
 <h2 id="orgb61be3f">A Simple PyTorch Model</h2>
 <div class="outline-text-2" id="text-orgb61be3f">
 <p>
In an effort to learn some basic PyTorch, I set out to develop a very simple working model. It
doesn't have all of the bells and whistles of the fastai model – no batchnorm, no dropout, no
weight decay – but it works and it is generally easy to understand what the model is doing. This
provides a good foundation for further experimentation with more complex architectures.
</p>
</div>
 <div id="outline-container-orga7d2a2b" class="outline-3">
 <h3 id="orga7d2a2b">Data Setup</h3>
 <div class="outline-text-3" id="text-orga7d2a2b">
 <p>
A common theme throughout this section is that "It takes a bit more code to do  <code>____</code> in PyTorch than
in  <code>fastai</code>. Setting up the data is no exception. I mostly followed  <a href="https://pytorch.org/tutorials/beginner/basics/data_tutorial.html#preparing-your-data-for-training-with-dataloaders">this guide</a> for setting up the data
for use by the PyTorch model.
</p>

 <p>
The biggest additional step is that we must define a
custom class inheriting from the PyTorch  <code>DataSet</code> class. The class must define:
</p>
 <ul class="org-ul"> <li> <code>__len__()</code>: a method for finding the length of the dataset; and</li>
 <li> <code>__getitem__()</code>: a method for returning an item from the dataset given an index.</li>
</ul> <p>
I wrote the  <code>NumerData</code> class for this purpose as shown below. Note that the  <code>data</code> argument refers to
the whole training dataset;  <code>feature_cols</code> is a list of the feature column names; and  <code>target_cols</code> is a
named list of the target column names.
</p>

 <div class="org-src-container">
 <pre class="src src-python"> <span class="org-keyword">class</span>  <span class="org-type">NumerData</span>(Dataset):
     <span class="org-keyword">def</span>  <span class="org-function-name">__init__</span>( <span class="org-keyword">self</span>, data, feature_cols, target_cols):
         <span class="org-keyword">self</span>.data = data
         <span class="org-keyword">self</span>.features = data[feature_cols].copy().values.astype(np.float32)
         <span class="org-keyword">self</span>.targets = data[target_cols].copy().values.astype(np.float32)
         <span class="org-keyword">self</span>.eras = data.era.copy().values

     <span class="org-keyword">def</span>  <span class="org-function-name">__len__</span>( <span class="org-keyword">self</span>):
         <span class="org-keyword">return</span>( <span class="org-builtin">len</span>( <span class="org-keyword">self</span>.data))
    
     <span class="org-keyword">def</span>  <span class="org-function-name">__getitem__</span>( <span class="org-keyword">self</span>, idx):
         <span class="org-keyword">if</span> torch.is_tensor(idx):
             <span class="org-variable-name">idx</span> = idx.tolist() 

         <span class="org-keyword">return</span>  <span class="org-keyword">self</span>.features[idx],  <span class="org-keyword">self</span>.targets[idx],  <span class="org-keyword">self</span>.eras[idx]
</pre>
</div>

 <p>
The dataset ended up being the biggest performance bottleneck for me, at least at first. I had
initially put off some amount of the processing to the  <code>__getitem__()</code> method, which meant that every
time the  <code>DataLoader</code> needed to return a new batch of data, it needed to do a lot more indexing and
processing than it should have. A couple of examples:
</p>
 <ul class="org-ul"> <li>I explicitly included type conversions (to tensors) in the  <code>__getitem__()</code> method. This was
unnecessary as the  <code>DataLoader</code> handles this by default. It also took time.</li>
 <li>I made the  <code>DataLoader</code> pull the features and targets from the full dataset each time instead of
storing them as separate objects. That is, instead of just  <code>return self.features[idx]</code>, I first
defined  <code>self.features = data[feature_cols]</code>. This should be handled in the  <code>__init__()</code> method, not
each time  <code>__getitem__()</code> is called.</li>
</ul> <p>
Note that the  <code>NumerData</code> class currently does not define any data. We need to instantiate an object of
type  <code>NumerData</code> with some data in order to use it. We will define separate ~DataSet~s for the
training and validation data.
</p>

 <div class="org-src-container">
 <pre class="src src-python"> <span class="org-variable-name">train_ds</span> = NumerData(training_data.iloc[train_idx],
                     feature_cols, target_cols)

 <span class="org-variable-name">val_ds</span> = NumerData(training_data.iloc[val_idx],
                     feature_cols, target_cols)
</pre>
</div>

 <p>
With these defined, we can use use the PyTorch  <code>DataLoader</code> to handle iteration through the ~DataSet~s
in batches. Again, we instantiate separate ~DataLoader~s for our train and validation sets:
</p>

 <div class="org-src-container">
 <pre class="src src-python"> <span class="org-variable-name">train_dl</span> = DataLoader(train_ds, batch_size = 2048, shuffle= <span class="org-constant">False</span>, num_workers=0)
 <span class="org-variable-name">val_dl</span> = DataLoader(val_ds, batch_size =  <span class="org-builtin">len</span>(val_ds), shuffle= <span class="org-constant">False</span>)
</pre>
</div>

 <p>
Now our data are ready to go and we can define the model.
</p>
</div>
</div>
 <div id="outline-container-org2a6ea9c" class="outline-3">
 <h3 id="org2a6ea9c">The Model</h3>
 <div class="outline-text-3" id="text-org2a6ea9c">
 <p>
The model has a few separate components – a fact that is easy to miss when working with
 <code>fastai</code>. We need to define:
</p>
 <ul class="org-ul"> <li>The model architecture itself</li>
 <li>The loss function (or criterion)</li>
 <li>The optimizer</li>
</ul> <p>
Furthermore, when defining the model, we need to be (just a little bit) mindful of the dimension of
our inputs (another thing  <code>fastai</code> takes care of automatically). Ultimately, none of this is
particularly onerous:
</p>

 <div class="org-src-container">
 <pre class="src src-python"> <span class="org-variable-name">n_feat</span> =  <span class="org-builtin">len</span>(feature_cols)
 <span class="org-variable-name">net</span> = nn.Sequential(nn.Linear(n_feat, 256),
                    nn.ReLU(),
                    nn.Linear(256, 1))

 <span class="org-variable-name">criterion</span> = nn.MSELoss()
 <span class="org-variable-name">optim</span> = torch.optim.Adam(params = net.parameters())
</pre>
</div>

 <p>
The model we have defined is a simple multilayer perceptron (MLP). Our input batch is passed to a
linear layer with 256 "neurons." The output of this layer is passed to the  <code>ReLU()</code>, or  <i>rectified
linear unit</i>, layer. The output of this layer is passed to another linear layer, which produces the
one-dimensional output.
</p>

 <p>
As noted above, we use MSE as our loss function. We use the  <code>Adam</code> optimizer; details on this
optimizer can be found  <a href="https://pytorch.org/docs/master/generated/torch.optim.Adam.html">here</a>.
</p>
</div>
</div>
 <div id="outline-container-orgf8f789e" class="outline-3">
 <h3 id="orgf8f789e">The Training Loop</h3>
 <div class="outline-text-3" id="text-orgf8f789e">
 <p>
The training loop represents the part of the implementation where  <code>fastai</code> provides the most help. In
 <code>fastai</code>, the whole process is largely automatic. We called  <code>learn.fit_one_cycle()</code>, specified the number
of epochs, and let the model run. But a lot is happening behind the scenes, and we need to write
that logic manually in PyTorch.
</p>

 <p>
We will write a method to train a single epoch. We can then put this in a loop to train multiple
epochs if needed.
</p>

 <div class="org-src-container">
 <pre class="src src-python"> <span class="org-keyword">def</span>  <span class="org-function-name">train</span>(epoch, model):
     <span class="org-variable-name">device</span> = torch.device( <span class="org-string">"cuda:0"</span>  <span class="org-keyword">if</span> torch.cuda.is_available()  <span class="org-keyword">else</span>  <span class="org-string">"cpu"</span>)
     <span class="org-variable-name">model</span> = model.to(device)
    
     <span class="org-comment-delimiter"># </span> <span class="org-comment">set up tqdm bar</span>
     <span class="org-variable-name">pbar</span> = tqdm( <span class="org-builtin">enumerate</span>(BackgroundGenerator(train_dl)),
                total= <span class="org-builtin">len</span>(train_dl), position=0, leave= <span class="org-constant">False</span>)
    
     <span class="org-keyword">for</span> batch_idx, (data, target, era)  <span class="org-keyword">in</span> pbar:
         <span class="org-variable-name">data</span>,  <span class="org-variable-name">target</span> = data.to(device), target.to(device)
        
         <span class="org-comment-delimiter"># </span> <span class="org-comment">reset gradients</span>
        optim.zero_grad()
        
         <span class="org-comment-delimiter"># </span> <span class="org-comment">forward pass</span>
         <span class="org-variable-name">out</span> = model(data)

         <span class="org-comment-delimiter">#</span> <span class="org-comment">compute loss</span>
         <span class="org-variable-name">loss</span> = criterion(out, target)

         <span class="org-comment-delimiter">#</span> <span class="org-comment">backpropagation</span>
        loss.backward()
        
         <span class="org-comment-delimiter">#</span> <span class="org-comment">update the parameters</span>
        optim.step()

         <span class="org-keyword">if</span> batch_idx % 100 == 0:
             <span class="org-keyword">print</span>(f <span class="org-string">'Train Epoch/Batch: {epoch}/{batch_idx}\tTraining Loss: {loss.item():.4f}'</span>)
</pre>
</div>

 <p>
In this method, we:
</p>
 <ol class="org-ol"> <li>Identify whether we have a GPU available for training and, if so, pass the model to the GPU.</li>
 <li>Using the  <code>tqdm</code> package, set up a progress bar for tracking model progress.</li>
 <li>For each batch in the  <code>DataLoader</code>:
 <ol class="org-ol"> <li>Send the features/targets to the appropriate device (GPU if available)</li>
 <li>Reset the gradients</li>
 <li>Compute the forward pass: pass the batch through the model and compute the outputs for each
observation in the batch</li>
 <li>Compute the loss</li>
 <li>Back-propagate (compute the gradient of the loss function with respect to the weights)</li>
 <li>Update the weights</li>
 <li>Occasionally print the training loss</li>
</ol></li>
</ol> <p>
We can define a similar method for evaluating our model performance on the validation set (without
updating model weights). Suppose we've defined a function called  <code>era_spearman</code> to calculate the
average Spearman correlation coefficient across Numerai tournament eras in the validation data. Then
we can define a validation method as:
</p>

 <div class="org-src-container">
 <pre class="src src-python"> <span class="org-keyword">def</span>  <span class="org-function-name">test</span>(model):
     <span class="org-variable-name">device</span> = torch.device( <span class="org-string">"cuda:0"</span>  <span class="org-keyword">if</span> torch.cuda.is_available()  <span class="org-keyword">else</span>  <span class="org-string">"cpu"</span>)

     <span class="org-variable-name">test_loss</span> = 0
     <span class="org-keyword">with</span> torch.no_grad():
         <span class="org-keyword">for</span> data, target, era  <span class="org-keyword">in</span> val_dl:
             <span class="org-variable-name">data</span>,  <span class="org-variable-name">target</span> = data.to(device), target.to(device)
            
             <span class="org-variable-name">out</span> = model(data)
             <span class="org-variable-name">test_loss</span> += criterion(out, target).item()  <span class="org-comment-delimiter"># </span> <span class="org-comment">sum up batch loss</span>
             <span class="org-variable-name">val_corr</span> = era_spearman(preds = out.cpu().numpy().squeeze(),
                                    targs = target.cpu().numpy().squeeze(),
                                    eras = era)

         <span class="org-comment-delimiter">#</span> <span class="org-comment">test_loss /= len(val_dl.dataset)</span>
         <span class="org-keyword">print</span>(f <span class="org-string">'Test Loss: {test_loss:.4f}, Test Correlation: {val_corr:.4f}'</span>)
</pre>
</div>

 <p>
This follows much of the same logic as the training method, with some key exceptions:
</p>
 <ul class="org-ul"> <li>Everything happens under the  <code>torch.no_grad()</code> context handler. Why? We're only using the validation
data to assess the performance of our model; we don't want to compute any gradients and we
certainly do not want to use these data to update our model weights.</li>
 <li>We make sure to calculate the metric we're really interested in (the Spearman correlation). This
is useful to check in case the loss function (MSE) does not actually improve the Spearman
correlation.</li>
 <li>In this particular case, I did  <i>not</i> divide the validation data into batches (put differently, the
batch size is the length of the validation set). It certainly could have been divided into
batches, though, and doing so may be necessary with larger datasets or in the face of significant
memory constraints.</li>
</ul></div>
</div>
 <div id="outline-container-orgd323a00" class="outline-3">
 <h3 id="orgd323a00">Train the Model</h3>
 <div class="outline-text-3" id="text-orgd323a00">
 <p>
We can finally train the model! This part is a simple  <code>for</code> loop.
</p>

 <div class="org-src-container">
 <pre class="src src-python"> <span class="org-keyword">for</span> epoch  <span class="org-keyword">in</span>  <span class="org-builtin">range</span>(6):
    train(epoch, net)
    test(net)
</pre>
</div>
</div>
</div>
</div>
 <div id="outline-container-orga25834a" class="outline-2">
 <h2 id="orga25834a">Summary</h2>
 <div class="outline-text-2" id="text-orga25834a">
 <p>
I wrote a lot more code to implement a comparatively-simple PyTorch model than to implement the
 <code>fastai</code> model. The PyTorch model forces us to better understand the structure of the model and the
logic of the training loop, though it likely takes more time and more finessing to obtain an
efficiently-performing model with decent results. The  <code>fastai</code> model, on the other hand, is very quick
to implement but does not expose as many of the details. It is relatively quick and easy to get a
model running and returning decent results, but it can take a bit more work to understand the
structure of the model and of the training loop.
</p>

 <p>
I'll be writing more – and more complicated – PyTorch models in the future. I hope to add in some
of the additional features included in the  <code>fastai</code> tabular implementation, such as dropout layers. I
also want to experiment further with regularization – L2 penalization is very easy to use in
PyTorch, but I've found L1 penalization to work far better for regression models in the Numerai
tournament and I want to see if that distinction also holds true for regression models.
</p>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20210514-pytorch-numerai.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20210514-pytorch-numerai.html</guid>
  <pubDate>Fri, 14 May 2021 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Mapping Urban Heat by Census Tract in R</title>
  <description><![CDATA[<div id="content">
 <div class="preview">
 <p>
 <i>Another one from the archives–this is one of my projects from my time at the Guinn Center, and something I very much wish I could have developed further: an analysis of urban heat in Las Vegas.</i>
</p>

</div>

 <div id="outline-container-orgb52dd35" class="outline-2">
 <h2 id="orgb52dd35">Background</h2>
 <div class="outline-text-2" id="text-orgb52dd35">
 <p>
For the past several months, I have been working on an analysis on the effects
of urban heat on vulnerable populations, particularly during a public health
crisis. For some background, I currently live in Las Vegas, where summer heat
can exceed 110 degrees. Last summer included a 45-day-long streak of
temperatures over 100 degrees.
</p>

 <p>
Urban heat is not distributed evenly within cities. Features such as parks or
ponds can lead to cooler temperatures in some areas, while areas without foliage
or with dark surfaces such as roads and buildings lead to warmer
temperatures. This effect is particularly pronounced at night: urban surfaces
absorb heat during the daytime, warming the air at night.
</p>

 <p>
An NPR Special Series titled  <a href="https://www.npr.org/series/756048128/urban-heat">Heat and Health in American Cities</a> compared urban
heat to household income in the 100 most populated cities. They found that, in
many cities, income and urban heat were inversely related: lower-income
households tended to be in the parts of cities most affected by urban heat,
while higher-income households were more often found in cooler areas.
</p>

 <p>
The key to this research was aggregating urban heat data within census
boundaries (such as tracts or blocks). I decided to recreate this analysis in
 <code>R</code>. Once urban heat data is linked to Census-designated boundaries, it can easily
be compared to metrics such as income, poverty, disability, access to health
insurance, demographics, any many other data points collected by the U.S. Census
Bureau's American Community Survey (ACS). In R, obtaining and mapping these
metrics is a relatively simple process with packages such as  <code>tidycensus</code> and
 <code>tigris</code>.
</p>

 <p>
The remainder of this post will provide a very brief overview of how to obtain
satellite surface temperature data; aggregate those data points within census
tracts; and plot the results. I don't know if this mapping exercise will make it
into the final project report, but I learned a lot from working through it, and
I wanted to make sure to document my steps here.
</p>

 <p>
Though it should be possible to follow this guide without much prior experience
working with spatial data,  <a href="https://geocompr.robinlovelace.net/">This free book</a>,  <i>Geocomputation with R</i> by Robin
Lovelace, Jakub Nowosad, Jannes Muenchow, is an excellent resource for those
interested in learning more. It is particularly useful for understanding topics
such as  <i>projections</i> and the differences between raster and vector data. The
section on  <a href="https://geocompr.robinlovelace.net/geometric-operations.html#raster-vector">Raster-vector interactions</a> is particularly relevant to this task as
we will be taking raster values (the heat map) and aggregating them within
polygon boundaries (census tracts).
</p>
</div>
</div>

 <div id="outline-container-orgdcd1b92" class="outline-2">
 <h2 id="orgdcd1b92">Getting the Data</h2>
 <div class="outline-text-2" id="text-orgdcd1b92">
 <p>
I obtained surface temperature satellite data from the NASA/USGS Landsat 8
satellite. The data can be obtained through an API, though for this example, I
downloaded the data manually. I looked for data meeting the following criteria:
</p>
 <ul class="org-ul"> <li>From June-August 2020</li>
 <li>Cloud cover less than 4%</li>
 <li>Landsat C1 Analysis-Ready Data (ARD) datasets</li>
 <li>I ultimately downloaded a raster map with ID
 <code>LC08_CU_005011_20200806_20200824_C01_V01</code>. This map came from 06
August, 2020. Details, including a download link, can be found  <a href="https://earthexplorer.usgs.gov/scene/metadata/full/5e83a38b677b457d/LC08_CU_005011_20200806_C01_V01/">here</a>.</li>
</ul> <p>
So what data did we actually obtain? Downloading the "Provisional Land Surface
Temperature" file returns a  <code>.tar</code> file with a number of  <code>.tif</code> raster images. We're
interested in the one with  <code>ST.tif</code> at the end (ST for Surface Temperature). This
provides a raster map of the region, at 30-meter spatial resolution, with
surface temperatures in tenths of a degree Kelvin. That is, each 30-meter "cell"
in the map is associated with a surface temperature value.
</p>
</div>

 <div id="outline-container-org18784e9" class="outline-3">
 <h3 id="org18784e9">Unpacking and Visualizing the Raw Data</h3>
 <div class="outline-text-3" id="text-org18784e9">
 <p>
This section requires the  <code>raster</code> and  <code>sf</code> packages. Below, we untar the map and
extract the map of interest.
</p>

 <div class="org-src-container">
 <pre class="src src-R"> <span class="org-ess-modifiers">library</span>(raster)
 <span class="org-ess-modifiers">library</span>(sf)

 <span class="org-comment-delimiter">## </span> <span class="org-comment">untar the data</span>
untar(tarfile =  <span class="org-string">"PATH-TO-TARFILE.tar"</span>, exdir =  <span class="org-string">"DESTINATION-DIRECTORY"</span>)
file.copy( <span class="org-string">"./data/raw/testsat/LC08_CU_005011_20200806_20200824_C01_V01_ST.tif"</span>,
           <span class="org-string">"IMAGE-DESTINATION/st_map.tif"</span>)

 <span class="org-comment-delimiter">## </span> <span class="org-comment">Access the file as a raster image, plot, and save as png</span>
st_map = raster( <span class="org-string">"./data/processed/st_map.tif"</span>)
png(file =  <span class="org-string">"./figs/st_map.png"</span>)
plot(st_map)
dev.off()
</pre>
</div>

 <div class="org-center">

 <figure> <img src="./figures/20210213-urban-heat/st_map.png" alt="st_map.png"></img> <figcaption> <span class="figure-number">Figure 1: </span>Raw raster map of surface temperatures around Las Vegas area</figcaption></figure></div>

 <p>
Starting from this map, we want to (1) crop to the area immediately surrounding
Las Vegas, and (2) average the temperature values within each census tract,
allowing us to compare tract-level surface temperatures to other data collected
at the census tract level.
</p>
</div>
</div>
</div>

 <div id="outline-container-org072ebc5" class="outline-2">
 <h2 id="org072ebc5">Mapping Heat by Census Tract</h2>
 <div class="outline-text-2" id="text-org072ebc5">
 <p>
First, we'll use the  <code>tigris</code> package to download the census tract boundaries in
Nevada and crop to the Las Vegas area.
</p>


 <div class="org-src-container">
 <pre class="src src-R">lv_tracts  <span class="org-ess-assignment"><-</span> tigris::tracts(state= <span class="org-string">"NV"</span>)  <span class="org-ess-XopX">%>%</span>
  st_crop(xmin=-115.38, ymin=35.92, xmax = -114.88, ymax = 36.38) 
</pre>
</div>

 <p>
Next, we'll reproject our tract-level data such that it has the same projection
as the raster data. Computationally, transforming vector data (our tract data)
is much less expensive than transforming raster data. After reprojecting, we can
use the  <code>crop</code> function from the  <code>raster</code> package to crop the raster image to the
Las Vegas area as defined in  <code>lv_tracts</code>.
</p>


 <div class="org-src-container">
 <pre class="src src-R">lv_tracts_reprojected = st_transform(lv_racts, crs(st_map))
sat_cropped = crop(st_map, lv_tracts_reprojected)
</pre>
</div>

 <p>
With this accomplished, we use the  <code>raster::extract()</code> function to extract the
mean of the raster values within the boundaries defined by
 <code>lv_tracts_reprojected</code>, which contains the census tract boundaries projected to
align with the raster map.
</p>

 <div class="org-src-container">
 <pre class="src src-R">heat_map = extract(sat_cropped,            <span class="org-comment-delimiter"># </span> <span class="org-comment">cropped raster object</span>
                   lv_tracts_reprojected,  <span class="org-comment-delimiter"># </span> <span class="org-comment">vector map of LV</span>
                   df= <span class="org-ess-constant">TRUE</span>,                <span class="org-comment-delimiter"># </span> <span class="org-comment">return as data frame</span>
                   fun=mean,               <span class="org-comment-delimiter"># </span> <span class="org-comment">return the mean of each polygon</span>
                   sp= <span class="org-ess-constant">TRUE</span>)                <span class="org-comment-delimiter"># </span> <span class="org-comment">append to lv_tracts_reprojected</span>

 <span class="org-comment-delimiter">## </span> <span class="org-comment">Visualize</span>
sf_heat_map = st_as_sf(heat_map)           <span class="org-comment-delimiter"># </span> <span class="org-comment">Convert to simple features (sf) vector data</span>
png(file= <span class="org-string">"IMAGE_DESTINATION/heatmaptest.png"</span>)
plot(out[ <span class="org-string">"st_map"</span>])                        <span class="org-comment-delimiter"># </span> <span class="org-comment">plot the column of raster values</span>
dev.off()
</pre>
</div>

 <div class="org-center">

 <figure> <img src="./figures/20210213-urban-heat/heatmaptest.png" alt="heatmaptest.png"></img> <figcaption> <span class="figure-number">Figure 2: </span>Average Surface Temperatures by Census Tract in Las Vegas, Nevada (tenths of a degree Kelvin)</figcaption></figure></div>

 <p>
We're closer to our goal, but not quite there yet. Our map is rotated, and the
scale (tenths of a degree Kelvin) isn't especially interpretable. First, we'll
reproject the map to the correct orientation (back to the original projection of
the census tract data).
</p>

 <div class="org-src-container">
 <pre class="src src-R">heat_tracts_transformed = st_transform(x=sf_heat_map, crs = crs(lv_tracts))
png( <span class="org-string">"tract_repro.png"</span>)
plot(heat_tracts_transformed[ <span class="org-string">"st_map"</span>])
dev.off()
</pre>
</div>

 <div class="org-center">

 <figure> <img src="./figures/20210213-urban-heat/tract_repro.png" alt="tract_repro.png"></img> <figcaption> <span class="figure-number">Figure 3: </span>Re-projected Map of Surface Temperatures by Census Tract</figcaption></figure></div>
</div>
</div>

 <div id="outline-container-orgd87829b" class="outline-2">
 <h2 id="orgd87829b">Final Maps</h2>
 <div class="outline-text-2" id="text-orgd87829b">
 <p>
Lastly, we can apply some formatting to make it more interpretable. I used
 <code>ggplot2</code> for all of the visual tweaks (details not shown).
</p>

 <div class="org-center">

 <figure> <img src="./figures/20210213-urban-heat/ST_LV.png" alt="ST_LV.png"></img> <figcaption> <span class="figure-number">Figure 4: </span>Visualizing Urban Heat by Census Tract in Las Vegas, Nevada</figcaption></figure></div>

 <p>
We can now plot other metrics by census tract and visually compare them to our
urban heat map. For example, we can look at poverty by census tract:
</p>

 <div class="org-center">

 <figure> <img src="./figures/20210213-urban-heat/poverty.png" alt="poverty.png"></img> <figcaption> <span class="figure-number">Figure 5: </span>Poverty by Census Tract in Las Vegas, Nevada</figcaption></figure></div>

 <p>
A quick visual inspection of these two maps shows that the Sunrise Manor and
Winchester areas have relatively high temperatures and a high proportion of
residents living abelow the poverty line. Conversely, the Summerlin area on the
west side of Las Vegas has among the lowest temperatures and the lowest rates of
poverty.
</p>

 <p>
There are plenty of additional analyses we can conduct from here. The NPR report
linked above calculated correlations between tract-level surface temperatures
and household incomes to determine that the two were inversely correlated. There
are also a variety of  <a href="https://maczokni.github.io/crimemapping_textbook_bookdown/spatial-regression-models.html">spatial regression models</a> and  <a href="https://geocompr.robinlovelace.net/spatial-cv.html">statistical learning/machine
learning</a> techniques that can be applied to spatial data. Understanding how to
connect different sources of spatial data – such as the census tracts and heat
data above – is an important first step to conducting these analyses.
</p>
</div>
</div>

 <div id="outline-container-org93620e0" class="outline-2">
 <h2 id="org93620e0">Resources</h2>
 <div class="outline-text-2" id="text-org93620e0">
 <ul class="org-ul"> <li> <a href="https://cran.r-project.org/web/views/Spatial.html">CRAN Task View: Analysis
of Spatial Data</a>: A CRAN hub explaining the  <code>R</code> ecosystem of spatial data
analysis packages</li>
 <li> <a href="https://rspatial.org/raster/index.html">Spatial Data Science with R</a>: A site providing a broad overview of spatial data
science concepts and methods in  <code>R</code>.</li>
 <li> <a href="https://geocompr.robinlovelace.net/">Geocomputation with R</a>: A book by Robin Lovelace, Jakub Nowosad, and Jannes
Muenchow, now published by CRC press. I learned most of what I presented above
from this book, which provides a thorough account of the ways of manipulating,
mapping, and analyzing spatial data, with numerous excellent examples.</li>
</ul></div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20210213-urban-heat.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20210213-urban-heat.html</guid>
  <pubDate>Sat, 13 Feb 2021 08:00:00 +0000</pubDate>
</item>
<item>
  <title>Book Review: Machine Learning Yearning by Andrew Ng</title>
  <description><![CDATA[<div id="content">
 <div class="preview">
 <p>
 <i>This is the first of a few posts I'm migrating from my old site, which you can
still find  <a href="https://pensive-wing-19c199.netlify.app/">here</a>. This is a review of Machine Learning Yearning by Andrew Ng.</i>
</p>

</div>

 <div id="outline-container-org918dc29" class="outline-2">
 <h2 id="org918dc29">Introduction and Perspective</h2>
 <div class="outline-text-2" id="text-org918dc29">
 <p>
In this post, I am briefly reviewing the draft of Andrew Ng's  <i>Machine Learning Yearning</i>, which can currently be obtained for free  <a href="https://www.mlyearning.org/">here</a>. This is a work in progress, so my comments will be brief and not particularly critical. I obtained the copy I read on May 11; the page numbers and content may have changed since then.
</p>

 <p>
I read the book because I have not had the chance to do too much machine learning work in the recent past. I feared that my skills were getting rusty, so I wanted to "dip my toes" back in the ML water and refresh my memory of that world. This is an ongoing process.
</p>

 <p>
Most of my ML education comes from working through much of the classic  <i>Elements of Statistical Learning</i> during my Statistics MS, so my perspective is significantly influenced by my experience with that book.
</p>
</div>
</div>

 <div id="outline-container-orgc12f141" class="outline-2">
 <h2 id="orgc12f141">Overview of the Book</h2>
 <div class="outline-text-2" id="text-orgc12f141">
 <p>
In  <i>Machine Learning Yearning</i>, Ng states that "after finishing this book, you will have a deep understanding of how to set technical direction for a machine learning project" (pg. 8). The key element of that statement is  <i>technical direction.</i> This book does not teach (and does not claim to teach) any particular ML algorithms. There is no code. There is very, very little mathematical notation. This book covers broad topics such as structuring training/dev/test sets and conducting error analyses, and it does so in a way that is largely agnostic to the ML algorithms used (though, at times, it is fairly clear that it is geared largely toward deep learning/neural networks).
</p>

 <p>
As of May 11, 2019, the book is divided into 58 chapters. Most chapters are only a page or two long. Ng states that the brevity of the chapters is such that "you can print them out and get your teammates to read just the 1-2 pages you need them to know." The short chapters did make the book easy to read as it divided the content into (very) short and easily-digestible pieces. However, I often did not find the chapters sufficiently self-contained to justify the divisions. I don't think the book would have suffered from having chapters 5-10 pages in length instead of 1-2 pages, and slightly longer chapters may have made the flow of information a little easier to follow (not that it was ever a significant challenge).
</p>

 <p>
Core topics covered include:
</p>
 <ul class="org-ul"> <li>Composition of the train/dev/test sets (chapters 5-7, 11-2)</li>
 <li>Good characteristics of optimization metrics (chapters 8-12)</li>
 <li>Error analysis (chapters 14-19)</li>
 <li>Bias-Variance Trade-off; training vs. test error (chapters 20-32)</li>
 <li>Comparisons to human-level performance (chapters 33-35)</li>
 <li>Training/Testing on different data distributions; data mismatch errors; generalization from training to dev set (chapters 36-43)</li>
 <li>Optimization Verification Testing (chapters 44-46)</li>
 <li>End-to-end learning vs. pipeline learning (chapters 47-49)</li>
 <li>Pipeline learning: choosing components; error analysis by parts (chapters 50-57)</li>
</ul></div>
</div>

 <div id="outline-container-org271a6ca" class="outline-2">
 <h2 id="org271a6ca">General Thoughts on the Topic</h2>
 <div class="outline-text-2" id="text-org271a6ca">
 <p>
I found that this book provided a valuable supplement to my past reading and experience with machine learning insofar as it got "out of the weeds" and discussed the  <i>process</i> rather than the specific implementations. When learning specific ML techniques for the first time, it's easy to get lost in the weeds. And when something goes wrong, that's where one might look for solutions: in the weeds. Is the implementation wrong? Do I need to improve my feature selection? Is the particular method I'm using wrong? This book offers another perspective. Regardless of the techniques used, it may be possible to improve one's model by, for example, seeking out more training examples; conducting a careful error analysis; or increasing the size/complexity of the model. These "big picture" considerations are often taught as an afterthought, if at all, in more mathematically-focused ML books and courses. But they should be taught sooner as they provide an excellent framework for thinking about any given ML approach.
</p>

 <p>
The book naturally had some limitations. Once again, this is an early version; it is entirely possible that some or all of these issues will be addressed at some point in the future. I believe the book should have been clearer from the beginning that the focus was on deep learning/neural networks. Midway through the book, Ng notes that reducing the number of features is not recommended for reducing variance, as feature selection in general is de-emphasized in modern deep learning. Aside from this and the selection of examples, I don't think the deep learning focus is entirely clear. Furthermore, the prerequisites are a little vague. The book was very easy to follow, but it sometimes suffered from avoiding too much detail. Casual references to "regularization" or "early stopping," without more than a cursory explanation of those terms, may be confusing (or simply unnecessary) to some readers.
</p>

 <p>
The book would benefit greatly from a set of simple but well-implemented examples, perhaps in R Shiny or in a Jupyter notebook, of the various key points made throughout the book. This could be done without expecting much, if any, programming experience on the part of the reader, and it would go a long way toward illustrating some of the concepts that may not be entirely intuitive. For example, the reader could explore the impact of trying to generalize a cat identifying tool from pictures found online to pictures taken from smartphones, or the difference in a sentiment analyzer based in an "end-to-end" vs. learning pipeline approach. The examples in the text are certainly useful, but the ability to make changes and explore the results would significantly enhance the experience.
</p>

 <p>
The barriers to entry for ML are decreasing. Specific knowledge of the algorithms themselves is becoming less and less of a requirement (whether this  <i>should</i> be the case is a different question, and one I will not attempt to address here). Books like this will be invaluable for guiding the next generation of ML practitioners, many of whom will benefit more from a strong understanding of the big-picture process than from a more theoretical understanding of the specific methods being used. This is a good book; many will find it useful.
</p>
</div>
</div>
</div>]]></description>
  <link>https://danliden.com/posts/./20190614-ml-yearning-review.html</link>
  <guid isPermaLink="false">https://danliden.com/posts/./20190614-ml-yearning-review.html</guid>
  <pubDate>Fri, 14 Jun 2019 08:00:00 +0000</pubDate>
</item>
</channel>
</rss>
