<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Answer.ai, Claudette, and FastHTML</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css"/>
<link rel="stylesheet" type="text/css" href="/orgstyle.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Slab&display=swap" rel="stylesheet">
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@dliden">
</head>
<body>
<div id="preamble" class="status">
<hr style="border-top: 1px solid black;">
<div class='topnav' style='display: flex; justify-content: space-between; align-items: center;'>
  <a href="/index.html"><h2 style='margin-top: 0; margin-bottom: 0; margin-left:0px;'>Daniel Liden</h2></a>
  <div>
    <a href='/archive.html' style='font-weight:bold; font-style:italic;'>Blog</a> / 
    <a href='/about.html' style='font-weight:bold; font-style:italic;'>About Me</a> /
    <a href='/photos.html' style='font-weight:bold; font-style:italic;'>Photos</a> /
    <a href='/fine-tuning/' style='font-weight:bold; font-style:italic;'>LLM Fine Tuning</a> /
    <a href='/notes.html' style='font-weight:bold; font-style:italic;'>Notes</a> /
    <a href='/rss.xml'>
      <img src='/rss.png' style='height: 1em;'>
    </a>
  </div>
</div>
<hr style="border-top: 1px solid black;">
</div>
<div id="content" class="content">
<header>
<h1 class="title">Answer.ai, Claudette, and FastHTML</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org5ef17bd">Introduction</a></li>
<li><a href="#org6262319">Claudette</a>
<ul>
<li><a href="#orge5ca823">Setup</a></li>
<li><a href="#org809929b">The <code>Chat</code> class</a></li>
<li><a href="#org374e3a0">Tools</a></li>
</ul>
</li>
<li><a href="#orgc56ccd1">IN PROGRESS FastHTML</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org5ef17bd" class="outline-2">
<h2 id="org5ef17bd">Introduction</h2>
<div class="outline-text-2" id="text-org5ef17bd">
<div class="preview" id="org043b69e">
<p>
I just listened to the latest episode of the <a href="https://www.latent.space/p/answerai">Latent Space podcast</a>, which featured Jeremy Howard of <a href="https://www.fast.ai/">fast.ai</a> fame. Fast.ai was my introduction to deep learning—or at least re-introduction following a brief and theory-oriented treatment of the topic in grad school—and the course and book remain among the best learning resources I have ever encountered. The podcast was a good reminder to look into the projects Howard and his team have been working on at <a href="https://www.answer.ai/">answer.ai</a>, "a new kind of AI R&amp;D lab which creates practical end-user products based on foundational research breakthroughs."
</p>

</div>

<p>
In particular, I want to spend a few minutes looking into <a href="https://www.answer.ai/posts/2024-06-23-claudette-src.html">claudette</a> and <a href="https://www.answer.ai/posts/2024-08-03-fasthtml.html">FastHTML</a>. The former is a more convenient, high-level interface to Anthropic's model that tries to automate "pretty much everything that can be automated, whilst providing full control." As a daily user of LLM APIs, I'm interested in seeing how this differs from Anthropic's SDK and which better suits my uses.
</p>

<p>
The latter is a "general-purpose full-stack web programming system" with the goal of becoming "the easiest way to create quick prototypes, and also the easiest way to create scalable, powerful, rich applications." I have some personal projects in the works. I can write the server code just fine, but always get hung up on the interface. One of the main ideas of FastHTML seems to be making it as easy as possible to build prototypes. I'm hoping that proves true in my use cases.
</p>

<p>
In the rest of this note, I am going to explore some of the major features of these two libraries.
</p>
</div>
</div>
<div id="outline-container-org6262319" class="outline-2">
<h2 id="org6262319">Claudette</h2>
<div class="outline-text-2" id="text-org6262319">
</div>
<div id="outline-container-orge5ca823" class="outline-3">
<h3 id="orge5ca823">Setup</h3>
<div class="outline-text-3" id="text-orge5ca823">
<p>
We start by installing the library with <code>pip install claudette</code>. This also installs Anthropic's SDK. We can then import claudette.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> claudette

<span class="org-comment-delimiter"># </span><span class="org-comment">list available models</span>
<span class="org-builtin">print</span>(claudette.models)

<span class="org-comment-delimiter"># </span><span class="org-comment">save sonnet as "model" for use later</span>
<span class="org-variable-name">model</span> <span class="org-operator">=</span> claudette.models[1]
</pre>
</div>

<pre class="example">
('claude-3-opus-20240229', 'claude-3-5-sonnet-20240620', 'claude-3-haiku-20240307')
</pre>
</div>
</div>
<div id="outline-container-org809929b" class="outline-3">
<h3 id="org809929b">The <code>Chat</code> class</h3>
<div class="outline-text-3" id="text-org809929b">
<p>
The <code>Chat</code> class is the main interface to Claudette. It is a nice convenient chat manager that maintains state. Note that, for this to work, we need to have <code>ANTHROPIC_API_KEY</code> in our environment.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> os

<span class="org-builtin">print</span>(os.getenv(<span class="org-string">"ANTHROPIC_API_KEY"</span>) <span class="org-keyword">is</span> <span class="org-keyword">not</span> <span class="org-constant">None</span>)
</pre>
</div>

<pre class="example">
True
</pre>


<p>
Now we can start using the <code>Chat</code> class.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> rich <span class="org-keyword">import</span> <span class="org-builtin">print</span>

<span class="org-variable-name">chat</span> <span class="org-operator">=</span> claudette.Chat(model, sp<span class="org-operator">=</span><span class="org-string">"You are a helpful assistant and an expert in all things emacs. Keep your responses concise and to the point."</span>)

<span class="org-builtin">print</span>(chat(<span class="org-string">"Hello!"</span>))
</pre>
</div>

<pre class="example" id="orga9fddb9">
Message(
    id='msg_016RqYbsX6ULEYPX3CPGeFz3',
    content=[
        TextBlock(
            text="Hello! I'm here to help with any Emacs-related questions you 
might have. Whether it's about configuration, commands, packages, or general 
usage, feel free to ask. What would you like to know about Emacs?",
            type='text'
        )
    ],
    model='claude-3-5-sonnet-20240620',
    role='assistant',
    stop_reason='end_turn',
    stop_sequence=None,
    type='message',
    usage=Usage(input_tokens=33, output_tokens=51)
)
</pre>

<p>
We can easily include a <code>prefill</code> argument to specify how the assistant response should begin.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">r</span> <span class="org-operator">=</span> chat(<span class="org-string">"Tell me what an emacs hook is"</span>, prefill<span class="org-operator">=</span><span class="org-string">"According to the wisdom of fishermen, hooks are"</span>)

<span class="org-builtin">print</span>(r)
</pre>
</div>

<pre class="example" id="org5ed994d">
Message(
    id='msg_01WMzMzhu7AxfSWEuHtaXZ6s',
    content=[
        TextBlock(
            text='According to the wisdom of fishermen, hooks are used to catch 
fish. In Emacs, hooks are used to catch events.\n\nAn Emacs hook is a variable 
that holds a list of functions to be run at a specific time or in response to a 
particular event. Hooks allow users and developers to customize Emacs behavior 
without modifying core code.\n\nKey points about hooks:\n\n1. They\'re typically
named with "-hook" suffix (e.g., `after-init-hook`).\n2. Functions can be added 
to or removed from hooks.\n3. Hooks are executed in the order functions were 
added.\n4. Common uses include mode-specific customizations and global 
behaviors.\n\nExample: `(add-hook \'python-mode-hook \'flycheck-mode)` enables 
Flycheck for Python files.',
            type='text'
        )
    ],
    model='claude-3-5-sonnet-20240620',
    role='assistant',
    stop_reason='end_turn',
    stop_sequence=None,
    type='message',
    usage=Usage(input_tokens=106, output_tokens=172)
)
</pre>

<p>
How does this all compare to the Anthropic SDK? The biggest difference I see is that <code>claudette</code> handles the chat history for you, saving you from the need to manage a list of dictionaries of chat messages. I usually spend a few mintues searching through old projects to find one of the chat class wrappers I've written, so having a straightforward library that does it for me would save a little bit of time.
</p>
</div>
</div>
<div id="outline-container-org374e3a0" class="outline-3">
<h3 id="org374e3a0">Tools</h3>
<div class="outline-text-3" id="text-org374e3a0">
<p>
Though they have been around for a while now, I really haven't experimented much with tool calling. <code>claudette</code> actually implements the tool loop, making it straightforward to prompt claude to actually call on a tool and do something with the results. With the Anthropic SDK, you would need to implement this yourself—the SDK would return a tool call, which you'd pass to the tool, get the results, and return it in another API call.
</p>

<p>
Let's try the <code>claudette</code> approach. We'll define a function to replace all instances of the letter e with the number 3, something llms generally are not very good at.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">replace_e_with_3</span>(input_string: <span class="org-builtin">str</span>) <span class="org-operator">-&gt;</span> <span class="org-builtin">str</span>:
    <span class="org-doc">"""</span>
<span class="org-doc">    Replaces all instances of 'e' (both upper and lower case) in a given string with the digit 3.</span>

<span class="org-doc">    Args:</span>
<span class="org-doc">        input_string (str): The string to modify.</span>

<span class="org-doc">    Returns:</span>
<span class="org-doc">        str: The modified string with all 'e's replaced by 3s.</span>
<span class="org-doc">    """</span>

    <span class="org-keyword">return</span> input_string.replace(<span class="org-string">'e'</span>, <span class="org-string">'3'</span>).replace(<span class="org-string">'E'</span>, <span class="org-string">'3'</span>)
</pre>
</div>

<p>
Now to prompt <code>claude</code>, giving access to the function:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">tool_chat</span> <span class="org-operator">=</span> claudette.Chat(model, tools<span class="org-operator">=</span>[replace_e_with_3])

<span class="org-variable-name">r</span> <span class="org-operator">=</span> tool_chat(<span class="org-string">"""Replace all es with 3s in the following text:</span>

<span class="org-string">Claudette automates pretty much everything that can be automated, whilst providing full control.</span>
<span class="org-string">"""</span>)

<span class="org-builtin">print</span>(r)
</pre>
</div>

<pre class="example" id="orgfa1d1e6">
Message(
    id='msg_019skDwHaHQZRhzwDRvystqa',
    content=[
        TextBlock(
            text="Certainly! I can help you replace all the 'e's (both uppercase
and lowercase) with the digit 3 in the text you provided. To do this, I'll use 
the `replace_e_with_3` function. Here's how we'll do it:",
            type='text'
        ),
        ToolUseBlock(
            id='toolu_01Y8Ag2mWJSxmLXJRHPGQ9V2',
            input={
                'input_string': 'Claudette automates pretty much everything that
can be automated, whilst providing full control.'
            },
            name='replace_e_with_3',
            type='tool_use'
        )
    ],
    model='claude-3-5-sonnet-20240620',
    role='assistant',
    stop_reason='tool_use',
    stop_sequence=None,
    type='message',
    usage=Usage(input_tokens=480, output_tokens=134)
)
</pre>

<p>
Now if we call the chat object again, it will be executed.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">r</span> <span class="org-operator">=</span> tool_chat()
<span class="org-builtin">print</span>(r)
</pre>
</div>

<pre class="example" id="org8335fcd">
Message(
    id='msg_012aEzN2o8977ULFXDviJVnw',
    content=[
        TextBlock(
            text="Here's the result after replacing all 'e's with 
'3's:\n\nClaud3tt3 automat3s pr3tty much 3v3rything that can b3 automat3d, 
whilst providing full control.\n\nAs you can see, all instances of 'e' (both 
lowercase and uppercase, although there were no uppercase E's in this case) have
been replaced with the digit 3. The rest of the text remains unchanged.",
            type='text'
        )
    ],
    model='claude-3-5-sonnet-20240620',
    role='assistant',
    stop_reason='end_turn',
    stop_sequence=None,
    type='message',
    usage=Usage(input_tokens=662, output_tokens=105)
)
</pre>

<p>
We can use <code>chat.toolloop</code> to do this in a single step. It can even use multiple tools sequentially. And the <code>trace_func</code> arguments lets us see the sequence of tool calls/responses.
</p>

<p>
Claudette also supports <a href="https://claudette.answer.ai/#images">images</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgc56ccd1" class="outline-2">
<h2 id="orgc56ccd1">IN PROGRESS FastHTML</h2>
<div class="outline-text-2" id="text-orgc56ccd1">
<p>
I am interested in FastHTML because I've realized that many of my AI-related project ideas require more work on the interface than on the actual AI parts. I can write the prompts and AI logic pretty easily, but (for me) there's a lot of friction in building out a decent frontend. If FastHTML can make that even a little bit easier, it'll be huge for me.
</p>

<p>
What is FastHTML? It is a web framework that is totally written in Python. It is built on top of Starlette, Uvicorn, and HTMX. FastHTML was written with the idea that it should be as easy as possible to create AI products and services, which gives me some confidence that it will be useful for my specific applications.
</p>

<p>
I highly recommend watching Jeremy Howards's video introducing and demoing FastHTML: <a href="https://www.youtube.com/watch?v=Auqrm7WFc0I">YouTube Link</a>.
</p>

<p>
Let's take a look at some of the demo projects!
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2024-08-18 Sun 00:00</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.3 (<a href="https://orgmode.org">Org</a> mode 9.6.15)</p>
</div>
</body>
</html>
